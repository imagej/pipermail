<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;href=&quot;http://fiji.sc/bugzilla/&quot;&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;&lt;span&nbsp;class=&quot;vcard&quot;&gt;&lt;a&nbsp;class=&quot;email&quot;&nbsp;href=&quot;mailto:gadea.mata&#64;unirioja.es&quot;&nbsp;title=&quot;Gadea&nbsp;Mata&nbsp;&lt;gadea.mata&#64;unirioja.es&gt;&quot;&gt;&nbsp;&lt;span&nbsp;class=&quot;fn&quot;&gt;Gadea&nbsp;Mata&lt;/span&gt;&lt;/a&gt;<br>
&lt;/span&gt;&nbsp;changed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_REOPENED&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;REOPENED&nbsp;-&nbsp;Bug&nbsp;in&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;of&nbsp;threshold&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=938&quot;&gt;bug&nbsp;938&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&nbsp;border=&quot;1&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;What&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Removed&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Added&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;style=&quot;text-align:right;&quot;&gt;Status&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;RESOLVED<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;REOPENED<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;style=&quot;text-align:right;&quot;&gt;Resolution&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;INVALID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;---<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;&lt;/table&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_REOPENED&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;REOPENED&nbsp;-&nbsp;Bug&nbsp;in&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;of&nbsp;threshold&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=938#c4&quot;&gt;Comment&nbsp;#&nbsp;4&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_REOPENED&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;REOPENED&nbsp;-&nbsp;Bug&nbsp;in&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;of&nbsp;threshold&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=938&quot;&gt;bug&nbsp;938&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&lt;span&nbsp;class=&quot;vcard&quot;&gt;&lt;a&nbsp;class=&quot;email&quot;&nbsp;href=&quot;mailto:gadea.mata&#64;unirioja.es&quot;&nbsp;title=&quot;Gadea&nbsp;Mata&nbsp;&lt;gadea.mata&#64;unirioja.es&gt;&quot;&gt;&nbsp;&lt;span&nbsp;class=&quot;fn&quot;&gt;Gadea&nbsp;Mata&lt;/span&gt;&lt;/a&gt;<br>
&lt;/span&gt;&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;Thanks&nbsp;for&nbsp;all&nbsp;your&nbsp;answers.&nbsp;I&nbsp;am&nbsp;not&nbsp;completely&nbsp;sure&nbsp;about&nbsp;some&nbsp;parts&nbsp;of&nbsp;your<br>
answers.<br>
<br>
1)&nbsp;Packing&nbsp;16bit&nbsp;histogram&nbsp;into&nbsp;an&nbsp;8&nbsp;bit&nbsp;space.&nbsp;<br>
<br>
The&nbsp;problem&nbsp;that&nbsp;I&nbsp;commented&nbsp;not&nbsp;only&nbsp;appears&nbsp;when&nbsp;working&nbsp;with&nbsp;16bits&nbsp;images,<br>
but&nbsp;also&nbsp;with&nbsp;8bits&nbsp;images.&nbsp;For&nbsp;instance,&nbsp;you&nbsp;can&nbsp;find&nbsp;a&nbsp;problematic&nbsp;image&nbsp;in<br>
the&nbsp;link:&nbsp;&lt;a&nbsp;href=&quot;https://www.dropbox.com/s/sm7p9f0n8z1mxdw/gfp-6.tif?dl=0&quot;&gt;https://www.dropbox.com/s/sm7p9f0n8z1mxdw/gfp-6.tif?dl=0&lt;/a&gt;.&nbsp;For&nbsp;this<br>
image&nbsp;(an&nbsp;8bits-image),&nbsp;different&nbsp;threshold&nbsp;values&nbsp;are&nbsp;returned&nbsp;when&nbsp;using&nbsp;the<br>
Intermodes&nbsp;method&nbsp;of&nbsp;the&nbsp;plugins&nbsp;&quot;Auto&nbsp;Threshold&quot;&nbsp;and&nbsp;&quot;Threshold...&quot;.<br>
Therefore,&nbsp;I&nbsp;think&nbsp;that&nbsp;the&nbsp;problem&nbsp;is&nbsp;not&nbsp;related&nbsp;to&nbsp;the&nbsp;packaging&nbsp;of&nbsp;a&nbsp;16bit<br>
histogram&nbsp;into&nbsp;an&nbsp;8&nbsp;bit&nbsp;space.&nbsp;<br>
<br>
2)&nbsp;What&nbsp;is&nbsp;the&nbsp;class&nbsp;that&nbsp;contains&nbsp;the&nbsp;correct&nbsp;code?<br>
<br>
&gt;From&nbsp;my&nbsp;point&nbsp;of&nbsp;view,&nbsp;the&nbsp;two&nbsp;correct&nbsp;implementations&nbsp;are&nbsp;(1)&nbsp;the&nbsp;&quot;Auto<br>
Threshold&quot;&nbsp;implementation&nbsp;(which&nbsp;is&nbsp;part&nbsp;of&nbsp;Fiji,&nbsp;and&nbsp;can&nbsp;be&nbsp;found&nbsp;at:<br>
&lt;a&nbsp;href=&quot;https://github.com/fiji/Auto_Threshold/blob/0565751243a83688c84857475adb51ae836a843e/src/main/java/fiji/threshold/Auto_Threshold.java#L493-L541&quot;&gt;https://github.com/fiji/Auto_Threshold/blob/0565751243a83688c84857475adb51ae836a843e/src/main/java/fiji/threshold/Auto_Threshold.java#L493-L541&lt;/a&gt;),<br>
and&nbsp;(2)&nbsp;the&nbsp;recently&nbsp;ported&nbsp;implementation&nbsp;from&nbsp;Fiji's&nbsp;Auto_Thresold,&nbsp;in&nbsp;the<br>
ImageJ&nbsp;OPS&nbsp;library&nbsp;<br>
(&lt;a&nbsp;href=&quot;https://github.com/imagej/imagej-ops/blob/114183192d41e9dcbe0e6450512170f8a566dc6e/src/main/java/net/imagej/ops/threshold/global/methods/ComputeIntermodesThreshold.java#L58-L100&quot;&gt;https://github.com/imagej/imagej-ops/blob/114183192d41e9dcbe0e6450512170f8a566dc6e/src/main/java/net/imagej/ops/threshold/global/methods/ComputeIntermodesThreshold.java#L58-L100&lt;/a&gt;).<br>
<br>
On&nbsp;the&nbsp;contrary,&nbsp;the&nbsp;ImageJ&nbsp;1.x&nbsp;implementation&nbsp;in&nbsp;the&nbsp;class&nbsp;AutoThresholder&nbsp;is<br>
not&nbsp;correct.&nbsp;I&nbsp;think&nbsp;that&nbsp;the&nbsp;problem&nbsp;appears&nbsp;when&nbsp;the&nbsp;“mean&nbsp;filter”&nbsp;is&nbsp;applied<br>
to&nbsp;smooth&nbsp;the&nbsp;histogram<br>
(&lt;a&nbsp;href=&quot;https://github.com/imagej/ImageJA/blob/v1.49h/src/main/java/ij/process/AutoThresholder.java#L198-L199&quot;&gt;https://github.com/imagej/ImageJA/blob/v1.49h/src/main/java/ij/process/AutoThresholder.java#L198-L199&lt;/a&gt;).<br>
If&nbsp;I&nbsp;understand&nbsp;properly,&nbsp;the&nbsp;process&nbsp;to&nbsp;apply&nbsp;the&nbsp;mean&nbsp;filter&nbsp;with&nbsp;radius&nbsp;3&nbsp;to<br>
an&nbsp;array&nbsp;A&nbsp;could&nbsp;be&nbsp;seen&nbsp;as&nbsp;follows.&nbsp;We&nbsp;have&nbsp;a&nbsp;new&nbsp;array&nbsp;B&nbsp;with&nbsp;the&nbsp;same&nbsp;length<br>
as&nbsp;A&nbsp;and&nbsp;the&nbsp;value&nbsp;of&nbsp;B[i]&nbsp;is&nbsp;(A[i-1]&nbsp;+&nbsp;A[i]&nbsp;+&nbsp;A[i+1])/3&nbsp;(the&nbsp;values&nbsp;of&nbsp;the<br>
first&nbsp;and&nbsp;last&nbsp;element&nbsp;of&nbsp;B&nbsp;are&nbsp;computed&nbsp;using&nbsp;(A[0]&nbsp;+&nbsp;A[1])/3&nbsp;&nbsp;and<br>
(A[A.length-2]+A[A.length-1])/3)&nbsp;―&nbsp;these&nbsp;are&nbsp;the&nbsp;formulas&nbsp;used&nbsp;in<br>
Implementations&nbsp;(1)&nbsp;and&nbsp;(2).&nbsp;However,&nbsp;the&nbsp;formula&nbsp;that&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;ImageJ<br>
1.x&nbsp;implementation&nbsp;is&nbsp;B[i]&nbsp;=&nbsp;(B[i-1]&nbsp;+&nbsp;A[i]&nbsp;+&nbsp;A[i+1])/3.<br>
<br>
In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;latter&nbsp;formula&nbsp;is&nbsp;the&nbsp;correct&nbsp;one,&nbsp;it&nbsp;should&nbsp;also&nbsp;be&nbsp;used<br>
in&nbsp;Implementations&nbsp;(1)&nbsp;and&nbsp;(2);&nbsp;otherwise,&nbsp;different&nbsp;results&nbsp;will&nbsp;be&nbsp;obtained.&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;You&nbsp;are&nbsp;receiving&nbsp;this&nbsp;mail&nbsp;because:&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;You&nbsp;are&nbsp;the&nbsp;assignee&nbsp;for&nbsp;the&nbsp;bug.&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
