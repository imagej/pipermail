<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;href=&quot;http://fiji.sc/bugzilla/&quot;&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;&lt;span&nbsp;class=&quot;vcard&quot;&gt;&lt;a&nbsp;class=&quot;email&quot;&nbsp;href=&quot;mailto:ctrueden&#64;wisc.edu&quot;&nbsp;title=&quot;Curtis&nbsp;Rueden&nbsp;&lt;ctrueden&#64;wisc.edu&gt;&quot;&gt;&nbsp;&lt;span&nbsp;class=&quot;fn&quot;&gt;Curtis&nbsp;Rueden&lt;/span&gt;&lt;/a&gt;<br>
&lt;/span&gt;&nbsp;changed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_CONFIRMED&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;CONFIRMED&nbsp;-&nbsp;Process-Math-Macro...&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=1169&quot;&gt;bug&nbsp;1169&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&nbsp;border=&quot;1&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;What&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Removed&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Added&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;style=&quot;text-align:right;&quot;&gt;Status&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;NEW<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;CONFIRMED<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;style=&quot;text-align:right;&quot;&gt;CC&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;ctrueden&#64;wisc.edu<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;&lt;/table&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_CONFIRMED&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;CONFIRMED&nbsp;-&nbsp;Process-Math-Macro...&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=1169#c1&quot;&gt;Comment&nbsp;#&nbsp;1&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_CONFIRMED&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;CONFIRMED&nbsp;-&nbsp;Process-Math-Macro...&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=1169&quot;&gt;bug&nbsp;1169&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&lt;span&nbsp;class=&quot;vcard&quot;&gt;&lt;a&nbsp;class=&quot;email&quot;&nbsp;href=&quot;mailto:ctrueden&#64;wisc.edu&quot;&nbsp;title=&quot;Curtis&nbsp;Rueden&nbsp;&lt;ctrueden&#64;wisc.edu&gt;&quot;&gt;&nbsp;&lt;span&nbsp;class=&quot;fn&quot;&gt;Curtis&nbsp;Rueden&lt;/span&gt;&lt;/a&gt;<br>
&lt;/span&gt;&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;What&nbsp;happens&nbsp;is:&nbsp;the&nbsp;Process&nbsp;&gt;&nbsp;Math&nbsp;&gt;&nbsp;Macro...&nbsp;command&nbsp;iterates&nbsp;over&nbsp;every<br>
pixel,&nbsp;replacing&nbsp;each&nbsp;value&nbsp;in-place&nbsp;as&nbsp;it&nbsp;goes.&nbsp;By&nbsp;referencing&nbsp;previously<br>
processed&nbsp;pixels&nbsp;via&nbsp;getPixel(x-1,&nbsp;y-1)&nbsp;you&nbsp;are&nbsp;subtracting&nbsp;your&nbsp;new&nbsp;pixel<br>
values&nbsp;instead&nbsp;of&nbsp;your&nbsp;original&nbsp;ones.<br>
<br>
Interesting&nbsp;that&nbsp;it&nbsp;works&nbsp;in&nbsp;8-bit,&nbsp;but&nbsp;not&nbsp;16-bit.&nbsp;Looking&nbsp;at&nbsp;the&nbsp;source,&nbsp;this<br>
is&nbsp;because&nbsp;there&nbsp;is&nbsp;special&nbsp;case&nbsp;logic&nbsp;for&nbsp;8-bit&nbsp;and&nbsp;RGB&nbsp;images&nbsp;[1]&nbsp;which<br>
copies&nbsp;the&nbsp;pixel&nbsp;buffer&nbsp;before&nbsp;executing&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;the&nbsp;getPixel<br>
function&nbsp;is&nbsp;used&nbsp;[2,&nbsp;3].&nbsp;However,&nbsp;no&nbsp;such&nbsp;thing&nbsp;is&nbsp;done&nbsp;for&nbsp;16-bit&nbsp;[4].<br>
<br>
As&nbsp;a&nbsp;workaround,&nbsp;you&nbsp;can&nbsp;instead&nbsp;write:<br>
<br>
&nbsp;&nbsp;v=getPixel(x+1,&nbsp;y+1)-getPixel(x,&nbsp;y);<br>
<br>
Which&nbsp;avoids&nbsp;the&nbsp;issue.<br>
<br>
I&nbsp;agree&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;bug,&nbsp;in&nbsp;that&nbsp;the&nbsp;behavior&nbsp;between&nbsp;8-bit&nbsp;and&nbsp;16-bit&nbsp;is<br>
inconsistent.<br>
<br>
[1]<br>
&lt;a&nbsp;href=&quot;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L254-L335&quot;&gt;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L254-L335&lt;/a&gt;<br>
[2]<br>
&lt;a&nbsp;href=&quot;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L277&quot;&gt;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L277&lt;/a&gt;<br>
[3]<br>
&lt;a&nbsp;href=&quot;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L319&quot;&gt;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L319&lt;/a&gt;<br>
[4]<br>
&lt;a&nbsp;href=&quot;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L321-L334&quot;&gt;https://github.com/imagej/ImageJA/blob/v1.50b/src/main/java/ij/plugin/filter/ImageMath.java#L321-L334&lt;/a&gt;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;You&nbsp;are&nbsp;receiving&nbsp;this&nbsp;mail&nbsp;because:&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;You&nbsp;are&nbsp;the&nbsp;assignee&nbsp;for&nbsp;the&nbsp;bug.&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
