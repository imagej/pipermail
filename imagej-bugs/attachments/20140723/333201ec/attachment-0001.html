<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;href=&quot;http://fiji.sc/bugzilla/&quot;&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_NEW&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;NEW&nbsp;-&nbsp;Fiji&nbsp;hangs&nbsp;when&nbsp;installing&nbsp;macro&nbsp;tool&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=835#c5&quot;&gt;Comment&nbsp;#&nbsp;5&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_NEW&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;NEW&nbsp;-&nbsp;Fiji&nbsp;hangs&nbsp;when&nbsp;installing&nbsp;macro&nbsp;tool&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=835&quot;&gt;bug&nbsp;835&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&lt;span&nbsp;class=&quot;vcard&quot;&gt;&lt;a&nbsp;class=&quot;email&quot;&nbsp;href=&quot;mailto:ilan.tal&#64;gmail.com&quot;&nbsp;title=&quot;Ilan&nbsp;Tal&nbsp;&lt;ilan.tal&#64;gmail.com&gt;&quot;&gt;&nbsp;&lt;span&nbsp;class=&quot;fn&quot;&gt;Ilan&nbsp;Tal&lt;/span&gt;&lt;/a&gt;<br>
&lt;/span&gt;&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;My&nbsp;debugging&nbsp;environment&nbsp;is&nbsp;NetBeans&nbsp;and&nbsp;I&nbsp;use&nbsp;ImageJ,&nbsp;not&nbsp;Fiji&nbsp;for&nbsp;memory<br>
considerations.&nbsp;For&nbsp;example&nbsp;there&nbsp;have&nbsp;been&nbsp;cases&nbsp;where&nbsp;a&nbsp;large&nbsp;whole&nbsp;body&nbsp;scan<br>
would&nbsp;not&nbsp;fit&nbsp;into&nbsp;memory&nbsp;for&nbsp;debugging.<br>
<br>
With&nbsp;this&nbsp;restriction,&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;goes&nbsp;on&nbsp;inside&nbsp;ImageJ&nbsp;when&nbsp;I<br>
install&nbsp;a&nbsp;macro&nbsp;tool.&nbsp;I&nbsp;can&nbsp;verify&nbsp;that&nbsp;ImageJ&nbsp;works&nbsp;properly&nbsp;but&nbsp;Fiji&nbsp;fails.&nbsp;I<br>
would&nbsp;like&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;work&nbsp;with&nbsp;someone&nbsp;who&nbsp;can&nbsp;check&nbsp;the&nbsp;Fiji&nbsp;environment.<br>
<br>
I&nbsp;will&nbsp;describe&nbsp;what&nbsp;happens&nbsp;in&nbsp;3&nbsp;different&nbsp;cases:<br>
1)&nbsp;installing&nbsp;using&nbsp;the&nbsp;toolbar&nbsp;&quot;More&quot;&nbsp;command&nbsp;and&nbsp;choosing&nbsp;the&nbsp;macro.<br>
2)&nbsp;installing&nbsp;using&nbsp;Plugins&nbsp;-&gt;&nbsp;Tools&nbsp;and&nbsp;choosing&nbsp;the&nbsp;macro.<br>
3)&nbsp;restarting&nbsp;ImageJ&nbsp;where&nbsp;the&nbsp;tools&nbsp;are&nbsp;reinstalled&nbsp;from&nbsp;the&nbsp;registry&nbsp;values.<br>
<br>
In&nbsp;Fiji&nbsp;case&nbsp;1&nbsp;causes&nbsp;a&nbsp;crash&nbsp;which&nbsp;freezes&nbsp;the&nbsp;keyboard.&nbsp;Fiji&nbsp;case&nbsp;2&nbsp;causes<br>
the&nbsp;macro&nbsp;to&nbsp;run&nbsp;but&nbsp;it&nbsp;doesn't&nbsp;get&nbsp;installed&nbsp;to&nbsp;the&nbsp;toolbar.&nbsp;Case&nbsp;3&nbsp;cannot&nbsp;be<br>
checked&nbsp;in&nbsp;Fiji&nbsp;since&nbsp;installation&nbsp;of&nbsp;the&nbsp;tool&nbsp;always&nbsp;fails.<br>
<br>
In&nbsp;the&nbsp;case&nbsp;of&nbsp;both&nbsp;a&nbsp;plugin&nbsp;jar&nbsp;file&nbsp;as&nbsp;well&nbsp;as&nbsp;a&nbsp;macro,&nbsp;both&nbsp;receive&nbsp;the&nbsp;run<br>
command.&nbsp;The&nbsp;plugin&nbsp;jar&nbsp;is&nbsp;simpler&nbsp;since&nbsp;its&nbsp;run&nbsp;does&nbsp;the&nbsp;install.&nbsp;The&nbsp;macro<br>
runs&nbsp;through&nbsp;some&nbsp;6&nbsp;different&nbsp;run&nbsp;commands.&nbsp;The&nbsp;stack&nbsp;dumps&nbsp;are&nbsp;shown&nbsp;in&nbsp;the&nbsp;3<br>
attachments.<br>
<br>
The&nbsp;crucial&nbsp;point&nbsp;is&nbsp;the&nbsp;macro&nbsp;name.&nbsp;Here&nbsp;is&nbsp;the&nbsp;code&nbsp;in&nbsp;macro&nbsp;runner&nbsp;which<br>
does&nbsp;the&nbsp;job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(name.endsWith(&quot;Tool.ijm&quot;)&nbsp;||&nbsp;name.endsWith(&quot;Tool.txt&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;name.endsWith(&quot;Menu.ijm&quot;)&nbsp;||&nbsp;name.endsWith(&quot;Menu.txt&quot;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(new&nbsp;MacroInstaller()).installTool(Menus.getPlugInsPath()+name);<br>
<br>
My&nbsp;tool&nbsp;is&nbsp;called&nbsp;Postage_Action_Tool.ijm&nbsp;and&nbsp;the&nbsp;Tool.ijm&nbsp;is&nbsp;the&nbsp;key.&nbsp;In<br>
ImageJ&nbsp;all&nbsp;works&nbsp;correctly&nbsp;so&nbsp;that&nbsp;it&nbsp;reaches&nbsp;this&nbsp;point.&nbsp;In&nbsp;case&nbsp;2&nbsp;of&nbsp;Fiji,&nbsp;it<br>
won't&nbsp;reach&nbsp;this&nbsp;point&nbsp;-&nbsp;instead&nbsp;of&nbsp;installing&nbsp;the&nbsp;tool,&nbsp;it&nbsp;runs&nbsp;it.&nbsp;In&nbsp;case&nbsp;1<br>
Fiji&nbsp;just&nbsp;crashes.<br>
<br>
Now&nbsp;to&nbsp;consider&nbsp;the&nbsp;different&nbsp;cases.&nbsp;In&nbsp;case&nbsp;1&nbsp;the&nbsp;interesting&nbsp;things&nbsp;start&nbsp;at<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;label&nbsp;=&nbsp;item.getLabel();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cmd&nbsp;=&nbsp;item.getActionCommand();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;isTool&nbsp;=&nbsp;cmd.equals(&quot;Tool&quot;)&nbsp;||&nbsp;cmd.equals(&quot;Plugin&nbsp;Tool&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(label.equals(&quot;Help...&quot;)||label.equals(&quot;Remove&nbsp;Custom&nbsp;Tools&quot;))<br>
&amp;&amp;&nbsp;!isTool)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentSet&nbsp;=&nbsp;label;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isTool)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cmd.equals(&quot;Tool&quot;))&nbsp;//&nbsp;built&nbsp;in&nbsp;tool<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;installBuiltinTool(label);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;//&nbsp;plugin&nbsp;or&nbsp;macro&nbsp;tool&nbsp;in&nbsp;ImageJ/plugins/Tools<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IJ.run(label);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
<br>
in&nbsp;itemStateChanged.&nbsp;The&nbsp;cmd&nbsp;is&nbsp;&quot;Plugin&nbsp;Tool&quot;&nbsp;and&nbsp;not&nbsp;&quot;Tool&quot;&nbsp;so&nbsp;that&nbsp;it&nbsp;skips<br>
the&nbsp;installBuiltinTool&nbsp;and&nbsp;does&nbsp;the&nbsp;IJ.run(label).&nbsp;In&nbsp;Fiji&nbsp;is&nbsp;it&nbsp;Tool,&nbsp;or<br>
Plugin&nbsp;Tool?<br>
<br>
Case&nbsp;2&nbsp;does&nbsp;a&nbsp;run&nbsp;directly&nbsp;which&nbsp;in&nbsp;ImageJ&nbsp;ends&nbsp;up&nbsp;checking&nbsp;the&nbsp;file&nbsp;name&nbsp;and<br>
causing&nbsp;the&nbsp;install,&nbsp;whereas&nbsp;in&nbsp;Fiji&nbsp;it&nbsp;just&nbsp;runs&nbsp;with&nbsp;no&nbsp;install.&nbsp;Why&nbsp;does<br>
Fiji&nbsp;act&nbsp;differently?<br>
<br>
Case&nbsp;3&nbsp;is&nbsp;the&nbsp;startup&nbsp;which&nbsp;works&nbsp;in&nbsp;ImageJ&nbsp;and&nbsp;can't&nbsp;be&nbsp;reached&nbsp;in&nbsp;Fiji.&nbsp;The<br>
code&nbsp;is<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;installStartupTools()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(IJ.debugMode)&nbsp;IJ.log(&quot;Toolbar.installStartupTools&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i=0;&nbsp;i&lt;=6;&nbsp;i++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;=&nbsp;Prefs.get(TOOL_KEY&nbsp;+&nbsp;(i/10)%10&nbsp;+&nbsp;i%10,&nbsp;&quot;&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(IJ.debugMode)&nbsp;IJ.log(&quot;&nbsp;&nbsp;&quot;+i+&quot;&nbsp;&quot;+name);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(name.equals(&quot;&quot;))&nbsp;continue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;installingStartupTool&nbsp;=&nbsp;true;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;ok&nbsp;=&nbsp;installBuiltinTool(name);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!ok)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(name.endsWith(&quot;Menu&nbsp;Tool&quot;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;name.substring(0,&nbsp;name.length()-5);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hashtable&nbsp;commands&nbsp;=&nbsp;Menus.getCommands();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(commands!=null&nbsp;&amp;&amp;&nbsp;commands.get(name)!=null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IJ.run(name);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;installingStartupTool&nbsp;=&nbsp;false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
The&nbsp;6&nbsp;additional&nbsp;keys&nbsp;are&nbsp;checked&nbsp;from&nbsp;the&nbsp;registry.&nbsp;Clearly&nbsp;this&nbsp;is&nbsp;not&nbsp;a<br>
built&nbsp;in&nbsp;tool&nbsp;so&nbsp;installBuiltinTool&nbsp;will&nbsp;fail.&nbsp;It&nbsp;then&nbsp;sees&nbsp;that&nbsp;commands&nbsp;are<br>
not&nbsp;null&nbsp;and&nbsp;commands.get(name)&nbsp;is&nbsp;in&nbsp;the&nbsp;hashtable,&nbsp;so&nbsp;the&nbsp;IJ.run(name)&nbsp;takes<br>
over.&nbsp;This&nbsp;reaches&nbsp;the&nbsp;same&nbsp;point&nbsp;as&nbsp;cases&nbsp;1&nbsp;and&nbsp;2&nbsp;causing&nbsp;the&nbsp;tool&nbsp;to&nbsp;be<br>
installed.<br>
<br>
Again,&nbsp;my&nbsp;question&nbsp;is:&nbsp;who&nbsp;has&nbsp;a&nbsp;Fiji&nbsp;environment&nbsp;and&nbsp;can&nbsp;check&nbsp;what&nbsp;the<br>
difference&nbsp;is&nbsp;in&nbsp;Fiji?<br>
<br>
Hoping&nbsp;to&nbsp;hear&nbsp;from&nbsp;someone,<br>
Ilan&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;You&nbsp;are&nbsp;receiving&nbsp;this&nbsp;mail&nbsp;because:&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;You&nbsp;are&nbsp;the&nbsp;assignee&nbsp;for&nbsp;the&nbsp;bug.&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
