<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;href=&quot;http://fiji.sc/bugzilla/&quot;&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;&lt;table&nbsp;border=&quot;1&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Bug&nbsp;ID&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_NEW&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;NEW&nbsp;-&nbsp;Multithreading&nbsp;problem&nbsp;in&nbsp;javascript&nbsp;macro&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=854&quot;&gt;854&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Summary&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Multithreading&nbsp;problem&nbsp;in&nbsp;javascript&nbsp;macro<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Product&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Fiji<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Version&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;unspecified<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Hardware&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;PC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;OS&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Linux<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Status&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;NEW<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Severity&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;normal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Priority&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;P4<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Component&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Plugins<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Assignee&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;imagej-bugs&#64;imagej.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Reporter&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;thomas.siegmund&#64;evotec.com<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;CC&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;thomas.siegmund&#64;evotec.com<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;&lt;/table&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;Hi,<br>
<br>
I've&nbsp;a&nbsp;a&nbsp;javascript&nbsp;macro&nbsp;running&nbsp;multithreaded&nbsp;as&nbsp;described&nbsp;in&nbsp;<br>
<br>
&lt;a&nbsp;href=&quot;http://fiji.sc/Multithreaded_Image_Processing_in_Javascript&quot;&gt;http://fiji.sc/Multithreaded_Image_Processing_in_Javascript&lt;/a&gt;.<br>
<br>
The&nbsp;script&nbsp;analyzes&nbsp;several&nbsp;images&nbsp;in&nbsp;parallel.&nbsp;For&nbsp;each&nbsp;image&nbsp;it&nbsp;loops&nbsp;over&nbsp;a<br>
few&nbsp;hundered&nbsp;cell&nbsp;clusters&nbsp;and&nbsp;analyzes&nbsp;the&nbsp;nuclei&nbsp;within&nbsp;using&nbsp;the<br>
ParticleAnalyzer.&nbsp;Most&nbsp;of&nbsp;the&nbsp;code&nbsp;seems&nbsp;to&nbsp;work&nbsp;fine,&nbsp;but&nbsp;within&nbsp;these&nbsp;few<br>
lines&nbsp;there&nbsp;is&nbsp;a&nbsp;problem:<br>
<br>
//&nbsp;now&nbsp;count&nbsp;and&nbsp;measure&nbsp;nuclei&nbsp;within<br>
var&nbsp;nucleiMeasurements&nbsp;=&nbsp;Measurements.AREA&nbsp;+&nbsp;Measurements.CIRCULARITY;<br>
var&nbsp;rt_nuclei&nbsp;=&nbsp;new&nbsp;ResultsTable();<br>
var&nbsp;nucleiPA&nbsp;=&nbsp;new&nbsp;ParticleAnalyzer(ParticleAnalyzer.SHOW_RESULTS&nbsp;+<br>
ParticleAnalyzer.ADD_TO_MANAGER&nbsp;+&nbsp;ParticleAnalyzer.CLEAR_WORKSHEET,<br>
nucleiMeasurements,&nbsp;rt_nuclei,&nbsp;nucleusMinSize,&nbsp;nucleusMaxSize,<br>
nucleusMinRoundness,&nbsp;1);<br>
var&nbsp;nuclei_manager&nbsp;=&nbsp;new&nbsp;RoiManager(true);&nbsp;<br>
nucleiPA.setRoiManager(nuclei_manager);<br>
nucleiPA.analyze(dapiImg);<br>
IJ.log(&quot;rt:&nbsp;&quot;+&nbsp;rt_nuclei.getCounter()&nbsp;+&nbsp;&quot;&nbsp;rm:&nbsp;&quot;&nbsp;+&nbsp;&nbsp;nuclei_manager.getCount());<br>
var&nbsp;nNuclei&nbsp;=&nbsp;rt_nuclei.getCounter();<br>
if(nNuclei&nbsp;!=&nbsp;nuclei_manager.getCount())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;this&nbsp;happens&nbsp;only&nbsp;if&nbsp;the&nbsp;script&nbsp;runs&nbsp;multithreaded.&nbsp;???<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IJ.log(&quot;number&nbsp;of&nbsp;nuclei&nbsp;!=&nbsp;number&nbsp;of&nbsp;ROIS&nbsp;!!!!:&nbsp;&quot;+image+&quot;&nbsp;&quot;+i+&quot;,&nbsp;nNuclei<br>
&quot;+nNuclei+&quot;,&nbsp;nucleiRoisLength&nbsp;&quot;+nuclei_manager.getCount());<br>
}<br>
<br>
Maybe&nbsp;I'm&nbsp;doing&nbsp;something&nbsp;stupid&nbsp;here,&nbsp;but&nbsp;it&nbsp;seems&nbsp;to&nbsp;work&nbsp;perfectly&nbsp;if<br>
running&nbsp;single&nbsp;threaded.&nbsp;The&nbsp;number&nbsp;of&nbsp;ROIs&nbsp;in&nbsp;the&nbsp;manager&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the<br>
number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;results&nbsp;table.&nbsp;But&nbsp;whenever&nbsp;I&nbsp;run&nbsp;this&nbsp;multithreaded<br>
it&nbsp;fails&nbsp;in&nbsp;one&nbsp;out&nbsp;of&nbsp;a&nbsp;few&nbsp;hundered&nbsp;cell&nbsp;clusters.<br>
<br>
Tested&nbsp;with&nbsp;current&nbsp;Fiji&nbsp;on&nbsp;Linux&nbsp;and&nbsp;Windows&nbsp;as&nbsp;well&nbsp;as&nbsp;with&nbsp;older&nbsp;versions&nbsp;of<br>
Fiji.<br>
<br>
Thanks<br>
<br>
Thomas<br>
<br>
Information&nbsp;about&nbsp;your&nbsp;version&nbsp;of&nbsp;Java:<br>
<br>
&nbsp;&nbsp;os.arch&nbsp;=&gt;&nbsp;amd64<br>
&nbsp;&nbsp;os.name&nbsp;=&gt;&nbsp;Linux<br>
&nbsp;&nbsp;os.version&nbsp;=&gt;&nbsp;3.4.63-2.44-desktop<br>
&nbsp;&nbsp;java.version&nbsp;=&gt;&nbsp;1.6.0_24<br>
&nbsp;&nbsp;java.vendor&nbsp;=&gt;&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
&nbsp;&nbsp;java.runtime.name&nbsp;=&gt;&nbsp;Java(TM)&nbsp;SE&nbsp;Runtime&nbsp;Environment<br>
&nbsp;&nbsp;java.runtime.version&nbsp;=&gt;&nbsp;1.6.0_24-b07<br>
&nbsp;&nbsp;java.vm.name&nbsp;=&gt;&nbsp;Java&nbsp;HotSpot(TM)&nbsp;64-Bit&nbsp;Server&nbsp;VM<br>
&nbsp;&nbsp;java.vm.version&nbsp;=&gt;&nbsp;19.1-b02<br>
&nbsp;&nbsp;java.vm.vendor&nbsp;=&gt;&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
&nbsp;&nbsp;java.vm.info&nbsp;=&gt;&nbsp;mixed&nbsp;mode<br>
&nbsp;&nbsp;java.awt.graphicsenv&nbsp;=&gt;&nbsp;sun.awt.X11GraphicsEnvironment<br>
&nbsp;&nbsp;java.specification.name&nbsp;=&gt;&nbsp;Java&nbsp;Platform&nbsp;API&nbsp;Specification<br>
&nbsp;&nbsp;java.specification.version&nbsp;=&gt;&nbsp;1.6<br>
&nbsp;&nbsp;sun.cpu.endian&nbsp;=&gt;&nbsp;little<br>
&nbsp;&nbsp;sun.desktop&nbsp;=&gt;&nbsp;null<br>
&nbsp;&nbsp;file.separator&nbsp;=&gt;&nbsp;/<br>
<br>
The&nbsp;up-to-date&nbsp;check&nbsp;says:&nbsp;REMIND_LATER<br>
<br>
Information&nbsp;relevant&nbsp;to&nbsp;JAVA_HOME&nbsp;related&nbsp;problems:<br>
<br>
&nbsp;&nbsp;JAVA_HOME&nbsp;is&nbsp;set&nbsp;to:<br>
/usr/local/src/Fiji.app/java/linux-amd64/jdk1.6.0_24//jre<br>
&nbsp;&nbsp;imagej.dir&nbsp;=&gt;&nbsp;/usr/local/src/Fiji.app<br>
<br>
Information&nbsp;about&nbsp;the&nbsp;version&nbsp;of&nbsp;each&nbsp;plugin:<br>
<br>
Activated&nbsp;update&nbsp;sites:<br>
ImageJ:&nbsp;&lt;a&nbsp;href=&quot;http://update.imagej.net/&quot;&gt;http://update.imagej.net/&lt;/a&gt;&nbsp;(last&nbsp;check:20140712000647)<br>
Fiji:&nbsp;&lt;a&nbsp;href=&quot;http://fiji.sc/update/&quot;&gt;http://fiji.sc/update/&lt;/a&gt;&nbsp;(last&nbsp;check:20140715020940)<br>
<br>
Files&nbsp;not&nbsp;up-to-date:<br>
&nbsp;&nbsp;9dda14a8&nbsp;(LOCAL_ONLY)&nbsp;20100729201826&nbsp;macros/js/AA_README.txt<br>
&nbsp;&nbsp;20e2cec7&nbsp;(LOCAL_ONLY)&nbsp;20140207105410&nbsp;plugins/ICTN_1_6_.jar<br>
&nbsp;&nbsp;d3260180&nbsp;(LOCAL_ONLY)&nbsp;20110303204101&nbsp;scripts/Record_Desktop.py<br>
&nbsp;&nbsp;0ea7f8fc&nbsp;(LOCAL_ONLY)&nbsp;20110303204101&nbsp;scripts/Record_Window.py&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;You&nbsp;are&nbsp;receiving&nbsp;this&nbsp;mail&nbsp;because:&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;You&nbsp;are&nbsp;the&nbsp;assignee&nbsp;for&nbsp;the&nbsp;bug.&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
