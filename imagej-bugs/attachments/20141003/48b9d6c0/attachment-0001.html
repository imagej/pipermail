<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;href=&quot;http://fiji.sc/bugzilla/&quot;&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;&lt;table&nbsp;border=&quot;1&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Bug&nbsp;ID&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_NEW&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;NEW&nbsp;-&nbsp;Bug&nbsp;in&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;of&nbsp;threshold&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=938&quot;&gt;938&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Summary&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Bug&nbsp;in&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;of&nbsp;threshold<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Product&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Fiji<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Version&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;unspecified<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Hardware&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;PC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;OS&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Windows<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Status&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;NEW<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Severity&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;normal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Priority&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;P4<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Component&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Plugins<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Assignee&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;imagej-bugs&#64;imagej.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Reporter&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;gadea.mata&#64;unirioja.es<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;CC&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;gadea.mata&#64;unirioja.es<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;&lt;/table&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;Dear&nbsp;all,<br>
<br>
We're&nbsp;looking&nbsp;for&nbsp;what&nbsp;is&nbsp;the&nbsp;best&nbsp;threshold&nbsp;algorithm&nbsp;for&nbsp;our&nbsp;images.&nbsp;We've<br>
seen&nbsp;that&nbsp;if&nbsp;we&nbsp;use&nbsp;the&nbsp;function&nbsp;&quot;Auto&nbsp;Threshold&quot;&nbsp;to&nbsp;obtain&nbsp;the&nbsp;differents<br>
threshold&nbsp;values&nbsp;for&nbsp;each&nbsp;algortithm,&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;returns&nbsp;a<br>
different&nbsp;threshold&nbsp;value,&nbsp;that&nbsp;if&nbsp;we&nbsp;use&nbsp;the&nbsp;function&nbsp;&quot;Threshold...&quot;&nbsp;choosing<br>
the&nbsp;Intermodes&nbsp;method.<br>
<br>
We've&nbsp;studied&nbsp;the&nbsp;code&nbsp;of&nbsp;both&nbsp;algorithms,&nbsp;and&nbsp;we&nbsp;think&nbsp;that&nbsp;the&nbsp;algorithm<br>
developed&nbsp;in&nbsp;the&nbsp;plugin&nbsp;&quot;Threshold...&quot;&nbsp;has&nbsp;a&nbsp;bug.&nbsp;We've&nbsp;studied&nbsp;the&nbsp;code<br>
available&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;http://imagej.nih.gov/ij/source/ij/process/AutoThresholder.java&quot;&gt;http://imagej.nih.gov/ij/source/ij/process/AutoThresholder.java&lt;/a&gt;,<br>
and&nbsp;we&nbsp;think&nbsp;that&nbsp;the&nbsp;problem&nbsp;arises&nbsp;in&nbsp;Line&nbsp;199&nbsp;of&nbsp;such&nbsp;a&nbsp;code.&nbsp;The&nbsp;loop&nbsp;in<br>
Line&nbsp;199&nbsp;concerns&nbsp;the&nbsp;computation&nbsp;of&nbsp;the&nbsp;new&nbsp;values&nbsp;of&nbsp;the&nbsp;histogram.&nbsp;For&nbsp;each<br>
step&nbsp;of&nbsp;the&nbsp;loop,&nbsp;the&nbsp;new&nbsp;value&nbsp;of&nbsp;the&nbsp;histogram&nbsp;is&nbsp;calculated&nbsp;using&nbsp;the&nbsp;values<br>
of&nbsp;the&nbsp;updated&nbsp;histogram&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;values&nbsp;of&nbsp;the&nbsp;original&nbsp;histogram.&nbsp;<br>
<br>
However,&nbsp;the&nbsp;Intermodes&nbsp;algorithm&nbsp;in&nbsp;the&nbsp;plugin&nbsp;&quot;Auto&nbsp;Thresholder&quot;&nbsp;is&nbsp;correct.<br>
<br>
We&nbsp;attached&nbsp;you&nbsp;a&nbsp;minimal&nbsp;macro&nbsp;that&nbsp;reproduces&nbsp;this&nbsp;bug:<br>
<br>
run(&quot;Neuron&nbsp;(1.6M,&nbsp;5&nbsp;channels)&quot;);<br>
run(&quot;Split&nbsp;Channels&quot;);<br>
//close&nbsp;all&nbsp;channels&nbsp;minus&nbsp;channel&nbsp;2<br>
selectWindow(&quot;C5-Rat_Hippocampal_Neuron.tif&quot;);<br>
close();<br>
selectWindow(&quot;C4-Rat_Hippocampal_Neuron.tif&quot;);<br>
close();<br>
selectWindow(&quot;C3-Rat_Hippocampal_Neuron.tif&quot;);<br>
close();<br>
selectWindow(&quot;C2-Rat_Hippocampal_Neuron.tif&quot;);<br>
selectWindow(&quot;C1-Rat_Hippocampal_Neuron.tif&quot;);<br>
close();<br>
selectWindow(&quot;C2-Rat_Hippocampal_Neuron.tif&quot;);<br>
//AUTO&nbsp;THRESHOLD<br>
run(&quot;Auto&nbsp;Threshold&quot;,&nbsp;&quot;method=[Try&nbsp;all]&nbsp;white&nbsp;show&quot;);<br>
//the&nbsp;threshold&nbsp;value&nbsp;of&nbsp;Intermodes&nbsp;method:&nbsp;525<br>
close();<br>
selectWindow(&quot;C2-Rat_Hippocampal_Neuron.tif&quot;);<br>
//THRESHOLD<br>
setAutoThreshold(&quot;Intermodes&nbsp;dark&quot;);<br>
//run(&quot;Threshold...&quot;);<br>
setThreshold(1713,&nbsp;6238);&nbsp;//here,&nbsp;the&nbsp;threshold&nbsp;value&nbsp;is&nbsp;1713<br>
run(&quot;Convert&nbsp;to&nbsp;Mask&quot;);<br>
run(&quot;Close&quot;);<br>
<br>
Best&nbsp;regards,<br>
<br>
--Gadea&nbsp;Mata&nbsp;Martínez<br>
&lt;a&nbsp;href=&quot;mailto:gadea.mata&#64;unirioja.es&quot;&gt;gadea.mata&#64;unirioja.es&lt;/a&gt;<br>
Department&nbsp;of&nbsp;Mathematics&nbsp;and&nbsp;Computer&nbsp;Science<br>
University&nbsp;of&nbsp;La&nbsp;Rioja<br>
Logroño,&nbsp;La&nbsp;Rioja&nbsp;(Spain)<br>
<br>
Information&nbsp;about&nbsp;your&nbsp;version&nbsp;of&nbsp;Java:<br>
<br>
&nbsp;&nbsp;os.arch&nbsp;=&gt;&nbsp;x86<br>
&nbsp;&nbsp;os.name&nbsp;=&gt;&nbsp;Windows&nbsp;7<br>
&nbsp;&nbsp;os.version&nbsp;=&gt;&nbsp;6.1<br>
&nbsp;&nbsp;java.version&nbsp;=&gt;&nbsp;1.6.0_24<br>
&nbsp;&nbsp;java.vendor&nbsp;=&gt;&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
&nbsp;&nbsp;java.runtime.name&nbsp;=&gt;&nbsp;Java(TM)&nbsp;SE&nbsp;Runtime&nbsp;Environment<br>
&nbsp;&nbsp;java.runtime.version&nbsp;=&gt;&nbsp;1.6.0_24-b07<br>
&nbsp;&nbsp;java.vm.name&nbsp;=&gt;&nbsp;Java&nbsp;HotSpot(TM)&nbsp;Client&nbsp;VM<br>
&nbsp;&nbsp;java.vm.version&nbsp;=&gt;&nbsp;19.1-b02<br>
&nbsp;&nbsp;java.vm.vendor&nbsp;=&gt;&nbsp;Sun&nbsp;Microsystems&nbsp;Inc.<br>
&nbsp;&nbsp;java.vm.info&nbsp;=&gt;&nbsp;mixed&nbsp;mode<br>
&nbsp;&nbsp;java.awt.graphicsenv&nbsp;=&gt;&nbsp;sun.awt.Win32GraphicsEnvironment<br>
&nbsp;&nbsp;java.specification.name&nbsp;=&gt;&nbsp;Java&nbsp;Platform&nbsp;API&nbsp;Specification<br>
&nbsp;&nbsp;java.specification.version&nbsp;=&gt;&nbsp;1.6<br>
&nbsp;&nbsp;sun.cpu.endian&nbsp;=&gt;&nbsp;little<br>
&nbsp;&nbsp;sun.desktop&nbsp;=&gt;&nbsp;windows<br>
&nbsp;&nbsp;file.separator&nbsp;=&gt;&nbsp;\<br>
<br>
The&nbsp;up-to-date&nbsp;check&nbsp;says:&nbsp;REMIND_LATER<br>
<br>
Information&nbsp;relevant&nbsp;to&nbsp;JAVA_HOME&nbsp;related&nbsp;problems:<br>
<br>
&nbsp;&nbsp;JAVA_HOME&nbsp;is&nbsp;set&nbsp;to:<br>
C:\Users\gamata\PROGRA~1\Fiji.app/java/win32/jdk1.6.0_24//jre<br>
&nbsp;&nbsp;imagej.dir&nbsp;=&gt;&nbsp;C:\Users\gamata\PROGRA~1\Fiji.app<br>
<br>
Information&nbsp;about&nbsp;the&nbsp;version&nbsp;of&nbsp;each&nbsp;plugin:<br>
<br>
Activated&nbsp;update&nbsp;sites:<br>
ImageJ:&nbsp;&lt;a&nbsp;href=&quot;http://update.imagej.net/&quot;&gt;http://update.imagej.net/&lt;/a&gt;&nbsp;(last&nbsp;check:20140925235708)<br>
Fiji:&nbsp;&lt;a&nbsp;href=&quot;http://fiji.sc/update/&quot;&gt;http://fiji.sc/update/&lt;/a&gt;&nbsp;(last&nbsp;check:20141002110637)&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;You&nbsp;are&nbsp;receiving&nbsp;this&nbsp;mail&nbsp;because:&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;You&nbsp;are&nbsp;the&nbsp;assignee&nbsp;for&nbsp;the&nbsp;bug.&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
