<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;href=&quot;http://fiji.sc/bugzilla/&quot;&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_NEEDSINFO&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;NEEDSINFO&nbsp;-&nbsp;Multithreading&nbsp;problem&nbsp;in&nbsp;javascript&nbsp;macro&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=854#c4&quot;&gt;Comment&nbsp;#&nbsp;4&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;&lt;a&nbsp;class=&quot;bz_bug_link&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bz_status_NEEDSINFO&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;title=&quot;NEEDSINFO&nbsp;-&nbsp;Multithreading&nbsp;problem&nbsp;in&nbsp;javascript&nbsp;macro&quot;<br>
&nbsp;&nbsp;&nbsp;href=&quot;http://fiji.sc/bugzilla/show_bug.cgi?id=854&quot;&gt;bug&nbsp;854&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&lt;span&nbsp;class=&quot;vcard&quot;&gt;&lt;a&nbsp;class=&quot;email&quot;&nbsp;href=&quot;mailto:thomas.siegmund&#64;evotec.com&quot;&nbsp;title=&quot;Thomas&nbsp;Siegmund&nbsp;&lt;thomas.siegmund&#64;evotec.com&gt;&quot;&gt;&nbsp;&lt;span&nbsp;class=&quot;fn&quot;&gt;Thomas&nbsp;Siegmund&lt;/span&gt;&lt;/a&gt;<br>
&lt;/span&gt;&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;Created&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;attachment.cgi?id=204&quot;&nbsp;name=&quot;attach_204&quot;&nbsp;title=&quot;test&nbsp;script&quot;&gt;attachment&nbsp;204&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;attachment.cgi?id=204&amp;action=edit&quot;&nbsp;title=&quot;test&nbsp;script&quot;&gt;[details]&lt;/a&gt;&lt;/span&gt;<br>
test&nbsp;script<br>
<br>
Not&nbsp;what&nbsp;I&nbsp;would&nbsp;call&nbsp;a&nbsp;minimal&nbsp;test&nbsp;case,&nbsp;but&nbsp;I&nbsp;have&nbsp;at&nbsp;least&nbsp;tried&nbsp;to&nbsp;trim&nbsp;<br>
it&nbsp;down&nbsp;to&nbsp;something&nbsp;reasonable.<br>
<br>
To&nbsp;reproduce&nbsp;the&nbsp;problem,&nbsp;please&nbsp;download&nbsp;a&nbsp;test&nbsp;image&nbsp;from&nbsp;Dropbox&nbsp;(60Mb&nbsp;tiff,<br>
too&nbsp;big&nbsp;to&nbsp;attach&nbsp;here):<br>
<br>
&lt;a&nbsp;href=&quot;https://www.dropbox.com/s/8nvb42a0hum8rjg/test_image.tiff&quot;&gt;https://www.dropbox.com/s/8nvb42a0hum8rjg/test_image.tiff&lt;/a&gt;&nbsp;<br>
<br>
Put&nbsp;the&nbsp;image&nbsp;in&nbsp;an&nbsp;otherwise&nbsp;empty&nbsp;directory,&nbsp;run&nbsp;&quot;multithreading-bug_ij.js&quot;.<br>
<br>
The&nbsp;script&nbsp;will&nbsp;ask&nbsp;for&nbsp;the&nbsp;image&nbsp;directory&nbsp;and&nbsp;open&nbsp;results&nbsp;and&nbsp;log&nbsp;windows.<br>
it&nbsp;will&nbsp;then&nbsp;analyze&nbsp;the&nbsp;image&nbsp;once&nbsp;single&nbsp;threaded&nbsp;and&nbsp;then&nbsp;twice<br>
multithreaded.&nbsp;On&nbsp;my&nbsp;systems&nbsp;in&nbsp;multithreaded&nbsp;mode&nbsp;it&nbsp;will&nbsp;log&nbsp;the&nbsp;error&nbsp;from<br>
line&nbsp;296&nbsp;usually&nbsp;several&nbsp;times:<br>
<br>
&nbsp;ERROR:&nbsp;number&nbsp;of&nbsp;nuclei&nbsp;!=&nbsp;number&nbsp;of&nbsp;ROIS&nbsp;!!!!:&nbsp;test_image.tiff&nbsp;109,&nbsp;nNuclei<br>
0,&nbsp;nucleiRoisLength&nbsp;1<br>
<br>
The&nbsp;number&nbsp;and&nbsp;details&nbsp;of&nbsp;the&nbsp;errors&nbsp;will&nbsp;vary&nbsp;from&nbsp;run&nbsp;to&nbsp;run.<br>
<br>
Multithreading&nbsp;can&nbsp;be&nbsp;switched&nbsp;off&nbsp;completely&nbsp;in&nbsp;line&nbsp;66.&nbsp;In&nbsp;this&nbsp;mode&nbsp;I&nbsp;have<br>
never&nbsp;seen&nbsp;a&nbsp;problem&nbsp;with&nbsp;the&nbsp;analysis.<br>
<br>
Best<br>
<br>
Thomas&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;You&nbsp;are&nbsp;receiving&nbsp;this&nbsp;mail&nbsp;because:&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;You&nbsp;are&nbsp;the&nbsp;assignee&nbsp;for&nbsp;the&nbsp;bug.&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
