<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;Hadrien,&lt;br&gt;&lt;br&gt;&gt;My&nbsp;hypothesis&nbsp;is&nbsp;that&nbsp;when&nbsp;loading&nbsp;an&nbsp;image,&nbsp;Fiji/SCIFIO&nbsp;look&nbsp;at&nbsp;free&lt;br&gt;<br>
&gt;memory&nbsp;in&nbsp;the&nbsp;system&nbsp;but&nbsp;not&nbsp;in&nbsp;the&nbsp;JVM.&nbsp;Is&nbsp;that&nbsp;possible&nbsp;?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Yes,&nbsp;this&nbsp;is&nbsp;almost&nbsp;certainly&nbsp;what&#39;s&nbsp;happening.&nbsp;Unfortunately&nbsp;I&nbsp;am&nbsp;not&nbsp;aware&nbsp;of&nbsp;a&nbsp;way&nbsp;to&nbsp;differentiate&nbsp;between&nbsp;memory&nbsp;that&nbsp;is&nbsp;still&nbsp;in&nbsp;use,&nbsp;and&nbsp;memory&nbsp;that&nbsp;just&nbsp;hasn&#39;t&nbsp;been&nbsp;deallocated.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By&nbsp;default&nbsp;in&nbsp;these&nbsp;situations&nbsp;SCIFIO&nbsp;will&nbsp;look&nbsp;at&nbsp;the&nbsp;available&nbsp;memory,&nbsp;see&nbsp;that&nbsp;there&#39;s&nbsp;not&nbsp;enough&nbsp;to&nbsp;open&nbsp;the&nbsp;dataset&nbsp;and&nbsp;open&nbsp;it&nbsp;virtually.&nbsp;Note&nbsp;that&nbsp;it&nbsp;actually&nbsp;would&nbsp;be&nbsp;possible&nbsp;to&nbsp;open&nbsp;the&nbsp;full&nbsp;dataset&nbsp;-&nbsp;as&nbsp;the&nbsp;memory&nbsp;allocation&nbsp;approached&nbsp;the&nbsp;JVM&#39;s&nbsp;limit,&nbsp;it&nbsp;would&nbsp;automatically&nbsp;be&nbsp;released.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right&nbsp;now&nbsp;this&nbsp;can&nbsp;be&nbsp;worked&nbsp;around&nbsp;programmatically&nbsp;by&nbsp;specifying&nbsp;a&nbsp;PLANAR&nbsp;or&nbsp;ARRAY[1]&nbsp;ImgMode&nbsp;in&nbsp;the&nbsp;SCIFIOConfig[2].&nbsp;The&nbsp;Bio-Formats&nbsp;importer&nbsp;lets&nbsp;you&nbsp;specify&nbsp;whether&nbsp;the&nbsp;image&nbsp;should&nbsp;be&nbsp;opened&nbsp;virtually&nbsp;or&nbsp;not.&nbsp;The&nbsp;only&nbsp;other&nbsp;option&nbsp;is&nbsp;to&nbsp;click&nbsp;the&nbsp;status&nbsp;bar&nbsp;to&nbsp;force&nbsp;garbage&nbsp;collection.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;also&nbsp;have&nbsp;plans&nbsp;to&nbsp;improve&nbsp;the&nbsp;SCIFIO&nbsp;importer[3]&nbsp;to&nbsp;expose&nbsp;these&nbsp;settings&nbsp;in&nbsp;the&nbsp;UI.&nbsp;Ultimately&nbsp;the&nbsp;hope&nbsp;is&nbsp;that&nbsp;virtual&nbsp;(cell)&nbsp;images&nbsp;will&nbsp;incur&nbsp;minimal&nbsp;performance&nbsp;penalties&nbsp;though[4],&nbsp;making&nbsp;this&nbsp;issue&nbsp;moot.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;Mark&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;[1]&nbsp;&lt;a&nbsp;href=&quot;https://github.com/scifio/scifio/blob/scifio-0.21.1/src/main/java/io/scif/config/SCIFIOConfig.java#L124&quot;&gt;https://github.com/scifio/scifio/blob/scifio-0.21.1/src/main/java/io/scif/config/SCIFIOConfig.java#L124&lt;/a&gt;&lt;br&gt;[2]&nbsp;&lt;a&nbsp;href=&quot;https://github.com/scifio/scifio/blob/scifio-0.21.1/src/main/java/io/scif/config/SCIFIOConfig.java#L370-373&quot;&gt;https://github.com/scifio/scifio/blob/scifio-0.21.1/src/main/java/io/scif/config/SCIFIOConfig.java#L370-373&lt;/a&gt;&lt;br&gt;[3]&nbsp;&lt;a&nbsp;href=&quot;https://github.com/imagej/imagej-plugins-commands/issues/4&quot;&gt;https://github.com/imagej/imagej-plugins-commands/issues/4&lt;/a&gt;&lt;br&gt;[4]&nbsp;&lt;a&nbsp;href=&quot;https://github.com/scifio/scifio/issues/201&quot;&gt;https://github.com/scifio/scifio/issues/201&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;26,&nbsp;2015&nbsp;at&nbsp;5:57&nbsp;AM,&nbsp;Hadrien&nbsp;Mary&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:hadrien.mary@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;hadrien.mary@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
New&nbsp;SCIFIO&nbsp;I/O&nbsp;system&nbsp;in&nbsp;Fiji/IJ2&nbsp;automatically&nbsp;detects&nbsp;wether&nbsp;virtual&lt;br&gt;<br>
stack&nbsp;is&nbsp;needed&nbsp;according&nbsp;to&nbsp;system&nbsp;memory&nbsp;available&nbsp;and&nbsp;image&nbsp;size&lt;br&gt;<br>
(if&nbsp;I&nbsp;understood&nbsp;correctly).&lt;br&gt;<br>
&lt;br&gt;<br>
Virtual&nbsp;stack&nbsp;is&nbsp;fine&nbsp;but&nbsp;it&nbsp;always&nbsp;better&nbsp;to&nbsp;work&nbsp;without&nbsp;when&nbsp;you&lt;br&gt;<br>
can.&nbsp;For&nbsp;example&nbsp;working&nbsp;with&nbsp;timelapse&nbsp;stacks,&nbsp;sliding&nbsp;time&nbsp;is&nbsp;much&lt;br&gt;<br>
faster&nbsp;when&nbsp;image&nbsp;is&nbsp;not&nbsp;a&nbsp;virtual&nbsp;stack&nbsp;(and&nbsp;it&nbsp;makes&nbsp;sense&nbsp;since&nbsp;RAM&lt;br&gt;<br>
memory&nbsp;access&nbsp;is&nbsp;much&nbsp;faster&nbsp;than&nbsp;hard&nbsp;drive&nbsp;memory&nbsp;access...).&lt;br&gt;<br>
&lt;br&gt;<br>
Saying&nbsp;that&nbsp;I&nbsp;noticed&nbsp;something:&nbsp;when&nbsp;I&nbsp;close&nbsp;a&nbsp;big&nbsp;image&nbsp;(no&nbsp;virtual&lt;br&gt;<br>
stack&nbsp;because&nbsp;moving&nbsp;time&nbsp;slider&nbsp;is&nbsp;fast),&nbsp;java&nbsp;does&nbsp;not&nbsp;release&lt;br&gt;<br>
memory&nbsp;to&nbsp;system&nbsp;(and&nbsp;it&#39;s&nbsp;a&nbsp;normal&nbsp;behaviour&nbsp;according&nbsp;to&nbsp;this&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://stackoverflow.com/questions/22912063/automatically-release-unused-memory-in-imagej-fiji&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stackoverflow.com/questions/22912063/automatically-release-unused-memory-in-imagej-fiji&lt;/a&gt;).&lt;br&gt;<br>
Now&nbsp;when&nbsp;I&nbsp;load&nbsp;the&nbsp;same&nbsp;kind&nbsp;of&nbsp;image&nbsp;(same&nbsp;size),&nbsp;the&nbsp;JVM&nbsp;should&nbsp;use&lt;br&gt;<br>
the&nbsp;free&nbsp;memory&nbsp;released&nbsp;by&nbsp;the&nbsp;previously&nbsp;closed&nbsp;image&nbsp;isn&#39;t&nbsp;it&nbsp;?&nbsp;I&lt;br&gt;<br>
have&nbsp;the&nbsp;feeling&nbsp;that&nbsp;it&nbsp;does&nbsp;not&nbsp;because,&nbsp;when&nbsp;I&nbsp;move&nbsp;the&nbsp;time&nbsp;slider&lt;br&gt;<br>
on&nbsp;the&nbsp;second&nbsp;image,&nbsp;it&#39;s&nbsp;very&nbsp;slow....&lt;br&gt;<br>
&lt;br&gt;<br>
Some&nbsp;numbers:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;image&nbsp;size&nbsp;:&nbsp;4.6GB&lt;br&gt;<br>
-&nbsp;Fiji&nbsp;memory&nbsp;after&nbsp;start&nbsp;:&nbsp;0.3GB&lt;br&gt;<br>
-&nbsp;Fiji&nbsp;memory&nbsp;after&nbsp;loading&nbsp;first&nbsp;image:&nbsp;6.9GiB&lt;br&gt;<br>
-&nbsp;Fiji&nbsp;memory&nbsp;after&nbsp;closing&nbsp;first&nbsp;image:&nbsp;6.9GiB&lt;br&gt;<br>
-&nbsp;Fiji&nbsp;memory&nbsp;after&nbsp;loading&nbsp;second&nbsp;image:&nbsp;6.9GiB&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;hypothesis&nbsp;is&nbsp;that&nbsp;when&nbsp;loading&nbsp;an&nbsp;image,&nbsp;Fiji/SCIFIO&nbsp;look&nbsp;at&nbsp;free&lt;br&gt;<br>
memory&nbsp;in&nbsp;the&nbsp;system&nbsp;but&nbsp;not&nbsp;in&nbsp;the&nbsp;JVM.&nbsp;Is&nbsp;that&nbsp;possible&nbsp;?&nbsp;Did&nbsp;you&lt;br&gt;<br>
already&nbsp;noticed&nbsp;that&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
PS:&nbsp;I&nbsp;have&nbsp;attached&nbsp;to&nbsp;this&nbsp;mail&nbsp;some&nbsp;properties&nbsp;of&nbsp;my&nbsp;system.&lt;br&gt;<br>
&lt;br&gt;<br>
Best,&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
Hadrien&nbsp;Mary&lt;br&gt;<br>
&lt;br&gt;<br>
Ph.D&nbsp;student&nbsp;in&nbsp;Biology&lt;br&gt;<br>
Tournier-Gachet&nbsp;Team&lt;br&gt;<br>
CNRS&nbsp;-&nbsp;LBCMCP&nbsp;-&nbsp;UMR&nbsp;5088&lt;br&gt;<br>
&lt;br&gt;<br>
Université&nbsp;de&nbsp;Toulouse&nbsp;-&nbsp;Bât.&nbsp;4R3B1&lt;br&gt;<br>
118,&nbsp;route&nbsp;de&nbsp;Narbonne&nbsp;-&nbsp;31062&nbsp;Toulouse&lt;br&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
ImageJ-devel&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:ImageJ-devel@imagej.net&quot;&gt;ImageJ-devel@imagej.net&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://imagej.net/mailman/listinfo/imagej-devel&quot;&nbsp;target=&quot;_blank&quot;&gt;http://imagej.net/mailman/listinfo/imagej-devel&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
