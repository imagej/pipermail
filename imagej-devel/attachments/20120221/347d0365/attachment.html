<tt>
Hi&nbsp;everyone,&lt;br&gt;&lt;br&gt;Dscho&nbsp;and&nbsp;I&nbsp;have&nbsp;been&nbsp;discussing&nbsp;the&nbsp;ShadowMenu&nbsp;design,&nbsp;and&nbsp;we&nbsp;have&nbsp;a&nbsp;plans&nbsp;for&nbsp;several&nbsp;improvements:&lt;br&gt;&lt;br&gt;Multiple&nbsp;menu&nbsp;bars&nbsp;are&nbsp;not&nbsp;synced&nbsp;properly:&lt;br&gt; &nbsp;&lt;a&nbsp;href=&quot;http://code.imagej.net/trac/imagej/ticket/985&quot;&gt;http://code.imagej.net/trac/imagej/ticket/985&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
More&nbsp;context&nbsp;sensitivity&nbsp;is&nbsp;required&nbsp;for&nbsp;modules&nbsp;in&nbsp;menus:&lt;br&gt; &nbsp;&lt;a&nbsp;href=&quot;http://code.imagej.net/trac/imagej/ticket/987&quot;&gt;http://code.imagej.net/trac/imagej/ticket/987&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
<br>
More&nbsp;intelligent&nbsp;syncing&nbsp;between&nbsp;ShadowMenu&nbsp;and&nbsp;UI-specific&nbsp;menus:&lt;br&gt; &nbsp;&lt;a&nbsp;href=&quot;http://code.imagej.net/trac/imagej/ticket/988&quot;&gt;http://code.imagej.net/trac/imagej/ticket/988&lt;/a&gt;&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
<br>
<br>
it&nbsp;appears&nbsp;to&nbsp;me&nbsp;that&nbsp;AbstractSwingUI&nbsp;might&nbsp;be&nbsp;a&nbsp;bit&nbsp;too&nbsp;limiting&nbsp;at&nbsp;the&lt;br&gt;<br>
moment&nbsp;with&nbsp;its&nbsp;builtin&nbsp;assumption&nbsp;that&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;appFrame&nbsp;and&lt;br&gt;<br>
that&nbsp;all&nbsp;menu&nbsp;item&nbsp;changes&nbsp;should&nbsp;be&nbsp;applied&nbsp;to&nbsp;that&nbsp;appFrame&amp;#39;s&lt;br&gt;<br>
application&nbsp;menu&nbsp;bar.&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
<br>
<br>
So&nbsp;now&nbsp;I&nbsp;face&nbsp;the&nbsp;problematic&nbsp;situation&nbsp;where&nbsp;method&nbsp;calls&nbsp;to&nbsp;a&nbsp;ShadowMenu&lt;br&gt;<br>
(which&nbsp;was&nbsp;already&nbsp;connected&nbsp;to&nbsp;a&nbsp;given&nbsp;JMenuBar&nbsp;using&nbsp;the&lt;br&gt;<br>
SwingJMenuBarCreator&nbsp;--&nbsp;why&nbsp;are&nbsp;there&nbsp;so&nbsp;many&nbsp;layers&nbsp;BTW?&lt;br&gt;<br>
AbstractMenuCreator&amp;gt;AbstractSwingMenuCreator&amp;gt;SwingJMenuBarCreator?)&nbsp;are&lt;br&gt;<br>
always&nbsp;redirected&nbsp;to&nbsp;the&nbsp;IJ2&nbsp;menu&nbsp;bar&nbsp;--&nbsp;which&nbsp;is&nbsp;bad&nbsp;when&nbsp;you&nbsp;want&nbsp;them&lt;br&gt;<br>
to&nbsp;appear&nbsp;in&nbsp;the&nbsp;Script&nbsp;Editor&amp;#39;s&nbsp;menu&nbsp;bar.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Yes,&nbsp;hopefully&nbsp;addressing&nbsp;ticket&nbsp;#988&nbsp;will&nbsp;solve&nbsp;this&nbsp;problem.&lt;br&gt;&lt;br&gt;Regarding&nbsp;the&nbsp;layers,&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;any&nbsp;curious&nbsp;lurkers:&nbsp;there&nbsp;is&nbsp;an&nbsp;unfortunate&nbsp;extra&nbsp;layer&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;to&nbsp;work&nbsp;around&nbsp;the&nbsp;fact&nbsp;that&nbsp;both&nbsp;Swing&nbsp;and&nbsp;AWT&nbsp;menu&nbsp;classes&nbsp;do&nbsp;not&nbsp;implement&nbsp;common&nbsp;interfaces&nbsp;where&nbsp;their&nbsp;methods&nbsp;overlap.&nbsp;For&nbsp;example,&nbsp;all&nbsp;three&nbsp;of&nbsp;JMenuBar,&nbsp;JMenu&nbsp;and&nbsp;JPopupMenu&nbsp;implement&nbsp;the&nbsp;common&nbsp;method&nbsp;add(JMenuItem)&nbsp;but&nbsp;there&nbsp;is&nbsp;no&nbsp;common&nbsp;superclass&nbsp;or&nbsp;superinterface&nbsp;containing&nbsp;this&nbsp;method&nbsp;which&nbsp;can&nbsp;be&nbsp;used&nbsp;in&nbsp;our&nbsp;code.&nbsp;So&nbsp;in&nbsp;short,&nbsp;we&nbsp;need&nbsp;separate&nbsp;JMenuBarCreator,&nbsp;JMenuCreator&nbsp;and&nbsp;JPopupMenuCreator&nbsp;classes.&nbsp;To&nbsp;maintain&nbsp;DRYness&nbsp;(Don&amp;#39;t&nbsp;Repeat&nbsp;Yourself!)&nbsp;of&nbsp;code,&nbsp;there&nbsp;is&nbsp;an&nbsp;AbstractSwingMenuCreator&nbsp;class&nbsp;which&nbsp;provides&nbsp;most&nbsp;of&nbsp;the&nbsp;needed&nbsp;code,&nbsp;leaving&nbsp;the&nbsp;aforementioned&nbsp;three&nbsp;subclasses&nbsp;to&nbsp;implement&nbsp;a&nbsp;couple&nbsp;of&nbsp;remaining&nbsp;methods.&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;Lastly,&nbsp;the&nbsp;overlong&nbsp;names&nbsp;are&nbsp;to&nbsp;avoid&nbsp;name&nbsp;clashes&nbsp;between&nbsp;classes.&nbsp;We&nbsp;have&nbsp;made&nbsp;an&nbsp;effort&nbsp;in&nbsp;ImageJ2&nbsp;to&nbsp;avoid&nbsp;having&nbsp;two&nbsp;classes&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;in&nbsp;different&nbsp;packages.&nbsp;For&nbsp;example,&nbsp;for&nbsp;brevity&nbsp;we&nbsp;could&nbsp;have&nbsp;imagej.ext.ui.swing.MenuCreator&nbsp;and&nbsp;imagej.ext.ui.awt.MenuCreator,&nbsp;both&nbsp;of&nbsp;which&nbsp;implement&nbsp;imagej.ext.menu.MenuCreator.&nbsp;But&nbsp;that&nbsp;would&nbsp;be&nbsp;quite&nbsp;confusing.&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;Swing&nbsp;we&nbsp;could&nbsp;call&nbsp;the&nbsp;implementation&nbsp;e.g.&nbsp;JMenuCreator&nbsp;rather&nbsp;than&nbsp;SwingJMenuCreator.&nbsp;However,&nbsp;that&nbsp;would&nbsp;not&nbsp;work&nbsp;for&nbsp;AWT,&nbsp;which&nbsp;would&nbsp;simply&nbsp;be&nbsp;&amp;quot;MenuCreator&amp;quot;&nbsp;again,&nbsp;hence&nbsp;a&nbsp;name&nbsp;clash,&nbsp;so&nbsp;we&nbsp;chose&nbsp;AWTMenuCreator&nbsp;instead.&nbsp;For&nbsp;consistency,&nbsp;all&nbsp;the&nbsp;Swing&nbsp;stuff&nbsp;is&nbsp;generally&nbsp;called&nbsp;&amp;quot;SwingThisOrThat&amp;quot;&nbsp;with&nbsp;AWT&nbsp;called&nbsp;&amp;quot;AWTThisOrThat&amp;quot;&nbsp;and&nbsp;so&nbsp;on.&nbsp;If&nbsp;people&nbsp;strongly&nbsp;dislike&nbsp;these&nbsp;names,&nbsp;we&nbsp;welcome&nbsp;alternative&nbsp;suggestions.&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
Now,&nbsp;the&nbsp;MenuEvent&nbsp;knows&nbsp;pretty&nbsp;well&nbsp;which&nbsp;ShadowMenu&nbsp;it&nbsp;belongs&nbsp;to,&nbsp;but&lt;br&gt;<br>
apparently&nbsp;no&nbsp;class&nbsp;feels&nbsp;responsible&nbsp;to&nbsp;retain&nbsp;the&nbsp;connection&nbsp;between&nbsp;the&lt;br&gt;<br>
ShadowMenu&nbsp;and&nbsp;the&nbsp;SwingJMenuBarCreator&nbsp;used&nbsp;to&nbsp;turn&nbsp;this&nbsp;into&nbsp;an&lt;br&gt;<br>
instance.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Right,&nbsp;ticket&nbsp;#988:&nbsp;maintain&nbsp;that&nbsp;connection.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
<br>
<br>
Consequently,&nbsp;I&nbsp;do&nbsp;not&nbsp;see&nbsp;where&nbsp;it&nbsp;was&nbsp;intended&nbsp;to&nbsp;resolve&nbsp;this&nbsp;issue&lt;br&gt;<br>
(this&nbsp;is&nbsp;related&nbsp;to&nbsp;the&nbsp;wasteful&nbsp;recreation&nbsp;of&nbsp;a&nbsp;complete&nbsp;menu&nbsp;bar&lt;br&gt;<br>
whenever&nbsp;anything&nbsp;changed&nbsp;in&nbsp;any&nbsp;menu&nbsp;item).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Hopefully&nbsp;those&nbsp;tickets&nbsp;clarify&nbsp;the&nbsp;direction&nbsp;we&nbsp;are&nbsp;going&nbsp;with&nbsp;the&nbsp;menu&nbsp;system.&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Curtis&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
<br>
On&nbsp;Mon,&nbsp;Feb&nbsp;6,&nbsp;2012&nbsp;at&nbsp;7:52&nbsp;PM,&nbsp;Johannes&nbsp;Schindelin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:schindelin@wisc.edu&quot;&gt;schindelin@wisc.edu&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
it&nbsp;appears&nbsp;to&nbsp;me&nbsp;that&nbsp;AbstractSwingUI&nbsp;might&nbsp;be&nbsp;a&nbsp;bit&nbsp;too&nbsp;limiting&nbsp;at&nbsp;the&lt;br&gt;<br>
moment&nbsp;with&nbsp;its&nbsp;builtin&nbsp;assumption&nbsp;that&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;appFrame&nbsp;and&lt;br&gt;<br>
that&nbsp;all&nbsp;menu&nbsp;item&nbsp;changes&nbsp;should&nbsp;be&nbsp;applied&nbsp;to&nbsp;that&nbsp;appFrame&amp;#39;s&lt;br&gt;<br>
application&nbsp;menu&nbsp;bar.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;now&nbsp;I&nbsp;face&nbsp;the&nbsp;problematic&nbsp;situation&nbsp;where&nbsp;method&nbsp;calls&nbsp;to&nbsp;a&nbsp;ShadowMenu&lt;br&gt;<br>
(which&nbsp;was&nbsp;already&nbsp;connected&nbsp;to&nbsp;a&nbsp;given&nbsp;JMenuBar&nbsp;using&nbsp;the&lt;br&gt;<br>
SwingJMenuBarCreator&nbsp;--&nbsp;why&nbsp;are&nbsp;there&nbsp;so&nbsp;many&nbsp;layers&nbsp;BTW?&lt;br&gt;<br>
AbstractMenuCreator&amp;gt;AbstractSwingMenuCreator&amp;gt;SwingJMenuBarCreator?)&nbsp;are&lt;br&gt;<br>
always&nbsp;redirected&nbsp;to&nbsp;the&nbsp;IJ2&nbsp;menu&nbsp;bar&nbsp;--&nbsp;which&nbsp;is&nbsp;bad&nbsp;when&nbsp;you&nbsp;want&nbsp;them&lt;br&gt;<br>
to&nbsp;appear&nbsp;in&nbsp;the&nbsp;Script&nbsp;Editor&amp;#39;s&nbsp;menu&nbsp;bar.&lt;br&gt;<br>
&lt;br&gt;<br>
Now,&nbsp;the&nbsp;MenuEvent&nbsp;knows&nbsp;pretty&nbsp;well&nbsp;which&nbsp;ShadowMenu&nbsp;it&nbsp;belongs&nbsp;to,&nbsp;but&lt;br&gt;<br>
apparently&nbsp;no&nbsp;class&nbsp;feels&nbsp;responsible&nbsp;to&nbsp;retain&nbsp;the&nbsp;connection&nbsp;between&nbsp;the&lt;br&gt;<br>
ShadowMenu&nbsp;and&nbsp;the&nbsp;SwingJMenuBarCreator&nbsp;used&nbsp;to&nbsp;turn&nbsp;this&nbsp;into&nbsp;an&lt;br&gt;<br>
instance.&lt;br&gt;<br>
&lt;br&gt;<br>
Consequently,&nbsp;I&nbsp;do&nbsp;not&nbsp;see&nbsp;where&nbsp;it&nbsp;was&nbsp;intended&nbsp;to&nbsp;resolve&nbsp;this&nbsp;issue&lt;br&gt;<br>
(this&nbsp;is&nbsp;related&nbsp;to&nbsp;the&nbsp;wasteful&nbsp;recreation&nbsp;of&nbsp;a&nbsp;complete&nbsp;menu&nbsp;bar&lt;br&gt;<br>
whenever&nbsp;anything&nbsp;changed&nbsp;in&nbsp;any&nbsp;menu&nbsp;item).&lt;br&gt;<br>
&lt;br&gt;<br>
Help?&lt;br&gt;<br>
Johannes&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
ImageJ-devel&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:ImageJ-devel@imagej.net&quot;&gt;ImageJ-devel@imagej.net&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://imagej.net/mailman/listinfo/imagej-devel&quot;&nbsp;target=&quot;_blank&quot;&gt;http://imagej.net/mailman/listinfo/imagej-devel&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
