<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt; &nbsp;&gt;&gt;&nbsp;Its&nbsp;design&nbsp;was&nbsp;the&nbsp;most&nbsp;important&nbsp;source&nbsp;of&nbsp;inspiration&nbsp;for&nbsp;ImgLib2.&lt;/div&gt;&lt;div&gt; &nbsp;Thanks&nbsp;for&nbsp;this&nbsp;information.&lt;/div&gt;&lt;div&gt; &nbsp;When&nbsp;I&nbsp;read&nbsp;ImgLib2,&nbsp;I&nbsp;have&nbsp;a&nbsp;impression&nbsp;that&nbsp;its&nbsp;design&nbsp;has&nbsp;some&nbsp;similar&nbsp;with&nbsp;other&nbsp;library.&lt;/div&gt;<br>
&lt;div&gt; &nbsp;Now&nbsp;I&nbsp;know&nbsp;this&nbsp;library&nbsp;is&nbsp;VIGRA&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;By&nbsp;the&nbsp;way,&nbsp;I&nbsp;can&nbsp;not&nbsp;access &lt;a&nbsp;href=&quot;http://hci.iwr.uni-heidelberg.de/vigra/%E2%80%8E&quot;&gt;http://hci.iwr.uni-heidelberg.de/vigra&lt;/a&gt;/ currently.&nbsp;Do&nbsp;others&nbsp;have&nbsp;this&nbsp;problem?&nbsp;  &lt;/div&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2013/10/17&nbsp;Johannes&nbsp;Schindelin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:Johannes.Schindelin@gmx.de&quot;&nbsp;target=&quot;_blank&quot;&gt;Johannes.Schindelin@gmx.de&lt;/a&gt;&gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi&nbsp;Ullrich,&lt;br&gt;<br>
&lt;br&gt;<br>
a&nbsp;little&nbsp;background&nbsp;information&nbsp;for&nbsp;everybody&nbsp;else:&nbsp;Ullrich&nbsp;is&nbsp;the&lt;br&gt;<br>
inventor&nbsp;and&nbsp;maintainer&nbsp;of&nbsp;VIGRA,&nbsp;an&nbsp;incredibly&nbsp;powerful&nbsp;C++&nbsp;library&nbsp;to&lt;br&gt;<br>
process&nbsp;and&nbsp;analyze&nbsp;images.&nbsp;Its&nbsp;design&nbsp;was&nbsp;the&nbsp;most&nbsp;important&nbsp;source&nbsp;of&lt;br&gt;<br>
inspiration&nbsp;for&nbsp;ImgLib2.&nbsp;As&nbsp;a&nbsp;consequence,&nbsp;I&nbsp;was&nbsp;really&nbsp;delighted&nbsp;to&nbsp;meet&lt;br&gt;<br>
Ullrich&nbsp;at&nbsp;the&nbsp;EuBIAS&nbsp;meeting&nbsp;in&nbsp;Barcelona&nbsp;last&nbsp;week.&nbsp;Among&nbsp;other&nbsp;things,&lt;br&gt;<br>
we&nbsp;talked&nbsp;extensively&nbsp;about&nbsp;ways&nbsp;to&nbsp;interoperate&nbsp;between&nbsp;ImgLib2&nbsp;and&lt;br&gt;<br>
VIGRA,&nbsp;and&nbsp;the&nbsp;lack&nbsp;of&nbsp;support&nbsp;in&nbsp;VIGRA&nbsp;to&nbsp;read&nbsp;file&nbsp;formats&nbsp;via&nbsp;the&lt;br&gt;<br>
Bio-Formats&nbsp;library.&lt;br&gt;<br>
&lt;br&gt;<br>
Also&nbsp;at&nbsp;that&nbsp;meeting,&nbsp;I&nbsp;got&nbsp;into&nbsp;contact&nbsp;with&nbsp;the&nbsp;OpenMole&nbsp;project,&nbsp;and&nbsp;in&lt;br&gt;<br>
particular&nbsp;with&nbsp;Mark&nbsp;Hammons&nbsp;who&nbsp;not&nbsp;only&nbsp;explained&nbsp;patiently&nbsp;the&nbsp;benefits&lt;br&gt;<br>
of&nbsp;the&nbsp;Scala&nbsp;language&nbsp;to&nbsp;me,&nbsp;but&nbsp;also&nbsp;pointed&nbsp;out&nbsp;the&nbsp;existence&nbsp;of&nbsp;the&lt;br&gt;<br>
Avian&nbsp;VM,&nbsp;a&nbsp;small,&nbsp;embeddable,&nbsp;BSD-licensed&nbsp;Java&nbsp;Virtual&nbsp;Machine&nbsp;written&lt;br&gt;<br>
in&nbsp;C++,&nbsp;with&nbsp;a&nbsp;tiny&nbsp;Just-In-Time&nbsp;compiler,&nbsp;just&nbsp;enough&nbsp;to&nbsp;make&nbsp;it&nbsp;a&lt;br&gt;<br>
practical&nbsp;choice&nbsp;for&nbsp;running&nbsp;limited&nbsp;Java&nbsp;inside&nbsp;a&nbsp;C++&nbsp;program/library:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://oss.readytalk.com/avian/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://oss.readytalk.com/avian/&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;is&nbsp;actually&nbsp;very,&nbsp;very,&nbsp;*very*&nbsp;limited,&nbsp;as&nbsp;I&nbsp;found&nbsp;out&nbsp;when&nbsp;I&nbsp;tried&nbsp;to&lt;br&gt;<br>
get&nbsp;it&nbsp;to&nbsp;run&nbsp;the&nbsp;bfconvert&nbsp;tool&nbsp;of&nbsp;Bio-Formats.&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;I&nbsp;did&nbsp;get&nbsp;it&nbsp;to&nbsp;run&nbsp;bfconvert.&nbsp;To&nbsp;be&nbsp;precise,&nbsp;in&nbsp;my&nbsp;hands,&nbsp;the&nbsp;5MB&lt;br&gt;<br>
executable&nbsp;compiled&nbsp;from&nbsp;my&nbsp;fork&nbsp;of&nbsp;Avian&nbsp;was&nbsp;able&nbsp;to&nbsp;run&nbsp;my&lt;br&gt;<br>
(minimally-diverging)&nbsp;Bio-Formats&nbsp;v4.4.8&nbsp;fork&#39;s&lt;br&gt;<br>
loci.formats.tools.ImageConverter&nbsp;class&nbsp;to&nbsp;convert&nbsp;Fiji&#39;s&nbsp;icon.png&nbsp;(my&lt;br&gt;<br>
standard&nbsp;example)&nbsp;to&nbsp;a&nbsp;.tiff&nbsp;file&nbsp;(although&nbsp;the&nbsp;colors&nbsp;are&nbsp;off,&nbsp;but&lt;br&gt;<br>
running&nbsp;the&nbsp;same&nbsp;example&nbsp;with&nbsp;plain&nbsp;Java&nbsp;results&nbsp;in&nbsp;a&nbsp;byte-identical&lt;br&gt;<br>
file).&lt;br&gt;<br>
&lt;br&gt;<br>
Although&nbsp;it&nbsp;is&nbsp;too&nbsp;early&nbsp;for&nbsp;proper&nbsp;benchmarking,&nbsp;things&nbsp;seem&nbsp;to&nbsp;be&lt;br&gt;<br>
comparable&nbsp;between&nbsp;Java&nbsp;and&nbsp;Avian:&nbsp;while&nbsp;Java&nbsp;is&nbsp;slightly&nbsp;faster&nbsp;in&nbsp;what&lt;br&gt;<br>
time(1)&nbsp;calls&nbsp;&quot;real&quot;&nbsp;time&nbsp;(~0.54s&nbsp;vs&nbsp;~0.72s),&nbsp;in&nbsp;terms&nbsp;of&nbsp;&quot;user&quot;&nbsp;time&lt;br&gt;<br>
roles&nbsp;are&nbsp;reversed&nbsp;(~0.70s&nbsp;vs&nbsp;~0.63s).&nbsp;Roughly&nbsp;the&nbsp;same&nbsp;holds&nbsp;true&nbsp;for&nbsp;the&lt;br&gt;<br>
dynamic&nbsp;Avian&nbsp;executable&nbsp;(which&nbsp;is&nbsp;only&nbsp;11K&nbsp;and&nbsp;links&nbsp;to&nbsp;Avian&#39;s&nbsp;libjvm.so&lt;br&gt;<br>
weighing&nbsp;in&nbsp;with&nbsp;a&nbsp;whopping&nbsp;1.2M).&nbsp;The&nbsp;major&nbsp;benefit&nbsp;will&nbsp;most&nbsp;likely&nbsp;be&lt;br&gt;<br>
space:&nbsp;linking&nbsp;to&nbsp;libjvm.so&nbsp;should&nbsp;be&nbsp;enough,&nbsp;the&nbsp;standard&nbsp;Java&nbsp;classes&lt;br&gt;<br>
are&nbsp;included&nbsp;therein.&nbsp;So&nbsp;you&nbsp;can&nbsp;get&nbsp;Java&nbsp;support&nbsp;in&nbsp;VIGRA&nbsp;(or&nbsp;any&nbsp;other&lt;br&gt;<br>
C++&nbsp;project)&nbsp;by&nbsp;adding&nbsp;a&nbsp;library&nbsp;that&nbsp;is&nbsp;slightly&nbsp;larger&nbsp;than&nbsp;one&lt;br&gt;<br>
megabyte.&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;to&nbsp;some&nbsp;more&nbsp;detailed&nbsp;explanations&nbsp;about&nbsp;the&nbsp;challenges&nbsp;I&nbsp;faced,&nbsp;for&lt;br&gt;<br>
the&nbsp;technically-inclined.&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;the&nbsp;Bio-Formats&nbsp;side,&nbsp;there&nbsp;are&nbsp;two&nbsp;major&nbsp;and&nbsp;one&nbsp;minor&nbsp;(and&nbsp;one&nbsp;micro)&lt;br&gt;<br>
issue:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;to&nbsp;enable&nbsp;logging,&nbsp;Bio-Formats&nbsp;uses&nbsp;a&nbsp;cute&nbsp;hack&nbsp;called&lt;br&gt;<br>
 &nbsp;ReflectedUniverse,&nbsp;which&nbsp;is&nbsp;basically&nbsp;a&nbsp;scripting&nbsp;language&nbsp;for&nbsp;Java&lt;br&gt;<br>
 &nbsp;itself.&nbsp;However,&nbsp;it&nbsp;uses&nbsp;regular&nbsp;expressions,&nbsp;something&nbsp;that&nbsp;Avian&#39;s&lt;br&gt;<br>
 &nbsp;class&nbsp;library&nbsp;does&nbsp;not&nbsp;yet&nbsp;support.&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;Bio-Formats&nbsp;uses&nbsp;a&nbsp;concurrent&nbsp;hashmap&nbsp;in&nbsp;loci.common.Location.&lt;br&gt;<br>
 &nbsp;Concurrency&nbsp;(JSR-166)&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;Avian&#39;s&nbsp;class&nbsp;library&nbsp;yet.&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;in&nbsp;loci.formats.gui.LegacyQTTools,&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;java.library.path&lt;br&gt;<br>
 &nbsp;property&nbsp;is&nbsp;used&nbsp;without&nbsp;checking&nbsp;whether&nbsp;the&nbsp;property&nbsp;is&nbsp;null&nbsp;(unset).&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;some&nbsp;debug&nbsp;logging&nbsp;in&nbsp;Bio-Formats&nbsp;uses&nbsp;String.format()&nbsp;(not&nbsp;yet&lt;br&gt;<br>
 &nbsp;supported&nbsp;by&nbsp;Avian&#39;s&nbsp;class&nbsp;library).&lt;br&gt;<br>
&lt;br&gt;<br>
All&nbsp;of&nbsp;these&nbsp;issues&nbsp;could&nbsp;be&nbsp;worked&nbsp;around&nbsp;in&nbsp;the&nbsp;code&nbsp;calling&lt;br&gt;<br>
Bio-Formats:&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;use&nbsp;the&nbsp;ImageConverter&nbsp;class&nbsp;(which&lt;br&gt;<br>
enables&nbsp;the&nbsp;logging),&nbsp;the&nbsp;concurrent&nbsp;hashmap&nbsp;could&nbsp;be&nbsp;faked&nbsp;by&nbsp;extending&lt;br&gt;<br>
the&nbsp;non-concurrent&nbsp;hashmap&nbsp;(and&nbsp;just&nbsp;not&nbsp;bothering&nbsp;with&nbsp;the&nbsp;concurrency&lt;br&gt;<br>
because&nbsp;we&nbsp;will&nbsp;most&nbsp;likely&nbsp;instantiate&nbsp;one&nbsp;VM&nbsp;per&nbsp;Bio-Formats&nbsp;call),&nbsp;the&lt;br&gt;<br>
java.library.path&nbsp;property&nbsp;could&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;dummy&nbsp;value&nbsp;and&nbsp;the&lt;br&gt;<br>
logging&nbsp;could&nbsp;be&nbsp;switched&nbsp;off&nbsp;completely.&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;the&nbsp;Avian&nbsp;side,&nbsp;I&nbsp;am&nbsp;happy&nbsp;to&nbsp;report&nbsp;that&nbsp;I&nbsp;only&nbsp;had&nbsp;to&nbsp;extend&nbsp;the&lt;br&gt;<br>
class&nbsp;library&nbsp;(apart&nbsp;from&nbsp;one&nbsp;bug&nbsp;fix&nbsp;that&nbsp;I&nbsp;will&nbsp;contribute&nbsp;upstream&lt;br&gt;<br>
later&nbsp;this&nbsp;week).&nbsp;In&nbsp;particular,&nbsp;I&nbsp;had&nbsp;to&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;make&nbsp;RandomAccessFile&nbsp;support&nbsp;writing&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;provide&nbsp;three&nbsp;dummy&nbsp;AWT&nbsp;classes&nbsp;because&nbsp;Bio-Formats&nbsp;actually&nbsp;links&nbsp;to&lt;br&gt;<br>
 &nbsp;them,&nbsp;but&nbsp;does&nbsp;not&nbsp;use&nbsp;them&nbsp;by&nbsp;default&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;provide&nbsp;a&nbsp;couple&nbsp;of&nbsp;interfaces&nbsp;and&nbsp;exceptions&nbsp;that&nbsp;were&nbsp;not&nbsp;yet&nbsp;included&lt;br&gt;<br>
 &nbsp;in&nbsp;Avian&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;implement&nbsp;a&nbsp;minimal&nbsp;java.io.DataOutputStream&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;provide&nbsp;a&nbsp;FileChannel&nbsp;for&nbsp;RandomAccessFiles&nbsp;(i.e.&nbsp;implement&nbsp;getChannel)&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;implement&nbsp;java.lang.Boolean&#39;s&nbsp;parse(String)&nbsp;method&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;implement&nbsp;java.lang.Character&#39;s&nbsp;isISOControl(char)&nbsp;method&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;implement&nbsp;fake&nbsp;byte&nbsp;order&nbsp;methods&nbsp;for&nbsp;ByteBuffers&nbsp;(they&nbsp;are&nbsp;hardcoded&nbsp;to&lt;br&gt;<br>
 &nbsp;big&nbsp;endian,&nbsp;but&nbsp;that&nbsp;is&nbsp;what&nbsp;Bio-Formats&nbsp;required&nbsp;in&nbsp;my&nbsp;test)&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;provide&nbsp;a&nbsp;dummy&nbsp;SimpleDateFormat&nbsp;which&nbsp;actually&nbsp;does&nbsp;not&nbsp;work,&nbsp;but&nbsp;does&lt;br&gt;<br>
 &nbsp;not&nbsp;need&nbsp;to&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;add&nbsp;toString(long[])&nbsp;to&nbsp;java.util.Arrays&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;teach&nbsp;Avian&#39;s&nbsp;pseudo&nbsp;regular&nbsp;expressions&nbsp;about&nbsp;&quot;\\&quot;,&nbsp;i.e.&nbsp;the&nbsp;backslash&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;the&nbsp;moment,&nbsp;all&nbsp;of&nbsp;these&nbsp;changes&nbsp;are&nbsp;contained&nbsp;in&nbsp;hodge&nbsp;podge&lt;br&gt;<br>
work-in-progress&nbsp;commits&nbsp;which&nbsp;I&nbsp;will&nbsp;clean&nbsp;up&nbsp;over&nbsp;the&nbsp;next&nbsp;few&nbsp;days.&nbsp;You&lt;br&gt;<br>
can&nbsp;see&nbsp;them&nbsp;here&nbsp;(the&nbsp;linked&nbsp;pages&nbsp;will&nbsp;update&nbsp;whenever&nbsp;I&nbsp;get&nbsp;around&nbsp;to&lt;br&gt;<br>
clean&nbsp;up&nbsp;the&nbsp;commits):&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/dscho/avian/compare/bio-formats&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/dscho/avian/compare/bio-formats&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/dscho/bioformats/compare/v4.4.8...avian&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/dscho/bioformats/compare/v4.4.8...avian&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Since&nbsp;VIGRA&nbsp;and&nbsp;ImgLib2&nbsp;share&nbsp;design&nbsp;concepts,&nbsp;and&nbsp;since&nbsp;SCIFIO&nbsp;supports&lt;br&gt;<br>
ImgLib2&nbsp;natively,&nbsp;I&nbsp;think&nbsp;that&nbsp;my&nbsp;plan&nbsp;to&nbsp;extend&nbsp;the&nbsp;test&nbsp;to&nbsp;SCIFIO&nbsp;after&lt;br&gt;<br>
cleaning&nbsp;up&nbsp;my&nbsp;Avian&nbsp;fork&nbsp;is&nbsp;sound.&lt;br&gt;<br>
&lt;br&gt;<br>
Once&nbsp;that&nbsp;is&nbsp;done,&nbsp;I&nbsp;will&nbsp;add&nbsp;unit&nbsp;tests&nbsp;that&nbsp;our&nbsp;trusty&nbsp;Jenkins&nbsp;will&nbsp;run&lt;br&gt;<br>
whenever&nbsp;SCIFIO&nbsp;(or&nbsp;Avian)&nbsp;changes,&nbsp;to&nbsp;ensure&nbsp;that&nbsp;things&nbsp;continue&nbsp;to&lt;br&gt;<br>
work.&nbsp;These&nbsp;unit&nbsp;tests&nbsp;will&nbsp;be&nbsp;extended&nbsp;as&nbsp;needed,&nbsp;e.g.&nbsp;when&nbsp;someone&nbsp;finds&lt;br&gt;<br>
out&nbsp;that&nbsp;an&nbsp;important&nbsp;use&nbsp;case&nbsp;requires&nbsp;more&nbsp;changes&nbsp;in&nbsp;Avian,&nbsp;still.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;way&nbsp;to&nbsp;call&nbsp;Bio-Formats&nbsp;and&nbsp;SCIFIO&nbsp;could&nbsp;become&nbsp;the&nbsp;default&nbsp;C++&nbsp;entry&lt;br&gt;<br>
point&nbsp;into&nbsp;those&nbsp;libraries.&lt;br&gt;<br>
&lt;br&gt;<br>
Summary:&nbsp;I&nbsp;showed&nbsp;that&nbsp;Bio-Formats/SCIFIO&nbsp;support&nbsp;for&nbsp;VIGRA&nbsp;and&nbsp;other&nbsp;C++&lt;br&gt;<br>
libraries&nbsp;is&nbsp;feasible&nbsp;through&nbsp;the&nbsp;BSD-licensed&nbsp;embeddable&nbsp;Java&nbsp;virtual&lt;br&gt;<br>
machine&nbsp;&quot;Avian&quot;.&nbsp;I&nbsp;am&nbsp;confident&nbsp;that&nbsp;I&nbsp;can&nbsp;clean&nbsp;up&nbsp;my&nbsp;patches&nbsp;this&nbsp;week&lt;br&gt;<br>
still,&nbsp;to&nbsp;be&nbsp;contributed&nbsp;to&nbsp;the&nbsp;Avian&nbsp;project.&lt;br&gt;<br>
&lt;br&gt;<br>
Ciao,&lt;br&gt;<br>
Johannes&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
ImageJ-devel&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:ImageJ-devel@imagej.net&quot;&gt;ImageJ-devel@imagej.net&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://imagej.net/mailman/listinfo/imagej-devel&quot;&nbsp;target=&quot;_blank&quot;&gt;http://imagej.net/mailman/listinfo/imagej-devel&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Yili&nbsp;Zhao<br>
&lt;/div&gt;<br>

</tt>
