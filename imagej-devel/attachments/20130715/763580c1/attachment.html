<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;I&nbsp;have&nbsp;an&nbsp;ImgPlus&nbsp;backed&nbsp;by&nbsp;an&nbsp;RGB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PlanarImg&nbsp;of&nbsp;UnsignedByteType&nbsp;and&nbsp;ARGBType.alpha(value)&nbsp;is&nbsp;255<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;all&nbsp;of&nbsp;them,&nbsp;so&nbsp;aSum&nbsp;is&nbsp;765.&nbsp;It&nbsp;would&nbsp;appear&nbsp;that&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;correct&nbsp;solution&nbsp;would&nbsp;be&nbsp;to&nbsp;divide&nbsp;aSum&nbsp;by&nbsp;3.&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Isn't&nbsp;it&nbsp;unusual&nbsp;to&nbsp;define&nbsp;an&nbsp;alpha&nbsp;for&nbsp;each&nbsp;color&nbsp;component,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generally&nbsp;you&nbsp;have&nbsp;a&nbsp;single&nbsp;A&nbsp;associated&nbsp;with&nbsp;a&nbsp;combined&nbsp;RGB?&nbsp;&nbsp;So<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;averaging&nbsp;the&nbsp;three&nbsp;alphas&nbsp;might&nbsp;make&nbsp;sense&nbsp;here,&nbsp;because&nbsp;I&nbsp;think<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;they&nbsp;should&nbsp;all&nbsp;be&nbsp;the&nbsp;same&nbsp;value.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;In&nbsp;addition,&nbsp;there's&nbsp;no&nbsp;scaling&nbsp;of&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;individual&nbsp;red,&nbsp;green&nbsp;and&nbsp;blue&nbsp;values&nbsp;by&nbsp;their&nbsp;channel's&nbsp;alpha.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;input&nbsp;were&nbsp;two&nbsp;index-color&nbsp;images,&nbsp;each&nbsp;of&nbsp;which&nbsp;had<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;different&nbsp;alphas,&nbsp;the&nbsp;code&nbsp;should&nbsp;multiply&nbsp;the&nbsp;r,&nbsp;g&nbsp;and&nbsp;b&nbsp;values<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;the&nbsp;alphas&nbsp;before&nbsp;summing&nbsp;and&nbsp;then&nbsp;divide&nbsp;by&nbsp;the&nbsp;total&nbsp;alpha<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;end.&nbsp;The&nbsp;alpha&nbsp;in&nbsp;this&nbsp;case&nbsp;*should*&nbsp;be&nbsp;the&nbsp;sum&nbsp;of&nbsp;alphas<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;divided&nbsp;by&nbsp;the&nbsp;number&nbsp;of&nbsp;channels.&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;think&nbsp;alpha&nbsp;processing&nbsp;is&nbsp;more&nbsp;cumulative,&nbsp;done&nbsp;layer&nbsp;by&nbsp;layer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;some&nbsp;defined&nbsp;layer&nbsp;order.&nbsp;&nbsp;For&nbsp;a&nbsp;given&nbsp;pixel&nbsp;say&nbsp;the&nbsp;current<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;pixel&nbsp;value&nbsp;is&nbsp;ARGB1&nbsp;and&nbsp;you&nbsp;are&nbsp;compositing&nbsp;a&nbsp;second&nbsp;image<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;value&nbsp;ARGB2&nbsp;on&nbsp;top&nbsp;of&nbsp;it:&nbsp;&nbsp;For&nbsp;the&nbsp;red&nbsp;channel&nbsp;the&nbsp;output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color&nbsp;should&nbsp;be&nbsp;((255&nbsp;-&nbsp;alpha(ARGB2))&nbsp;*&nbsp;red(ARGB1)&nbsp;+&nbsp;alpha(ARGB2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;red(ARGB2))&nbsp;/&nbsp;255.&nbsp;&nbsp;The&nbsp;alpha&nbsp;of&nbsp;ARGB1&nbsp;is&nbsp;not&nbsp;involved.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;other&nbsp;words,&nbsp;if&nbsp;you&nbsp;add&nbsp;a&nbsp;layer&nbsp;that&nbsp;is&nbsp;completely&nbsp;opaque&nbsp;you<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;longer&nbsp;have&nbsp;to&nbsp;consider&nbsp;any&nbsp;of&nbsp;the&nbsp;colors&nbsp;or&nbsp;alpha&nbsp;values<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;underneath&nbsp;it.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;think&nbsp;the&nbsp;bigger&nbsp;issue&nbsp;here&nbsp;is&nbsp;this&nbsp;code&nbsp;is&nbsp;specifically<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;designed&nbsp;to&nbsp;composite&nbsp;red,&nbsp;green&nbsp;and&nbsp;blue&nbsp;image&nbsp;layers.&nbsp;&nbsp;It's&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special&nbsp;case&nbsp;since&nbsp;for&nbsp;a&nbsp;given&nbsp;pixel&nbsp;the&nbsp;red&nbsp;comes&nbsp;from&nbsp;the&nbsp;red<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer,&nbsp;blue&nbsp;from&nbsp;blue&nbsp;layer,&nbsp;and&nbsp;green&nbsp;from&nbsp;green&nbsp;layer.&nbsp;&nbsp;These<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layers&nbsp;shouldn't&nbsp;be&nbsp;completely&nbsp;opaque,&nbsp;since&nbsp;the&nbsp;colors&nbsp;wouldn't<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;combine&nbsp;at&nbsp;all&nbsp;then&nbsp;or&nbsp;completely&nbsp;transparent&nbsp;since&nbsp;then&nbsp;they<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wouldn't&nbsp;contribute&nbsp;any&nbsp;color.&nbsp;&nbsp;I&nbsp;don't&nbsp;think&nbsp;transparency&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;useful&nbsp;here.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It's&nbsp;also&nbsp;possible&nbsp;that&nbsp;a&nbsp;multichannel&nbsp;image&nbsp;with&nbsp;&gt;&nbsp;3&nbsp;channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;being&nbsp;displayed&nbsp;with&nbsp;more&nbsp;color&nbsp;channels,&nbsp;namely&nbsp;cyan,&nbsp;magenta,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;yellow.&nbsp;&nbsp;The&nbsp;code&nbsp;here&nbsp;is&nbsp;designed&nbsp;to&nbsp;stop&nbsp;overflow,&nbsp;but&nbsp;I'm<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;convinced&nbsp;those&nbsp;extended&nbsp;color&nbsp;channels&nbsp;would&nbsp;combine<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meaningfully.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aivar&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;In&nbsp;addition,&nbsp;there's&nbsp;no&nbsp;scaling&nbsp;of&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;individual&nbsp;red,&nbsp;green&nbsp;and&nbsp;blue&nbsp;values&nbsp;by&nbsp;their&nbsp;channel's&nbsp;alpha.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;input&nbsp;were&nbsp;two&nbsp;index-color&nbsp;images,&nbsp;each&nbsp;of&nbsp;which&nbsp;had<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;different&nbsp;alphas,&nbsp;the&nbsp;code&nbsp;should&nbsp;multiply&nbsp;the&nbsp;r,&nbsp;g&nbsp;and&nbsp;b&nbsp;values<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;the&nbsp;alphas&nbsp;before&nbsp;summing&nbsp;and&nbsp;then&nbsp;divide&nbsp;by&nbsp;the&nbsp;total&nbsp;alpha<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;end.&nbsp;The&nbsp;alpha&nbsp;in&nbsp;this&nbsp;case&nbsp;*should*&nbsp;be&nbsp;the&nbsp;sum&nbsp;of&nbsp;alphas<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;divided&nbsp;by&nbsp;the&nbsp;number&nbsp;of&nbsp;channels.&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;think&nbsp;alpha&nbsp;processing&nbsp;is&nbsp;cumulative&nbsp;layer&nbsp;by&nbsp;layer.&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;brings&nbsp;up&nbsp;some&nbsp;interesting&nbsp;questions:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;If&nbsp;the&nbsp;first,&nbsp;bottom-most&nbsp;layer&nbsp;is&nbsp;transparent,&nbsp;what&nbsp;color<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;show&nbsp;through?&nbsp;&nbsp;Black,&nbsp;white?&nbsp;&nbsp;Or&nbsp;perhaps&nbsp;it's&nbsp;best&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ignore&nbsp;this&nbsp;base&nbsp;layer&nbsp;transparency.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;If&nbsp;you&nbsp;wanted&nbsp;to&nbsp;composite&nbsp;several&nbsp;transparent&nbsp;images,&nbsp;how&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you&nbsp;calculate&nbsp;the&nbsp;transparency&nbsp;of&nbsp;the&nbsp;composite?&nbsp;&nbsp;I'm&nbsp;not&nbsp;sure<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;is&nbsp;something&nbsp;we&nbsp;need&nbsp;to&nbsp;do.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aivar&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;7/15/13&nbsp;10:31&nbsp;AM,&nbsp;Lee&nbsp;Kamentsky&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
cite=&quot;mid:CAHLFyjeejg8JbidrZDyTqtLS1E7PPq=w5OU4iLmGpdox4PnP5Q@mail.gmail.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Context-Type&quot;&nbsp;content=&quot;text/html;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;Hi&nbsp;all,&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;I'm&nbsp;looking&nbsp;at&nbsp;the&nbsp;code&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;net.imglib2.display.CompositeXYProjector&nbsp;and&nbsp;as&nbsp;I&nbsp;step&nbsp;through<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it,&nbsp;it's&nbsp;clear&nbsp;that&nbsp;the&nbsp;alpha&nbsp;calculation&nbsp;isn't&nbsp;being&nbsp;handled<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;correctly.&nbsp;Here's&nbsp;the&nbsp;code&nbsp;as&nbsp;it&nbsp;stands&nbsp;now,&nbsp;line&nbsp;190&nbsp;roughly:&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;for&nbsp;(&nbsp;int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;size;&nbsp;i++&nbsp;)&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;{&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;sourceRandomAccess.setPosition(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentPositions[&nbsp;i&nbsp;],&nbsp;dimIndex&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;currentConverters[&nbsp;i&nbsp;].convert(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sourceRandomAccess.get(),&nbsp;bi&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;//&nbsp;accumulate&nbsp;converted&nbsp;result&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;value&nbsp;=&nbsp;bi.get();&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;a&nbsp;=&nbsp;ARGBType.alpha(&nbsp;value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;r&nbsp;=&nbsp;ARGBType.red(&nbsp;value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;g&nbsp;=&nbsp;ARGBType.green(&nbsp;value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;b&nbsp;=&nbsp;ARGBType.blue(&nbsp;value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;aSum&nbsp;+=&nbsp;a;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;rSum&nbsp;+=&nbsp;r;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;gSum&nbsp;+=&nbsp;g;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;bSum&nbsp;+=&nbsp;b;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;}&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;aSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;aSum&nbsp;=&nbsp;255;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;rSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;rSum&nbsp;=&nbsp;255;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;gSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;gSum&nbsp;=&nbsp;255;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;bSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;bSum&nbsp;=&nbsp;255;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;targetCursor.get().set(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARGBType.rgba(&nbsp;rSum,&nbsp;gSum,&nbsp;bSum,&nbsp;aSum&nbsp;)&nbsp;);&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;I&nbsp;have&nbsp;an&nbsp;ImgPlus&nbsp;backed&nbsp;by&nbsp;an&nbsp;RGB&nbsp;PlanarImg&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnsignedByteType&nbsp;and&nbsp;ARGBType.alpha(value)&nbsp;is&nbsp;255&nbsp;for&nbsp;all&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;them,&nbsp;so&nbsp;aSum&nbsp;is&nbsp;765.&nbsp;It&nbsp;would&nbsp;appear&nbsp;that&nbsp;the&nbsp;correct<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;solution&nbsp;would&nbsp;be&nbsp;to&nbsp;divide&nbsp;aSum&nbsp;by&nbsp;3.&nbsp;In&nbsp;addition,&nbsp;there's&nbsp;no<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scaling&nbsp;of&nbsp;the&nbsp;individual&nbsp;red,&nbsp;green&nbsp;and&nbsp;blue&nbsp;values&nbsp;by&nbsp;their<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel's&nbsp;alpha.&nbsp;If&nbsp;the&nbsp;input&nbsp;were&nbsp;two&nbsp;index-color&nbsp;images,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;each&nbsp;of&nbsp;which&nbsp;had&nbsp;different&nbsp;alphas,&nbsp;the&nbsp;code&nbsp;should&nbsp;multiply<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;r,&nbsp;g&nbsp;and&nbsp;b&nbsp;values&nbsp;by&nbsp;the&nbsp;alphas&nbsp;before&nbsp;summing&nbsp;and&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;divide&nbsp;by&nbsp;the&nbsp;total&nbsp;alpha&nbsp;in&nbsp;the&nbsp;end.&nbsp;The&nbsp;alpha&nbsp;in&nbsp;this&nbsp;case<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*should*&nbsp;be&nbsp;the&nbsp;sum&nbsp;of&nbsp;alphas&nbsp;divided&nbsp;by&nbsp;the&nbsp;number&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channels.&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;However,&nbsp;I&nbsp;think&nbsp;the&nbsp;problem&nbsp;is&nbsp;deeper&nbsp;than&nbsp;that.&nbsp;For&nbsp;an<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RGB&nbsp;ImgPlus,&nbsp;there&nbsp;are&nbsp;three&nbsp;LUTs&nbsp;and&nbsp;each&nbsp;of&nbsp;them&nbsp;has&nbsp;an<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alpha&nbsp;of&nbsp;255,&nbsp;but&nbsp;that&nbsp;alpha&nbsp;only&nbsp;applies&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;colors<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;LUT.&nbsp;When&nbsp;you're&nbsp;compositing&nbsp;images&nbsp;and&nbsp;weighing&nbsp;them<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equally,&nbsp;if&nbsp;two&nbsp;are&nbsp;black&nbsp;and&nbsp;one&nbsp;is&nbsp;white,&nbsp;then&nbsp;the&nbsp;result&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1/3&nbsp;of&nbsp;the&nbsp;white&nbsp;intensity&nbsp;-&nbsp;if&nbsp;you&nbsp;translate&nbsp;that&nbsp;to&nbsp;red,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;green&nbsp;and&nbsp;blue&nbsp;images,&nbsp;the&nbsp;resulting&nbsp;intensity&nbsp;will&nbsp;be&nbsp;1/3&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;desired.&nbsp;This&nbsp;might&nbsp;sound&nbsp;weird,&nbsp;but&nbsp;the&nbsp;only&nbsp;solution<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;works&nbsp;out&nbsp;mathematically&nbsp;is&nbsp;for&nbsp;the&nbsp;defaultLUTs&nbsp;in&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultDatasetView&nbsp;to&nbsp;use&nbsp;color&nbsp;tables&nbsp;that&nbsp;return&nbsp;values&nbsp;that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;are&nbsp;3x&nbsp;those&nbsp;of&nbsp;ColorTables.RED,&nbsp;GREEN&nbsp;and&nbsp;BLUE.&nbsp;Thinking<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;about&nbsp;it,&nbsp;I'm&nbsp;afraid&nbsp;this&nbsp;*is*&nbsp;the&nbsp;correct&nbsp;model&nbsp;and&nbsp;each<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel&nbsp;really&nbsp;is&nbsp;3x&nbsp;brighter&nbsp;than&nbsp;possible.&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;It&nbsp;took&nbsp;me&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;back&nbsp;and&nbsp;forth&nbsp;to&nbsp;come&nbsp;up&nbsp;with<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;above...&nbsp;I&nbsp;hope&nbsp;you&nbsp;all&nbsp;understand&nbsp;what&nbsp;I'm&nbsp;saying&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;understand&nbsp;the&nbsp;problem&nbsp;and&nbsp;counter-intuitive&nbsp;solution&nbsp;and&nbsp;have<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;patience&nbsp;to&nbsp;follow&nbsp;it.&nbsp;Dscho,&nbsp;if&nbsp;you&nbsp;made&nbsp;it&nbsp;this&nbsp;far&nbsp;-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you're&nbsp;the&nbsp;mathematician,&nbsp;what's&nbsp;your&nbsp;take?&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;--Lee&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&nbsp;class=&quot;mimeAttachmentHeader&quot;&gt;&lt;/fieldset&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;_______________________________________________<br>
ImageJ-devel&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:ImageJ-devel@imagej.net&quot;&gt;ImageJ-devel@imagej.net&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://imagej.net/mailman/listinfo/imagej-devel&quot;&gt;http://imagej.net/mailman/listinfo/imagej-devel&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
