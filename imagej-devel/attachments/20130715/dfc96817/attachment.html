<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;all, &lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;looking&nbsp;at&nbsp;the&nbsp;code&nbsp;for&nbsp;net.imglib2.display.CompositeXYProjector&nbsp;and&nbsp;as&nbsp;I&nbsp;step&nbsp;through&nbsp;it,&nbsp;it&#39;s&nbsp;clear&nbsp;that&nbsp;the&nbsp;alpha&nbsp;calculation&nbsp;isn&#39;t&nbsp;being&nbsp;handled&nbsp;correctly.&nbsp;Here&#39;s&nbsp;the&nbsp;code&nbsp;as&nbsp;it&nbsp;stands&nbsp;now,&nbsp;line&nbsp;190&nbsp;roughly:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;for&nbsp;(&nbsp;int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;size;&nbsp;i++&nbsp;)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;sourceRandomAccess.setPosition(&nbsp;currentPositions[&nbsp;i&nbsp;],&nbsp;dimIndex&nbsp;);&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;currentConverters[&nbsp;i&nbsp;].convert(&nbsp;sourceRandomAccess.get(),&nbsp;bi&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;//&nbsp;accumulate&nbsp;converted&nbsp;result&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;value&nbsp;=&nbsp;bi.get();&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;a&nbsp;=&nbsp;ARGBType.alpha(&nbsp;value&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;r&nbsp;=&nbsp;ARGBType.red(&nbsp;value&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;g&nbsp;=&nbsp;ARGBType.green(&nbsp;value&nbsp;);&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;final&nbsp;int&nbsp;b&nbsp;=&nbsp;ARGBType.blue(&nbsp;value&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;aSum&nbsp;+=&nbsp;a;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;rSum&nbsp;+=&nbsp;r;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;gSum&nbsp;+=&nbsp;g;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;bSum&nbsp;+=&nbsp;b;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;aSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;aSum&nbsp;=&nbsp;255;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;rSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;rSum&nbsp;=&nbsp;255;&lt;/div&gt;&lt;div&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;gSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;gSum&nbsp;=&nbsp;255;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;if&nbsp;(&nbsp;bSum&nbsp;&gt;&nbsp;255&nbsp;)&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;bSum&nbsp;=&nbsp;255;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;targetCursor.get().set(&nbsp;ARGBType.rgba(&nbsp;rSum,&nbsp;gSum,&nbsp;bSum,&nbsp;aSum&nbsp;)&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;an&nbsp;ImgPlus&nbsp;backed&nbsp;by&nbsp;an&nbsp;RGB&nbsp;PlanarImg&nbsp;of&nbsp;UnsignedByteType&nbsp;and&nbsp;ARGBType.alpha(value)&nbsp;is&nbsp;255&nbsp;for&nbsp;all&nbsp;of&nbsp;them,&nbsp;so&nbsp;aSum&nbsp;is&nbsp;765.&nbsp;It&nbsp;would&nbsp;appear&nbsp;that&nbsp;the&nbsp;correct&nbsp;solution&nbsp;would&nbsp;be&nbsp;to&nbsp;divide&nbsp;aSum&nbsp;by&nbsp;3.&nbsp;In&nbsp;addition,&nbsp;there&#39;s&nbsp;no&nbsp;scaling&nbsp;of&nbsp;the&nbsp;individual&nbsp;red,&nbsp;green&nbsp;and&nbsp;blue&nbsp;values&nbsp;by&nbsp;their&nbsp;channel&#39;s&nbsp;alpha.&nbsp;If&nbsp;the&nbsp;input&nbsp;were&nbsp;two&nbsp;index-color&nbsp;images,&nbsp;each&nbsp;of&nbsp;which&nbsp;had&nbsp;different&nbsp;alphas,&nbsp;the&nbsp;code&nbsp;should&nbsp;multiply&nbsp;the&nbsp;r,&nbsp;g&nbsp;and&nbsp;b&nbsp;values&nbsp;by&nbsp;the&nbsp;alphas&nbsp;before&nbsp;summing&nbsp;and&nbsp;then&nbsp;divide&nbsp;by&nbsp;the&nbsp;total&nbsp;alpha&nbsp;in&nbsp;the&nbsp;end.&nbsp;The&nbsp;alpha&nbsp;in&nbsp;this&nbsp;case&nbsp;*should*&nbsp;be&nbsp;the&nbsp;sum&nbsp;of&nbsp;alphas&nbsp;divided&nbsp;by&nbsp;the&nbsp;number&nbsp;of&nbsp;channels.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;I&nbsp;think&nbsp;the&nbsp;problem&nbsp;is&nbsp;deeper&nbsp;than&nbsp;that.&nbsp;For&nbsp;an&nbsp;RGB&nbsp;ImgPlus,&nbsp;there&nbsp;are&nbsp;three&nbsp;LUTs&nbsp;and&nbsp;each&nbsp;of&nbsp;them&nbsp;has&nbsp;an&nbsp;alpha&nbsp;of&nbsp;255,&nbsp;but&nbsp;that&nbsp;alpha&nbsp;only&nbsp;applies&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;colors&nbsp;in&nbsp;the&nbsp;LUT.&nbsp;When&nbsp;you&#39;re&nbsp;compositing&nbsp;images&nbsp;and&nbsp;weighing&nbsp;them&nbsp;equally,&nbsp;if&nbsp;two&nbsp;are&nbsp;black&nbsp;and&nbsp;one&nbsp;is&nbsp;white,&nbsp;then&nbsp;the&nbsp;result&nbsp;is&nbsp;1/3&nbsp;of&nbsp;the&nbsp;white&nbsp;intensity&nbsp;-&nbsp;if&nbsp;you&nbsp;translate&nbsp;that&nbsp;to&nbsp;red,&nbsp;green&nbsp;and&nbsp;blue&nbsp;images,&nbsp;the&nbsp;resulting&nbsp;intensity&nbsp;will&nbsp;be&nbsp;1/3&nbsp;of&nbsp;that&nbsp;desired.&nbsp;This&nbsp;might&nbsp;sound&nbsp;weird,&nbsp;but&nbsp;the&nbsp;only&nbsp;solution&nbsp;that&nbsp;works&nbsp;out&nbsp;mathematically&nbsp;is&nbsp;for&nbsp;the&nbsp;defaultLUTs&nbsp;in&nbsp;the&nbsp;DefaultDatasetView&nbsp;to&nbsp;use&nbsp;color&nbsp;tables&nbsp;that&nbsp;return&nbsp;values&nbsp;that&nbsp;are&nbsp;3x&nbsp;those&nbsp;of&nbsp;ColorTables.RED,&nbsp;GREEN&nbsp;and&nbsp;BLUE.&nbsp;Thinking&nbsp;about&nbsp;it,&nbsp;I&#39;m&nbsp;afraid&nbsp;this&nbsp;*is*&nbsp;the&nbsp;correct&nbsp;model&nbsp;and&nbsp;each&nbsp;channel&nbsp;really&nbsp;is&nbsp;3x&nbsp;brighter&nbsp;than&nbsp;possible.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;took&nbsp;me&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;back&nbsp;and&nbsp;forth&nbsp;to&nbsp;come&nbsp;up&nbsp;with&nbsp;the&nbsp;above...&nbsp;I&nbsp;hope&nbsp;you&nbsp;all&nbsp;understand&nbsp;what&nbsp;I&#39;m&nbsp;saying&nbsp;and&nbsp;understand&nbsp;the&nbsp;problem&nbsp;and&nbsp;counter-intuitive&nbsp;solution&nbsp;and&nbsp;have&nbsp;the&nbsp;patience&nbsp;to&nbsp;follow&nbsp;it.&nbsp;Dscho,&nbsp;if&nbsp;you&nbsp;made&nbsp;it&nbsp;this&nbsp;far&nbsp;-&nbsp;you&#39;re&nbsp;the&nbsp;mathematician,&nbsp;what&#39;s&nbsp;your&nbsp;take?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--Lee&lt;/div&gt;&lt;/div&gt;<br>

</tt>
