<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;everyone,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Today&nbsp;I&nbsp;spent&nbsp;some&nbsp;time&nbsp;fixing&nbsp;a&nbsp;new&nbsp;quitting-related&nbsp;bug&nbsp;in&nbsp;ImageJ2:&nbsp;the&nbsp;&quot;ImageJ&nbsp;quits&nbsp;twice&quot;&nbsp;bug.&nbsp;This&nbsp;was&nbsp;an&nbsp;OS-X-specific&nbsp;bug,&nbsp;related&nbsp;to&nbsp;the&nbsp;Mac&nbsp;application&nbsp;menu&nbsp;handling.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;quitting&nbsp;via&nbsp;Apple&nbsp;&gt;&nbsp;Quit&nbsp;(or&nbsp;Cmd+Q),&nbsp;ImageJ&nbsp;would&nbsp;show&nbsp;two&nbsp;different&nbsp;sets&nbsp;of&nbsp;dialogs:&nbsp;the&nbsp;usual&nbsp;ones,&nbsp;and&nbsp;another&nbsp;one&nbsp;that&nbsp;said&nbsp;simply&nbsp;&quot;Quit&nbsp;ImageJ?&quot;&nbsp;with&nbsp;OK/Cancel.&nbsp;Relatedly,&nbsp;ImageJ&nbsp;would&nbsp;also&nbsp;show&nbsp;two&nbsp;About&nbsp;dialogs&nbsp;when&nbsp;you&nbsp;say&nbsp;Apple&nbsp;&gt;&nbsp;About,&nbsp;and&nbsp;take&nbsp;two&nbsp;different&nbsp;actions&nbsp;when&nbsp;you&nbsp;say&nbsp;Apple&nbsp;&gt;&nbsp;Preferences.&nbsp;In&nbsp;a&nbsp;nutshell,&nbsp;this&nbsp;unfortunate&nbsp;behavior&nbsp;was&nbsp;because&nbsp;both&nbsp;ImageJ&nbsp;1.x&nbsp;and&nbsp;ImageJ2&nbsp;were&nbsp;trying&nbsp;to&nbsp;handle&nbsp;those&nbsp;actions.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;has&nbsp;now&nbsp;been&nbsp;fixed,&nbsp;and&nbsp;made&nbsp;it&nbsp;onto&nbsp;the&nbsp;respective&nbsp;master&nbsp;branches,&nbsp;as&nbsp;follows:&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;EventHandler:&nbsp;add&nbsp;optional&nbsp;key&nbsp;attribute&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/scijava/scijava-common/commit/bdf746798cbea51fddc4822f220bba2d909be0b8&quot;&gt;https://github.com/scijava/scijava-common/commit/bdf746798cbea51fddc4822f220bba2d909be0b8&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Which&nbsp;makes&nbsp;possible:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;DefaultAppEventService:&nbsp;specify&nbsp;subscription&nbsp;keys&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/scijava/scijava-common/commit/6b1fd5fc3c7f00f8d443d2447f72b016caf378f1&quot;&gt;https://github.com/scijava/scijava-common/commit/6b1fd5fc3c7f00f8d443d2447f72b016caf378f1&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Which&nbsp;makes&nbsp;the&nbsp;following&nbsp;fully&nbsp;work:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Fix&nbsp;the&nbsp;&quot;Fiji&nbsp;quits&nbsp;twice&quot;&nbsp;bug&nbsp;;-)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/imagej/imagej-legacy/commit/a9cfa620f694dd7af8d0224d399b47adaef20942&quot;&gt;https://github.com/imagej/imagej-legacy/commit/a9cfa620f694dd7af8d0224d399b47adaef20942&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Please&nbsp;note&nbsp;that&nbsp;these&nbsp;fixes&nbsp;have&nbsp;_not_&nbsp;been&nbsp;uploaded&nbsp;to&nbsp;the&nbsp;Updater&nbsp;yet,&nbsp;but&nbsp;we&nbsp;will&nbsp;do&nbsp;so&nbsp;as&nbsp;soon&nbsp;as&nbsp;we&nbsp;can.&nbsp;There&nbsp;will&nbsp;be&nbsp;a&nbsp;slew&nbsp;of&nbsp;releases&nbsp;by&nbsp;the&nbsp;end&nbsp;of&nbsp;this&nbsp;week.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Curtis&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;P.S.&nbsp;For&nbsp;the&nbsp;very&nbsp;technically&nbsp;inclined&nbsp;(*squints&nbsp;at&nbsp;Dscho*),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;archives:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;want&nbsp;to&nbsp;describe&nbsp;one&nbsp;detail&nbsp;while&nbsp;it&#39;s&nbsp;still&nbsp;fresh&nbsp;in&nbsp;my&nbsp;mind.&nbsp;In&nbsp;the&nbsp;SciJava&nbsp;Common&nbsp;application&nbsp;framework,&nbsp;if&nbsp;you&nbsp;have&nbsp;multiple&nbsp;services&nbsp;that&nbsp;implement&nbsp;the&nbsp;same&nbsp;service&nbsp;interface,&nbsp;both&nbsp;annotated&nbsp;with&nbsp;&quot;@Plugin(type&nbsp;=&nbsp;Service.class)&quot;,&nbsp;then&nbsp;a&nbsp;full-blown&nbsp;application&nbsp;context&nbsp;will&nbsp;instantiate&nbsp;one&nbsp;of&nbsp;each.&nbsp;_However_,&nbsp;if&nbsp;one&nbsp;of&nbsp;them&nbsp;extends&nbsp;the&nbsp;other,&nbsp;the&nbsp;story&nbsp;is&nbsp;different.&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;AppEventService,&nbsp;there&nbsp;is&nbsp;a&nbsp;DefaultAppEventService&nbsp;in&nbsp;scijava-common,&nbsp;a&nbsp;CoreAppEventService&nbsp;in&nbsp;imagej-plugins-commands&nbsp;and&nbsp;now&nbsp;a&nbsp;LegacyAppEventService&nbsp;in&nbsp;imagej-legacy.&nbsp;Both&nbsp;of&nbsp;the&nbsp;latter&nbsp;two&nbsp;extend&nbsp;the&nbsp;Default&nbsp;one.&nbsp;Hence,&nbsp;when&nbsp;the&nbsp;Context&nbsp;is&nbsp;initializing&nbsp;its&nbsp;services,&nbsp;it&nbsp;creates&nbsp;them&nbsp;in&nbsp;priority&nbsp;order:&nbsp;1)&nbsp;LegacyAppEventService&nbsp;[high];&nbsp;2)&nbsp;CoreAppEventService&nbsp;[normal];&nbsp;and&nbsp;3)&nbsp;DefaultAppEventService&nbsp;[low].&nbsp;Except&nbsp;that&nbsp;when&nbsp;it&nbsp;is&nbsp;time&nbsp;to&nbsp;create&nbsp;the&nbsp;DefaultAppEventService,&nbsp;the&nbsp;ServiceHelper&nbsp;skips&nbsp;creating&nbsp;it&nbsp;because&nbsp;there&nbsp;is&nbsp;already&nbsp;one&nbsp;present&nbsp;in&nbsp;the&nbsp;context.&nbsp;_Two_,&nbsp;actually!&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;has&nbsp;a&nbsp;weird&nbsp;ramification&nbsp;on&nbsp;event&nbsp;handling.&nbsp;As&nbsp;long&nbsp;as&nbsp;we&nbsp;had&nbsp;only&nbsp;CoreAppEventService&nbsp;and&nbsp;DefaultAppEventService,&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;AppEventService&nbsp;instance&nbsp;in&nbsp;the&nbsp;context,&nbsp;so&nbsp;only&nbsp;one&nbsp;receives&nbsp;the&nbsp;App*Events,&nbsp;so&nbsp;all&nbsp;is&nbsp;well.&nbsp;As&nbsp;soon&nbsp;as&nbsp;we&nbsp;added&nbsp;LegacyAppEventService,&nbsp;though,&nbsp;suddenly&nbsp;a&nbsp;full&nbsp;context&nbsp;has&nbsp;_two_&nbsp;different&nbsp;AppEventService&nbsp;implementations,&nbsp;_both_&nbsp;of&nbsp;which&nbsp;are&nbsp;receiving&nbsp;the&nbsp;App*Event&nbsp;notifications.&nbsp;So&nbsp;each&nbsp;of&nbsp;them&nbsp;was&nbsp;trying&nbsp;to&nbsp;handle&nbsp;the&nbsp;events,&nbsp;resulting&nbsp;in&nbsp;the&nbsp;double&nbsp;quit&nbsp;behavior.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;fix&nbsp;is&nbsp;described&nbsp;in&nbsp;the&nbsp;GitHub&nbsp;links&nbsp;above.&nbsp;We&nbsp;might&nbsp;need&nbsp;to&nbsp;make&nbsp;_all_&nbsp;@EventHandler&nbsp;methods&nbsp;have&nbsp;some&nbsp;default&nbsp;non-empty&nbsp;key&nbsp;based&nbsp;on&nbsp;their&nbsp;class&nbsp;and&nbsp;method&nbsp;signature.&nbsp;Otherwise,&nbsp;it&nbsp;will&nbsp;only&nbsp;be&nbsp;possible&nbsp;to&nbsp;override&nbsp;behavior&nbsp;of&nbsp;EventHandler&nbsp;methods&nbsp;that&nbsp;take&nbsp;care&nbsp;to&nbsp;provide&nbsp;such&nbsp;a&nbsp;key.&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
