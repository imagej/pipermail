From Martin.Horn at uni-konstanz.de  Wed Aug  1 10:39:00 2012
From: Martin.Horn at uni-konstanz.de (Martin Horn)
Date: Wed, 01 Aug 2012 17:39:00 +0200
Subject: [ImageJ-devel] KNIME Image Processing 1.0 and ImageJ2 Integration
Message-ID: <50194D94.5030505@uni-konstanz.de>

Hi all,

we are glad to announce that with yesterday's release of KNIME v2.6 
(http://www.knime.com/Version260) also the first mature version of the 
KNIME Image Processing Extension 
(http://tech.knime.org/community/image-processing) is available. We made 
a lot of changes under the hood and from now on we will try hard to be 
backwards compatible
whenever possible (e.g. all workflows created with nodes of a 1.*.* 
version of this extension can be restored with the newest version).

Furthermore, we provide the first public version (still beta) of the 
ImageJ2 integration (http://tech.knime.org/community/imagej) allowing 
the easy creation of ImageJ2 plugins as KNIME nodes.

Additionally, we set up the OMERO integration plugin with a prototypic 
OMERO 4.3.2 reader. Details of the progress of the OMERO integration can 
be found at http://tech.knime.org/community/omero.

Enjoy the combination of KNIME, ImgLib2, ImageJ, ImageJ2, OMERO and 
Bioformats altogether.

If you face any problems or have suggestions don't hesitate to contact us.

Best,

Christian, Martin & Michael



From ctrueden at wisc.edu  Wed Aug  1 11:16:29 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Wed, 1 Aug 2012 11:16:29 -0500
Subject: [ImageJ-devel] KNIME Image Processing 1.0 and ImageJ2
	Integration
In-Reply-To: <50194D94.5030505@uni-konstanz.de>
References: <50194D94.5030505@uni-konstanz.de>
Message-ID: <CADN69ynds3+SWDTGV7iog=4+xeR3krshRvNwQbTMEn_yOykunA@mail.gmail.com>

Hi Martin, Christian & Michael,

Thanks for all your hard work, and congratulations!

Cheers,
Curtis


On Wed, Aug 1, 2012 at 10:39 AM, Martin Horn <Martin.Horn at uni-konstanz.de>wrote:

> Hi all,
>
> we are glad to announce that with yesterday's release of KNIME v2.6 (
> http://www.knime.com/**Version260 <http://www.knime.com/Version260>) also
> the first mature version of the KNIME Image Processing Extension (
> http://tech.knime.org/**community/image-processing<http://tech.knime.org/community/image-processing>)
> is available. We made a lot of changes under the hood and from now on we
> will try hard to be backwards compatible
> whenever possible (e.g. all workflows created with nodes of a 1.*.*
> version of this extension can be restored with the newest version).
>
> Furthermore, we provide the first public version (still beta) of the
> ImageJ2 integration (http://tech.knime.org/**community/imagej<http://tech.knime.org/community/imagej>)
> allowing the easy creation of ImageJ2 plugins as KNIME nodes.
>
> Additionally, we set up the OMERO integration plugin with a prototypic
> OMERO 4.3.2 reader. Details of the progress of the OMERO integration can be
> found at http://tech.knime.org/**community/omero<http://tech.knime.org/community/omero>
> .
>
> Enjoy the combination of KNIME, ImgLib2, ImageJ, ImageJ2, OMERO and
> Bioformats altogether.
>
> If you face any problems or have suggestions don't hesitate to contact us.
>
> Best,
>
> Christian, Martin & Michael
>
>
> ______________________________**_________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/**listinfo/imagej-devel<http://imagej.net/mailman/listinfo/imagej-devel>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120801/22a286a1/attachment.html>

From sebrhode at gmail.com  Wed Aug  1 02:33:31 2012
From: sebrhode at gmail.com (sebrhode at gmail.com)
Date: Wed, 1 Aug 2012 00:33:31 -0700 (PDT)
Subject: [ImageJ-devel] [fiji-devel] LOCI crashes with current Fiji
	build on runtime
In-Reply-To: <CADN69y=aKrng-WK53eHKTxfRAOpA1AB--GBYyg8THrsG=L34QA@mail.gmail.com>
References: <04FEBFC9-2BBD-4D2C-8006-7BF45DAD468C@mpi-cbg.de>
	<20120723233028.GE10861@medusa>
	<236513BE-93E8-423C-AC44-3917360A56C7@mpi-cbg.de>
	<CADN69y=aKrng-WK53eHKTxfRAOpA1AB--GBYyg8THrsG=L34QA@mail.gmail.com>
Message-ID: <0bdea7ed-f911-48d8-865c-deba5ad2e263@googlegroups.com>

Hi Guys,

I tried to download the most up-to-date version (
http://jenkins.imagej.net/job/Stable-Fiji/lastSuccessfulBuild/artifact/fiji-nojre.zip)


This contains the loci_tools.jar as well as the the individual jars. So should i just delete which files? This issues is quite critical for us, since the Loci Bio-Format import is cruicial
for us (and customer) to import the OME-TIFF data produced by our imaging software.

Do you still have an idea when this problem might get solved?

Cheers,

Sebi


Am Dienstag, 31. Juli 2012 20:32:09 UTC+2 schrieb Curtis Rueden:
>
> Hi everyone,
>
> > I somehow keep deleting loci_plugins.jar but it keeps coming back ... 
> that caused the problem.
>
> I believe this problem is sorted out for user installations; that is, 
> running "Update Fiji" should get the proper Bio-Formats JARs. We are no 
> longer using loci_tools.jar, but rather the individual JARs.
>
> However, there is still work to be done with the Fiji build system, so for 
> those using Fiji from source, there may continue to be these sorts of 
> annoyances for a little while yet.
>
>  Sorry,
> Curtis
>
>
> On Mon, Jul 23, 2012 at 6:44 PM, Stephan Preibisch <preibisch at mpi-cbg.de>wrote:
>
>> Thanks Melissa, that worked!! I somehow keep deleting loci_plugins.jar 
>> but it keeps coming back ... that caused the problem. I will figure out 
>> what always recreates it.
>>
>> Bye bye,
>> Steffi
>>
>>
>> Am Jul 23, 2012 um 19:30 schrieb Melissa Linkert <
>> melissa at glencoesoftware.com>:
>>
>> > Hi Steffi,
>> >
>> >> running the SPIM registration I run into the problem that it is not 
>> possible to open images anymore because of a java.lang.NoSuchMethodError 
>> (see full exception below): 
>> ome.xml.model.Experimenter.setDisplayName(Ljava/lang/String;)V
>> >>
>> >> A similar error (setAcquiredDate instead of setDisplayName) can be 
>> reproduced using the Script editor with beanshell and the mitosis.tif 
>> (ImageJ example image):
>> > *snip*
>> >>
>> >> Does anyone know why this happens (was fine some days ago)...
>> >
>> > As far as I can tell, this is because when you build Fiji you now get
>> > two different versions of Bio-Formats in the 'jars' and 'plugins'
>> > directories.  plugins/loci_tools.jar is a specific version from April
>> > 2012, where plugins/loci_plugins.jar and jars/bio-formats.jar (and
>> > jars/loci-common.jar etc.) are the latest 4.4-SNAPSHOT version from
>> > Maven.  4.4-SNAPSHOT had some subtle API changes a couple of weeks ago,
>> > which would cause this error if older and newer JARs were mixed on the
>> > CLASSPATH.
>> >
>> > I would guess that this is somewhat related to this thread:
>> >
>> > 
>> https://groups.google.com/forum/?fromgroups#!topic/fiji-devel/r1JOg4C8_68
>> >
>> > ...but I could easily be wrong.
>> >
>> > Regards,
>> > -Melissa
>> >
>> > On Thu, Jul 19, 2012 at 12:02:36PM -0400, Stephan Preibisch wrote:
>> >> Hi,
>> >>
>> >> running the SPIM registration I run into the problem that it is not 
>> possible to open images anymore because of a java.lang.NoSuchMethodError 
>> (see full exception below): 
>> ome.xml.model.Experimenter.setDisplayName(Ljava/lang/String;)V
>> >>
>> >> A similar error (setAcquiredDate instead of setDisplayName) can be 
>> reproduced using the Script editor with beanshell and the mitosis.tif 
>> (ImageJ example image):
>> >>
>> >>   import loci.formats.ChannelSeparator;
>> >>   import loci.formats.MetadataTools;
>> >>   import loci.formats.meta.IMetadata;
>> >>   import loci.formats.IFormatReader;
>> >>
>> >>   final IFormatReader r = new ChannelSeparator();
>> >>
>> >>   final IMetadata omexmlMeta = MetadataTools.createOMEXMLMetadata();
>> >>   r.setMetadataStore( omexmlMeta );
>> >>   r.setId( "/Users/preibischs/Desktop/mitosis.tif" );
>> >>
>> >> -> Target exception: java.lang.NoSuchMethodError: 
>> ome.xml.model.Image.setAcquiredDate(Ljava/lang/String;)V
>> >>
>> >> Does anyone know why this happens (was fine some days ago)...
>> >>
>> >> Thanks a lot,
>> >> Steffi
>> >>
>> >>
>> >> java.lang.reflect.InvocationTargetException
>> >>    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>> >>    at 
>> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
>> >>    at 
>> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
>> >>    at java.lang.reflect.Method.invoke(Method.java:597)
>> >>    at ij.Command.runPlugIn(Command.java:146)
>> >>    at ij.Command.runCommand(Command.java:95)
>> >>    at ij.Executer.run(Executer.java:64)
>> >>    at java.lang.Thread.run(Thread.java:680)
>> >> Caused by: java.lang.NoSuchMethodError: 
>> ome.xml.model.Experimenter.setDisplayName(Ljava/lang/String;)V
>> >>    at 
>> loci.formats.ome.OMEXMLMetadataImpl.setExperimenterDisplayName(OMEXMLMetadataImpl.java:7386)
>> >>    at 
>> loci.formats.meta.FilterMetadata.setExperimenterDisplayName(FilterMetadata.java:889)
>> >>    at 
>> loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1192)
>> >>    at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
>> >>    at loci.formats.FormatReader.setId(FormatReader.java:1091)
>> >>    at loci.formats.ImageReader.setId(ImageReader.java:682)
>> >>    at loci.formats.ReaderWrapper.setId(ReaderWrapper.java:492)
>> >>    at loci.formats.ChannelSeparator.setId(ChannelSeparator.java:261)
>> >>    at mpicbg.imglib.io.LOCI.openLOCIFloatType(LOCI.java:638)
>> >>    at mpicbg.imglib.io.LOCI.openLOCIFloatType(LOCI.java:583)
>> >>    at mpicbg.imglib.io.LOCI.openLOCIFloatType(LOCI.java:573)
>> >>    at mpicbg.imglib.io.LOCI.openLOCIFloatType(LOCI.java:568)
>> >>    at 
>> fiji.plugin.Bead_Registration.getInteractiveDoGParameters(Bead_Registration.java:673)
>> >>    at 
>> fiji.plugin.Bead_Registration.getConfiguration(Bead_Registration.java:320)
>> >>    at 
>> fiji.plugin.Bead_Registration.access$100(Bead_Registration.java:40)
>> >>    at 
>> fiji.plugin.Bead_Registration$1.dialogItemChanged(Bead_Registration.java:208)
>> >>    at ij.gui.GenericDialog.showDialog(GenericDialog.java:1052)
>> >>    at 
>> fiji.plugin.Bead_Registration.singleChannel(Bead_Registration.java:265)
>> >>    at fiji.plugin.Bead_Registration.run(Bead_Registration.java:75)
>> >>    at ij.IJ.runUserPlugIn(IJ.java:185)
>> >>    at ij.IJ.runPlugIn(IJ.java:152)
>> >>
>> >> --
>> >> Please avoid top-posting, and please make sure to reply-to-all!
>> >>
>> >> Mailing list web interface: http://groups.google.com/group/fiji-devel
>>
>> --
>> Please avoid top-posting, and please make sure to reply-to-all!
>>
>> Mailing list web interface: http://groups.google.com/group/fiji-devel
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120801/8adc68fd/attachment.html>

From ctrueden at wisc.edu  Wed Aug  1 12:24:41 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Wed, 1 Aug 2012 12:24:41 -0500
Subject: [ImageJ-devel] [fiji-devel] Significant change to ImgOpener -
 or - why ImgOpener.openImg() cannot return a T
In-Reply-To: <55560F10-32EF-48D6-9641-652ED2221E4A@mpi-cbg.de>
References: <D7931AC1-BA9B-4561-AA28-D901E3A652B4@mpi-cbg.de>
	<CAKcvfuSSjqh+XQdFhe28_3NSucKZBqy1z9Qjt8SvE7SV4XzaRg@mail.gmail.com>
	<CADN69yms-8syOAgw9ec0hbzbTJSDkU=eR_oO6fC+izx0GLspZA@mail.gmail.com>
	<55560F10-32EF-48D6-9641-652ED2221E4A@mpi-cbg.de>
Message-ID: <CADN69ymjFwYDg725ZCapeRF9Zpoa1rgpk4aCR7cT7sh91TiydQ@mail.gmail.com>

Hi Steffi,

> I do not see why <? extends RealType> would have any advantage.

Here is an example of a practical difference between the two constructs:

    ImgOpener imgOpener = new ImgOpener();
    ImgPlus<? extends RealType> img =
imgOpener.openImg("/Users/curtis/data/toucan.png");
    ImgPlus<RealType> realImg = (ImgPlus<RealType>) img;
    ImgPlus<UnsignedByteType> ubyteImg = (ImgPlus<UnsignedByteType>) img;
// this works
    ImgPlus<UnsignedByteType> ubyteImg2 = (ImgPlus<UnsignedByteType>)
realImg; // illegal
    ImgPlus<UnsignedByteType> ubyteImg3 = (ImgPlus) realImg; // also works

In the above example, the compiler allows casting a "ImgPlus<? extends
RealType>" to a "ImgPlus<UnsignedByteType>" (ubyteImg) but does not allow
doing so from a "ImgPlus<RealType>" (ubyteImg2). You instead must go
through a completely raw type to make it work (ubyteImg3).

I think "? extends RealType" is more correct, and also behaves better in
cases such as the above. However, I agree it is more of a pain to write, so
if you think the tradeoff is worth it, we can stick with ImgPlus<RealType>
instead and just document why we did it in the ImgOpener javadoc.

What do you think?

Regards,
Curtis


On Tue, Jul 31, 2012 at 5:18 PM, Stephan Preibisch <preibisch at mpi-cbg.de>wrote:

> Hi Barry, hi Curtis,
>
> the example you give would give you a warning, and, yes, - a runtime
> error. The problem is, there is no right way to do it as the type is not
> defined at compile time but instead depends on the image that is opened.
>
> However, I do not see why <? extends RealType> would have any advantage.
> It crashes on the exactly same thing, but is more tough to write, see here:
>
> Img< RealType >img = ImgOpener.open(
> "/Users/preibischs/Documents/Microscopy/SPIM/HisYFP-SPIM/spim_TL18_Angle0.lsm");
>  img.firstElement().add( new FloatType() );
>
> -> fails because cannot cast to ByteType (what the image is)
>
> Img< ? extends RealType >img = ImgOpener.open(
> "/Users/preibischs/Documents/Microscopy/SPIM/HisYFP-SPIM/spim_TL18_Angle0.lsm"
>  );
>  img.firstElement().add( new FloatType() );
>
> -> fails as well, but is more to write
>
> And the construct <? extends RealType<?>> would be correct but cannot be
> used in any generic method as it is not ensured that the first and the
> second "?" are the same.
>
> We still have to choose one of them, I still vote for Img< RealType >,
> because it is at least easy to write.
>
> The best is to open it as FloatType or as ByteType, but this is not always
> possible ...
>
> What do you think?
>
> Bye bye,
> Steffi
>
>
> On Jul 31, 2012, at 17:59 , Curtis Rueden wrote:
>
> Hi Barry,
>
>
>> This is just an example I've pulled from the web but it seems to imply
>> that an Img<UnsignedByteType> is not safely considered an Img<RealType>.
>
>
> Good point! We should probably use "Img<? extends RealType>" instead. I
> tested this with ImageJ2, and it still works as expected. And I believe all
> of Steffi's example cases will still work too. So I pushed these changes to
> the newimgopener branch.
>
> What do you think, Steffi? Anyone else?
>
> Regards,
> Curtis
>
>
> On Tue, Jul 31, 2012 at 4:28 PM, Barry DeZonia <bdezonia at gmail.com> wrote:
>
>> Steffi,
>>
>> I remember running into this when originally interfacing IJ2 to Imglib.
>> We did decided to go with Img<? extends RealType<?> as that seemed the most
>> safe at the time.
>>
>> What I'm wondering about with your solution is that it seems to
>> contradict other people's description as to what is legal to do in Java.
>>
>> As a contrived example think of the animal cage example:
>>
>> We have a Animal class and a Lion class derived from it. And a Cage class
>> that is defined Cage<T extends Animal>.
>>
>> Though Lion is instanceof Animal its not the case that Cage<Lion>
>> instanceof Cage<Animal>. This is counterintuitive but many people mention
>> it.
>>
>> If it was the case you could write code like this:
>>
>> Cage<Animal> animals;
>>
>>
>>
>> Cage<Lion> lions;
>>
>>
>>
>>
>> animals = lions; // This assignment is not allowed
>>
>>
>>
>>
>> animals.add(rat); // If this executed, we'd have a Rat in a Cage<Lion>
>>
>>
>> This is just an example I've pulled from the web but it seems to imply
>> that an Img<UnsignedByteType> is not safely considered an Img<RealType>. We
>> may be avoiding all such cases where it could be a problem but is it safe
>> going forward? I can't say I know.
>>
>>
>> On Tue, Jul 17, 2012 at 4:08 PM, Stephan Preibisch <preibisch at mpi-cbg.de>wrote:
>>
>>> Hi guys,
>>>
>>> this became a massive explanation. I suggest this as as solution to a
>>> problem we have been only partly aware of. I hope you enjoy reading ;)
>>>
>>> Steffi
>>>
>>>
>>> As the ImageJ conference is approaching I was talking with Johannes and
>>> we agreed that the ImgOpener needs to be finished. However, since its first
>>> version there has been a major design fault.
>>>
>>> But first the good news:
>>> --------------------------------
>>> It works perfectly fine if you say "open me an Image as float" or "...as
>>> UnsignedByte" or whatever, classically called by the method
>>> -> new ImgOpener.openImg( String id, ImgFactory<T> factory, T type );
>>> It can, without any problems, return you an Img<T>, and it requires that
>>> T is RealType (and not anymore NativeType, see at the end). So far, so good.
>>> Note that "T" is NOT a return parameter, but something you give to the
>>> openAs method.
>>>
>>> Now the bad news.
>>> --------------------------
>>> If you say "open this image as whatever RealType it is", it can do that,
>>> but it cannot assign a "T" to it - because T is not a return parameter. We
>>> made an ugly hack inside so that it seems as if it would work, but it does
>>> not. Now you might ask, why change it if it worked so far? Well, here is an
>>> easy example that would cause a ClassCastException on run time
>>>
>>> public static <T extends RealType< T >> void main( String[] args )
>>> {
>>>         Img< T > img1 = new ImgOpener.openImg( "somepic_8bit.tif" ); //
>>> 8-bit unsigned
>>>         Img< T > img2 = new ImgOpener.openImg( "somepic_32bit.tif" ); //
>>> 32-bit float
>>>
>>>         img1.firstElement().set( img2.firstElement() ); // run-time crash
>>> }
>>>
>>> It will throw a ClassCastException because img1 is of UnsignedByteType
>>> and img2 of FloatType. But as we cast it in a dirty way, it compiles just
>>> fine.
>>> So, we cannot return a "T", but what we can return is Img< which is at
>>> least a RealType >. And this is for sure always true, but img1 and img2 are
>>> not necessarily the same RealType (as above).
>>>
>>> The correct way (which doesn't work)
>>> --------------------------------------------------
>>> What we should return is an Img< ? extends RealType< ? > >. However, it
>>> is not ensured that the two "?" are the same, so an Img of this type is
>>> basically incompatible with everything else, which means an unchecked cast
>>> is necessary. So although correct, maybe not a good idea. And it is really
>>> ugly to write if necessary.
>>>
>>> The still somehow correct way
>>> -----------------------------------------
>>> Instead, it returns now an Img< RealType >. This is kind of a tradeoff.
>>> On one hand, this is very easy to write and will give you compile errors
>>> where it should, for example
>>>
>>>         img1.firstElement().set( img2.firstElement() ); // COMPILE ERROR
>>> (not the same RealType realization)
>>>
>>> OR
>>>
>>>        public <T extends RealType< T >> void add( IterableInterval< T >
>>> i1, IterableInterval< T > i2 ) { .... }
>>>        add( img1, img2 ); // COMPILE ERROR (not the same RealType
>>> realization)
>>>
>>> BUT
>>>
>>>         Gauss.inFloatInPlace( 2.0 , img1 ); // FINE (just one RealType
>>> realization required, inside it will be always the same "T")
>>>         Gauss.inFloatInPlace( 2.0 , img2 ); // FINE (just one RealType
>>> realization required, inside it will be always the same "T")
>>>
>>>         public < T extends RealType< T > > void add1( Img< T > img1,
>>> double value ) { ... }
>>>         add1( img1, 5 ); // FINE (just one RealType realization
>>> required, inside it will be always the same "T")
>>>
>>>         public < T extends RealType< T >, S extends RealType< S > > void
>>> add2( Img< T > img1, Img< S > img2 ) { ... }
>>>         add2( img1, img2 ); // FINE (explicitly two different RealType
>>> realizations are allowed)
>>>
>>>         public void add3( Img< RealType > img1, Img< RealType > img2 ) {
>>> ... }
>>>         add3( img1, img2 ); // FINE (both are just some kind of
>>> RealType, but gives a warning)
>>>
>>> On the other hand it gives a lot of Warnings because RealType should be
>>> more specified.
>>>
>>> Why not Img< RealType< ? > >
>>> ------------------------------------------
>>> Similar problem as in <? extends RealType< ? > >. RealType< ? > is not a
>>> valid substitute for any construct like < T extends RealType < T > >. One
>>> would have to cast to Img< RealType >, so we can take this one right away
>>> as it is less writing.
>>>
>>> Where did NativeType go?
>>> ------------------------------------
>>> I do not see any reason why we should enforce a NativeType. There is no
>>> objection to load an image into a (hypothetical) ListImg< BigDecimalType >.
>>>
>>> What are the implications?
>>> -----------------------------------
>>> We should write NOTHING except the method opening files for Img<
>>> RealType >. And also only if it is really required - quite often it is not.
>>> But if, Img< RealType > It is a completely valid input for any generic
>>> algorithm as show above for Gauss, add, etc.
>>>
>>>
>>>
>>> I implemented the changes on a branch called 'newimgopener'. It also
>>> contains four static convenience opening methods and a speed improvement.
>>>
>>> Any comments are very welcome. If somebody has a better idea how to
>>> solve the problem ... I am all ears ...
>>>
>>> Bye bye,
>>> Steffi
>>>
>>> --
>>> Please avoid top-posting, and please make sure to reply-to-all!
>>>
>>> Mailing list web interface: http://groups.google.com/group/fiji-devel
>>>
>>
>>
>> --
>> Please avoid top-posting, and please make sure to reply-to-all!
>>
>> Mailing list web interface: http://groups.google.com/group/fiji-devel
>>
>
>
> --
> Please avoid top-posting, and please make sure to reply-to-all!
>
> Mailing list web interface: http://groups.google.com/group/fiji-devel
>
>
>  --
> Please avoid top-posting, and please make sure to reply-to-all!
>
> Mailing list web interface: http://groups.google.com/group/fiji-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120801/3caf6c23/attachment-0001.html>

From Johannes.Schindelin at gmx.de  Wed Aug  1 12:29:38 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Wed, 1 Aug 2012 19:29:38 +0200 (CEST)
Subject: [ImageJ-devel] KNIME Image Processing 1.0 and ImageJ2
 Integration
In-Reply-To: <50194D94.5030505@uni-konstanz.de>
References: <50194D94.5030505@uni-konstanz.de>
Message-ID: <alpine.DEB.1.00.1208011929190.32459@s15462909.onlinehome-server.info>

Hi Martin,

On Wed, 1 Aug 2012, Martin Horn wrote:

> we are glad to announce that with yesterday's release of KNIME v2.6
> (http://www.knime.com/Version260) also the first mature version of the
> KNIME Image Processing Extension
> (http://tech.knime.org/community/image-processing) is available. We made
> a lot of changes under the hood and from now on we will try hard to be
> backwards compatible whenever possible (e.g. all workflows created with
> nodes of a 1.*.* version of this extension can be restored with the
> newest version).
> 
> Furthermore, we provide the first public version (still beta) of the
> ImageJ2 integration (http://tech.knime.org/community/imagej) allowing
> the easy creation of ImageJ2 plugins as KNIME nodes.
> 
> Additionally, we set up the OMERO integration plugin with a prototypic
> OMERO 4.3.2 reader. Details of the progress of the OMERO integration can
> be found at http://tech.knime.org/community/omero.
> 
> Enjoy the combination of KNIME, ImgLib2, ImageJ, ImageJ2, OMERO and
> Bioformats altogether.

Awesome!
Dscho


From Johannes.Schindelin at gmx.de  Wed Aug  1 12:37:26 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Wed, 1 Aug 2012 19:37:26 +0200 (CEST)
Subject: [ImageJ-devel] [fiji-devel] LOCI crashes with current Fiji
 build on runtime
In-Reply-To: <0bdea7ed-f911-48d8-865c-deba5ad2e263@googlegroups.com>
References: <04FEBFC9-2BBD-4D2C-8006-7BF45DAD468C@mpi-cbg.de>
	<20120723233028.GE10861@medusa>
	<236513BE-93E8-423C-AC44-3917360A56C7@mpi-cbg.de>
	<CADN69y=aKrng-WK53eHKTxfRAOpA1AB--GBYyg8THrsG=L34QA@mail.gmail.com>
	<0bdea7ed-f911-48d8-865c-deba5ad2e263@googlegroups.com>
Message-ID: <alpine.DEB.1.00.1208011935330.32459@s15462909.onlinehome-server.info>

Hi Sebi,

On Wed, 1 Aug 2012, sebrhode at gmail.com wrote:

> I tried to download the most up-to-date version (
> http://jenkins.imagej.net/job/Stable-Fiji/lastSuccessfulBuild/artifact/fiji-nojre.zip)
> 
> 
> This contains the loci_tools.jar as well as the the individual jars. So
> should i just delete which files? This issues is quite critical for us,
> since the Loci Bio-Format import is cruicial for us (and customer) to
> import the OME-TIFF data produced by our imaging software.

Yes, it is safe to delete loci_tools.jar. My work last year on enabling
multiple update sites introduced the bug that removing files from update
sites does not mark them as obsolete if you updated the files successfully
before. We just did not hit that bug because we did not remove files in a
long time ;-)

> Do you still have an idea when this problem might get solved?

It is fixed in the source code, I just have to upload a new version (for
which I need to be comfortable with the current state first, though ;-).
Should be happening within the hour.

Ciao,
Dscho


From simon.ochsenreither at googlemail.com  Wed Aug  1 12:41:07 2012
From: simon.ochsenreither at googlemail.com (simon.ochsenreither at googlemail.com)
Date: Wed, 1 Aug 2012 10:41:07 -0700 (PDT)
Subject: [ImageJ-devel] [fiji-devel] Significant change to ImgOpener -
 or - why ImgOpener.openImg() cannot return a T
In-Reply-To: <CAKcvfuSSjqh+XQdFhe28_3NSucKZBqy1z9Qjt8SvE7SV4XzaRg@mail.gmail.com>
References: <D7931AC1-BA9B-4561-AA28-D901E3A652B4@mpi-cbg.de>
	<CAKcvfuSSjqh+XQdFhe28_3NSucKZBqy1z9Qjt8SvE7SV4XzaRg@mail.gmail.com>
Message-ID: <1ab5fa11-e7f9-4d22-b44f-d8f8264a7121@googlegroups.com>

Hi Barry,

Though Lion is instanceof Animal its not the case that Cage<Lion> 
> instanceof Cage<Animal>. This is counterintuitive but many people mention 
> it. 
>
> If it was the case you could write code like this:
>
> Cage<Animal> animals;
> Cage<Lion> lions;
>
> animals = lions; // This assignment is not allowed
>
> animals.add(rat); // If this executed, we'd have a Rat in a Cage<Lion>
>
> Even if you wrote 

Cage<? extends Animal> animals

It would allow the assignment of lions to animals ...

animals = lions;


... but would still need to disallow the addition of anything under Animal 
(because it is in a contravariant position).
 
That's the reason why in some situations wildcards don't add much benefit 
despite forcing people to write boilerplate.?

The whole situation is made worse by some of the unreadable capture-of 
error messages produced from javac due to use-site variance and wildcards: 
https://gist.github.com/3229086
(Compare this with the error message from scalac: 
https://gist.github.com/3229104 ... the main issue is that Java code like 
that can sleep in the source code for years until someone tries to use it, 
while in Scala the code is rejected right at the declaration.)

The stuff javac does and sometimes doesn't is sometimes quite unfortunate. 
:-(

?See also 
http://www.slideshare.net/marakana/effective-java-still-effective-after-all-these-years 
(p. 28)  in which using wildcards for return types is discouraged.

Bye,

Simon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120801/c8d5fd30/attachment.html>

From ctrueden at wisc.edu  Wed Aug  1 15:54:12 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Wed, 1 Aug 2012 15:54:12 -0500
Subject: [ImageJ-devel] Basic usage of ImageJ2 libraries in seperate
 application (Simple display image in JFrame)
In-Reply-To: <CAD0z_xTHRKxRYajhc0R0giGNONWN9cpy5-U=waPE7VHx9U28kA@mail.gmail.com>
References: <CAD0z_xTHRKxRYajhc0R0giGNONWN9cpy5-U=waPE7VHx9U28kA@mail.gmail.com>
Message-ID: <CADN69ymtaN+TMctQQhAtYWMCbbx299GdE_uYY_QFvWWh9zEk5w@mail.gmail.com>

Hi Mark,

Apologies for the delay in my reply; I have been away for the past two
weeks on family leave.


>
> I have a (hopefully) simple question. I have a separate application
> which launches a JFrame which displays a DICOM image and provides
> basic functionality like zooming and ROI. I have this working with
> ImageJ libraries no problem (ImagePlus etc).
>
> I would like to replicate this using the new ImageJ2 libraries.
> However, when looking through the likely classes to guide me, I find
> myself getting lost!.
> I simply wish to display an image in a JFrame and provide the basis
> functionality that a standard ImageJ2 window does (zooming, scrolling
> through slices etc).
>

I wrote some sample code that does what you ask. See this new blog entry:

http://developer.imagej.net/2012/08/01/loading-and-displaying-dataset-imagej2-api

We hope to write lots more documentation over the next couple of months. In
the meantime, please let us know if you have any questions about it!

Regards,
Curtis


On Wed, Jul 18, 2012 at 1:15 AM, Marky <markyhb at gmail.com> wrote:

> Dear All,
>
> I have a (hopefully) simple question. I have a separate application
> which launches a JFrame which displays a DICOM image and provides
> basic functionality like zooming and ROI. I have this working with
> ImageJ libraries no problem (ImagePlus etc).
>
> I would like to replicate this using the new ImageJ2 libraries.
> However, when looking through the likely classes to guide me, I find
> myself getting lost!.
> I simply wish to display an image in a JFrame and provide the basis
> functionality that a standard ImageJ2 window does (zooming, scrolling
> through slices etc).
>
> Is there any help or advice you can give.
>
> Cheers,
> Mark
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120801/124e5eaf/attachment.html>

From G.Landini at bham.ac.uk  Thu Aug  2 06:05:36 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Thu, 02 Aug 2012 12:05:36 +0100
Subject: [ImageJ-devel] Where are all the plugins?
Message-ID: <2259753.fOaSJOOFp1@linux-913j>

A couple of questions that I think most people trying IJ2 fill face:

1. I installed the IJ2 beta3 and want to update to the latest snapshot. How do 
I do this? The website is not informative on this. E.g. the "latest snapshot" 
appears to contain older files than the beta 3.
What is one supposed to do with the Combined build file (*-all.jar)?
If there is a daily build (I supposed that this is what the latest snapshot 
is) why can't I get it via the updater?

2. I copied my plugins folder from IJ1 into the plugins folder of ij2.
Nothing appears under the plugin menu entry. Is that supposed to be so?
They cannot be found by the CTR+L command finder or the Control Panel.

Many thanks for any pointers.
Regards

Gabriel



From G.Landini at bham.ac.uk  Thu Aug  2 06:24:17 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Thu, 02 Aug 2012 12:24:17 +0100
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <2259753.fOaSJOOFp1@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j>
Message-ID: <2053516.oIYPUPlNAC@linux-913j>

On Thursday 02 Aug 2012 12:05:36 Gabriel Landini wrote:
> 2. I copied my plugins folder from IJ1 into the plugins folder of ij2.
> Nothing appears under the plugin menu entry. Is that supposed to be so?
> They cannot be found by the CTR+L command finder or the Control Panel.

OK, I got the plugins sorted, but  now I got a new problem.

The updater found a new updater version. Now, each time a start ij2 I get a 
message if I want to start the updater. If I say yes, it asks to restart IJ to 
finalize previous update.

I restart it and get the same message again. So basically the updater is never 
started.
Cheers

G.


From G.Landini at bham.ac.uk  Thu Aug  2 07:22:40 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Thu, 02 Aug 2012 13:22:40 +0100
Subject: [ImageJ-devel] Not-shown ImagePlus in IJ1 plugins are shown in IJ2
In-Reply-To: <2259753.fOaSJOOFp1@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j>
Message-ID: <1825894.nPyPCYtSrx@linux-913j>

Not sure if this has been flagged before.
When running an IJ1 plugin that creates an ImagePlus but it is not shown, the 
same plugin in IJ2 shows the image.

Is this something that can be resolved? If not, it might be impossible or 
painfully slow to run IJ1 plugins that create a large number of temporary 
ImagePlus but are not shown to be processed and then closed. In IJ2 they are 
all shown making the whole process very slow.

Cheers

Gabriel



From G.Landini at bham.ac.uk  Thu Aug  2 07:33:00 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Thu, 02 Aug 2012 13:33 +0100
Subject: [ImageJ-devel] Colour to greyscale?
Message-ID: <28598724.4byc8gmD4P@linux-913j>

I can't find a way of converting a colour image into greyscale in IJ2.

Cheers

Gabriel



From bdezonia at gmail.com  Fri Aug  3 14:07:40 2012
From: bdezonia at gmail.com (Barry DeZonia)
Date: Fri, 3 Aug 2012 14:07:40 -0500
Subject: [ImageJ-devel] Not-shown ImagePlus in IJ1 plugins are shown in
	IJ2
In-Reply-To: <1825894.nPyPCYtSrx@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j>
	<1825894.nPyPCYtSrx@linux-913j>
Message-ID: <CAKcvfuSGUm9PAd3LyhHF12OeVT_g_2-+LFRMS7pjZNstx38xsw@mail.gmail.com>

Hi Gabriel,

The current behavior could likely be improved. Can you provide me with an
example that I could use for testing where IJ1 opens few or no windows
while IJ2 opens many?

On Thu, Aug 2, 2012 at 7:22 AM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:

> Not sure if this has been flagged before.
> When running an IJ1 plugin that creates an ImagePlus but it is not shown,
> the
> same plugin in IJ2 shows the image.
>
> Is this something that can be resolved? If not, it might be impossible or
> painfully slow to run IJ1 plugins that create a large number of temporary
> ImagePlus but are not shown to be processed and then closed. In IJ2 they
> are
> all shown making the whole process very slow.
>
> Cheers
>
> Gabriel
>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120803/ca73176a/attachment.html>

From bdezonia at gmail.com  Fri Aug  3 14:11:27 2012
From: bdezonia at gmail.com (Barry DeZonia)
Date: Fri, 3 Aug 2012 14:11:27 -0500
Subject: [ImageJ-devel] Not-shown ImagePlus in IJ1 plugins are shown in
	IJ2
In-Reply-To: <CAKcvfuSGUm9PAd3LyhHF12OeVT_g_2-+LFRMS7pjZNstx38xsw@mail.gmail.com>
References: <2259753.fOaSJOOFp1@linux-913j> <1825894.nPyPCYtSrx@linux-913j>
	<CAKcvfuSGUm9PAd3LyhHF12OeVT_g_2-+LFRMS7pjZNstx38xsw@mail.gmail.com>
Message-ID: <CAKcvfuT6WWq6q2cE1XG93=0tXpqVLe95C+kNkLZ49unZ61762Q@mail.gmail.com>

Gabriel,

I have also opened a ticket for this issue which can be followed here:
http://code.imagej.net/trac/imagej/ticket/1367

On Fri, Aug 3, 2012 at 2:07 PM, Barry DeZonia <bdezonia at gmail.com> wrote:

> Hi Gabriel,
>
> The current behavior could likely be improved. Can you provide me with an
> example that I could use for testing where IJ1 opens few or no windows
> while IJ2 opens many?
>
>
> On Thu, Aug 2, 2012 at 7:22 AM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:
>
>> Not sure if this has been flagged before.
>> When running an IJ1 plugin that creates an ImagePlus but it is not shown,
>> the
>> same plugin in IJ2 shows the image.
>>
>> Is this something that can be resolved? If not, it might be impossible or
>> painfully slow to run IJ1 plugins that create a large number of temporary
>> ImagePlus but are not shown to be processed and then closed. In IJ2 they
>> are
>> all shown making the whole process very slow.
>>
>> Cheers
>>
>> Gabriel
>>
>>
>> _______________________________________________
>> ImageJ-devel mailing list
>> ImageJ-devel at imagej.net
>> http://imagej.net/mailman/listinfo/imagej-devel
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120803/923ac008/attachment.html>

From bdezonia at gmail.com  Fri Aug  3 14:22:03 2012
From: bdezonia at gmail.com (Barry DeZonia)
Date: Fri, 3 Aug 2012 14:22:03 -0500
Subject: [ImageJ-devel] Colour to greyscale?
In-Reply-To: <28598724.4byc8gmD4P@linux-913j>
References: <28598724.4byc8gmD4P@linux-913j>
Message-ID: <CAKcvfuT1yDV=3P1g0y01PN0RrqPzMvHU5uDNFWfgiaKwJ5+HCw@mail.gmail.com>

Hi Gabriel,

This is an oversight in the current implementation of the type changer code
in IJ2. I have opened a ticket for it here:

http://code.imagej.net/trac/imagej/ticket/1368

On Thu, Aug 2, 2012 at 7:33 AM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:

> I can't find a way of converting a colour image into greyscale in IJ2.
>
> Cheers
>
> Gabriel
>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120803/2602e76e/attachment.html>

From ctrueden at wisc.edu  Mon Aug  6 14:16:04 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Mon, 6 Aug 2012 14:16:04 -0500
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <2053516.oIYPUPlNAC@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
Message-ID: <CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>

Hi Gabriel,

> I restart it and get the same message again. So basically the updater is
never
> started.

This was a bug in the Updater (affecting both Fiji and ImageJ2) that has
hopefully been sorted now, thanks to Johannes's efforts. Please let us know
if not.

> 1. I installed the IJ2 beta3 and want to update to the latest snapshot.
How do
> I do this? The website is not informative on this. E.g. the "latest
snapshot"
> appears to contain older files than the beta 3.
>
> If there is a daily build (I supposed that this is what the latest
snapshot
> is) why can't I get it via the updater?

With any automatic update mechanism, there is a balance between providing
the latest bleeding edge features and bugfixes, and keeping things stable.
Different projects have different philosophies on where along that spectrum
is most appropriate. Some projects, such as the Mozilla Firefox project,
solve the quandary by providing multiple "update channels" depending on the
user's preferences. This is what we eventually hope to do for ImageJ: you
can choose whether to subscribe to release updates only (i.e., stable
channel), or whether you want to get all SNAPSHOT updates (i.e., unstable
from master branch of the codebase).

Personally I think people should need to explicitly subscribe to receive
unstable/SNAPSHOT updates. Otherwise, the people who do not like to be
pestered about updates too frequently would find the constant stream of
updates very annoying. The reliability of the software would also suffer
since not all commits to master are tested as thoroughly as releases are.
However, there *be* a way to subscribe to unstable updates, or else pushing
bugfixes to users who need them in a timely fashion becomes too difficult.

Until we get the multiple channel updates working though, we are erring on
the side of caution with the update site, meaning you must explicitly
download the latest snapshot build ZIP file if you want to try it before
each beta release.

> What is one supposed to do with the Combined build file (*-all.jar)?

This combined "uber-JAR" is for developers only, as an option, to use with
external integration. For example, CellProfiler uses it, rather than
bundling each of the individual ImageJ2 JAR files. It is not intended for
use with the ImageJ application bundle.

> 2. I copied my plugins folder from IJ1 into the plugins folder of ij2.
> Nothing appears under the plugin menu entry. Is that supposed to be so?
> They cannot be found by the CTR+L command finder or the Control Panel.

You said you got this sorted, so hopefully it was something easy. If you
had to do anything unintuitive, please let us know; it is supposed to "just
work" like ImageJ1 does.

Regards,
Curtis


On Thu, Aug 2, 2012 at 6:24 AM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:

> On Thursday 02 Aug 2012 12:05:36 Gabriel Landini wrote:
> > 2. I copied my plugins folder from IJ1 into the plugins folder of ij2.
> > Nothing appears under the plugin menu entry. Is that supposed to be so?
> > They cannot be found by the CTR+L command finder or the Control Panel.
>
> OK, I got the plugins sorted, but  now I got a new problem.
>
> The updater found a new updater version. Now, each time a start ij2 I get a
> message if I want to start the updater. If I say yes, it asks to restart
> IJ to
> finalize previous update.
>
> I restart it and get the same message again. So basically the updater is
> never
> started.
> Cheers
>
> G.
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120806/cf184237/attachment.html>

From ctrueden at wisc.edu  Mon Aug  6 14:25:54 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Mon, 6 Aug 2012 14:25:54 -0500
Subject: [ImageJ-devel] [ImageJ] #1104: Cannot open XML files for TrakEM2
In-Reply-To: <CAJj13_94c=v23MQDKsQrgq2aCLiuaj7kyumGhq++dKEcuex47Q@mail.gmail.com>
References: <020.c7c984eca64a70f3a3141e89796b25e3@imagej.net>
	<035.ad508dd6f01b8179ee6cdef84e50de65@imagej.net>
	<CAJj13_-hTZZ+vigsXskfV5KV6MbJ-8LfLoOt95Uw7eyk-tH6LQ@mail.gmail.com>
	<alpine.DEB.1.00.1207180043070.32459@s15462909.onlinehome-server.info>
	<CAJj13_94c=v23MQDKsQrgq2aCLiuaj7kyumGhq++dKEcuex47Q@mail.gmail.com>
Message-ID: <CADN69y=0qtWpj39baXR3svOPS2CvN2oEN0-dRyBtcSOwkiZELw@mail.gmail.com>

Hi Albert et. al,

Barry wrote:
> I have heard nothing back. Albert, I am closing this ticket as invalid. If
> you have more details then reopen this ticket and provide them. Thanks.

The reason Barry heard nothing back is because Albert replied to the
trac at imagej.net email address, which is *not* a shortcut for updating the
Trac ticket, but only goes to me. So I saw his reply months ago (in April)
where it sat in my "to-do" queue until Barry closed the ticket. So sorry
for that, Albert.

Ideally we would set up that email address to update the Trac tickets
intelligently, but it is a technical challenge that would take a
non-trivial amount of time to achieve. So instead I'll ask that if you want
to update a ticket, you either log in to Trac to do it, or just send an
email to imagej-devel about it. Further, I'll try to be better about
handling incoming mail to trac at imagej.net in a prompt fashion.

Albert wrote:
> Regarding ImageJ-2s opener: it is unclear to me if the policy will be
> to be able to open anything from "File - Open" like in ImageJ-1. If
> not, that's fine: TrakEM2 would open from "File - Import - TrakEM2" or
> another appropriate entry point.

The plan is for "File > Open" and "File > Save" to be extensible with I/O
plugins, a particular type of ImageJ plugin. There is a ticket for this:

    http://trac.imagej.net/ticket/9

Unfortunately, it has been repeatedly pushed back. It is something I am
hoping to finish for beta4 or beta5, though difficult to say for sure at
this point whether it will make it in. It is definitely an important
feature of ImageJ2 we need to complete before the 2.0.0 release version.

Regards,
Curtis


On Wed, Jul 18, 2012 at 12:30 AM, Albert Cardona <sapristi at gmail.com> wrote:

> 2012/7/18 Johannes Schindelin <Johannes.Schindelin at gmx.de>:
> > Hi Albert,
> >
> > On Wed, 18 Jul 2012, Albert Cardona wrote:
> >
> >> 2012/7/17 ImageJ <trac at imagej.net>:
> >> > #1104: Cannot open XML files for TrakEM2
> >> > ----------------------+---------------------------------
> >> >  Reporter:  bdezonia  |       Owner:  bdezonia
> >> >      Type:  defect    |      Status:  closed
> >> >  Priority:  major     |   Milestone:  imagej-2.0.0-beta4
> >> > Component:  other     |     Version:
> >> >  Severity:  serious   |  Resolution:  invalid
> >> >  Keywords:            |  Blocked By:
> >> >  Blocking:            |
> >> > ----------------------+---------------------------------
> >> > Changes (by bdezonia):
> >> >
> >> >  * status:  new => closed
> >> >  * resolution:   => invalid
> >> >
> >> >
> >> > Comment:
> >> >
> >> >  I have heard nothing back. Albert, I am closing this ticket as
> invalid. If
> >> >  you have more details then reopen this ticket and provide them.
> Thanks.
> >>
> >> "create  trakem2 project, push s to save it into an xml file, them run
> >> imagej2 file open."
> >>
> >> You will see that it does not open as TrakEM2, but the LOCI dialog
> opens.
> >
> > As sad as it makes me, Barry does not have Fiji installed. The best way
> to
> > let him reproduce, therefore, is to provide a minimal TrakEM2 project,
> > maybe zipped up.
> >
> > If you do not expect plain ImageJ to work without TrakEM2 installed as a
> > plugin, please say so and zip up a minimal installation. Using the Fiji
> > Package Manager, this is easy.
> >
> > Ciao,
> > Johannes
>
>
> There are several TrakEM2 XML online, here is one:
>
>   http://www.ini.uzh.ch/~acardona/data/Seg.tar.bz2
>
> (Used in the EM segmentation challenge:
> http://www.ini.uzh.ch/~acardona/data.html )
>
>
> Regarding ImageJ-2s opener: it is unclear to me if the policy will be
> to be able to open anything from "File - Open" like in ImageJ-1. If
> not, that's fine: TrakEM2 would open from "File - Import - TrakEM2" or
> another appropriate entry point.
>
> Albert
>
>
>
> --
> http://albert.rierol.net
> http://www.ini.uzh.ch/~acardona/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120806/33bef05d/attachment.html>

From sapristi at gmail.com  Mon Aug  6 14:37:51 2012
From: sapristi at gmail.com (Albert Cardona)
Date: Mon, 6 Aug 2012 21:37:51 +0200
Subject: [ImageJ-devel] [ImageJ] #1104: Cannot open XML files for TrakEM2
In-Reply-To: <CADN69y=0qtWpj39baXR3svOPS2CvN2oEN0-dRyBtcSOwkiZELw@mail.gmail.com>
References: <020.c7c984eca64a70f3a3141e89796b25e3@imagej.net>
	<035.ad508dd6f01b8179ee6cdef84e50de65@imagej.net>
	<CAJj13_-hTZZ+vigsXskfV5KV6MbJ-8LfLoOt95Uw7eyk-tH6LQ@mail.gmail.com>
	<alpine.DEB.1.00.1207180043070.32459@s15462909.onlinehome-server.info>
	<CAJj13_94c=v23MQDKsQrgq2aCLiuaj7kyumGhq++dKEcuex47Q@mail.gmail.com>
	<CADN69y=0qtWpj39baXR3svOPS2CvN2oEN0-dRyBtcSOwkiZELw@mail.gmail.com>
Message-ID: <F1BA7F37-5067-455F-94C1-A9DEBBFFA8D7@gmail.com>


On Aug 6, 2012, at 9:25 PM, Curtis Rueden <ctrueden at wisc.edu> wrote:

> Hi Albert et. al,
> 
> Barry wrote:
> > I have heard nothing back. Albert, I am closing this ticket as invalid. If
> > you have more details then reopen this ticket and provide them. Thanks.
> 
> The reason Barry heard nothing back is because Albert replied to the trac at imagej.net email address, which is *not* a shortcut for updating the Trac ticket, but only goes to me. So I saw his reply months ago (in April) where it sat in my "to-do" queue until Barry closed the ticket. So sorry for that, Albert.
> 
> Ideally we would set up that email address to update the Trac tickets intelligently, but it is a technical challenge that would take a non-trivial amount of time to achieve. So instead I'll ask that if you want to update a ticket, you either log in to Trac to do it, or just send an email to imagej-devel about it. Further, I'll try to be better about handling incoming mail to trac at imagej.net in a prompt fashion.
> 
> Albert wrote:
> > Regarding ImageJ-2s opener: it is unclear to me if the policy will be
> > to be able to open anything from "File - Open" like in ImageJ-1. If
> > not, that's fine: TrakEM2 would open from "File - Import - TrakEM2" or
> > another appropriate entry point.
> 
> The plan is for "File > Open" and "File > Save" to be extensible with I/O plugins, a particular type of ImageJ plugin. There is a ticket for this:
> 
>     http://trac.imagej.net/ticket/9
> 
> Unfortunately, it has been repeatedly pushed back. It is something I am hoping to finish for beta4 or beta5, though difficult to say for sure at this point whether it will make it in. It is definitely an important feature of ImageJ2 we need to complete before the 2.0.0 release version.
> 
> Regards,
> Curtis
> 



Thanks Curtis! Will keep it in mind.
Perhaps the trac email could have a reply-to field or a no-reply.

Albert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120806/f53f8f01/attachment-0001.html>

From G.Landini at bham.ac.uk  Mon Aug  6 18:16:14 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Tue, 7 Aug 2012 00:16:14 +0100
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
Message-ID: <201208070016.15282.G.Landini@bham.ac.uk>

> > I restart it and get the same message again. So basically the updater is
> > never started.
> 
> This was a bug in the Updater (affecting both Fiji and ImageJ2) that has
> hopefully been sorted now, thanks to Johannes's efforts. Please let us
> know if not.

Hi,
OK, I will test this next week.

> Until we get the multiple channel updates working though, we are erring on
> the side of caution with the update site, meaning you must explicitly
> download the latest snapshot build ZIP file if you want to try it before
> each beta release.

Right but my point was that the "latest" was not so latest as the files were 
older than the beta avaiable... and so it becomes a confusing issue.
 
> > What is one supposed to do with the Combined build file (*-all.jar)?
> 
> This combined "uber-JAR" is for developers only, as an option, to use with
> external integration. For example, CellProfiler uses it, rather than
> bundling each of the individual ImageJ2 JAR files. It is not intended for
> use with the ImageJ application bundle.

I see, I also think that this needs explanation in that page.

> You said you got this sorted, so hopefully it was something easy. If you
> had to do anything unintuitive, please let us know; it is supposed to
> "just work" like ImageJ1 does.

I emailed Barry an example plugin where things do not work as expected (not 
sure if he received that).
The downloads page should perhaps be more explicit about the possibility of 
openjdk not working with the IJ2 beta (and Oracle's Java 1.7 has some problems 
too...).
For example opensuse ships with openjdk by default (and at least some old 
versions of Kubuntu did as well).

Cheeers

Gabriel


From Johannes.Schindelin at gmx.de  Tue Aug  7 12:01:45 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Tue, 7 Aug 2012 19:01:45 +0200 (CEST)
Subject: [ImageJ-devel] merge imagej-tutorials into imagej.git?
Message-ID: <alpine.DEB.1.00.1208071859010.32459@s15462909.onlinehome-server.info>

Hi Curtis,

I wonder whether it'd make sense to merge the tutorials into a
subdirectory of our main repository? That way, we could share code between
tutorials and regression tests more easily...

This comes from my experience of the Script Editor where the Templates
were compiled all the time so we caught API breakages that way...

Ciao,
Dscho


From ctrueden at wisc.edu  Tue Aug  7 13:00:39 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Tue, 7 Aug 2012 13:00:39 -0500
Subject: [ImageJ-devel] merge imagej-tutorials into imagej.git?
In-Reply-To: <alpine.DEB.1.00.1208071859010.32459@s15462909.onlinehome-server.info>
References: <alpine.DEB.1.00.1208071859010.32459@s15462909.onlinehome-server.info>
Message-ID: <CADN69ykr-ipFdV0pmvrFFxLO4ThnzcoP8xntzLFBazT-P+uWFw@mail.gmail.com>

Hi Dscho,


> I wonder whether it'd make sense to merge the tutorials into a
> subdirectory of our main repository? That way, we could share code between
> tutorials and regression tests more easily...


There are pros and cons. The reason I made a separate repository is to
prove that you do not need to check out the ImageJ2 source code in order to
easily work with ImageJ2. This more closely models what external developers
will do: create a new project with dependencies on ImageJ2 artifacts and go
from there.

That said, I am not necessarily against merging the tutorials back in, if
it would make our lives a lot easier. Could you give an example of such
code sharing in action?

Regards,
Curtis


On Tue, Aug 7, 2012 at 12:01 PM, Johannes Schindelin <
Johannes.Schindelin at gmx.de> wrote:

> Hi Curtis,
>
> I wonder whether it'd make sense to merge the tutorials into a
> subdirectory of our main repository? That way, we could share code between
> tutorials and regression tests more easily...
>
> This comes from my experience of the Script Editor where the Templates
> were compiled all the time so we caught API breakages that way...
>
> Ciao,
> Dscho
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120807/24c1d0b3/attachment.html>

From Johannes.Schindelin at gmx.de  Tue Aug  7 13:05:31 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Tue, 7 Aug 2012 20:05:31 +0200 (CEST)
Subject: [ImageJ-devel] merge imagej-tutorials into imagej.git?
In-Reply-To: <CADN69ykr-ipFdV0pmvrFFxLO4ThnzcoP8xntzLFBazT-P+uWFw@mail.gmail.com>
References: <alpine.DEB.1.00.1208071859010.32459@s15462909.onlinehome-server.info>
	<CADN69ykr-ipFdV0pmvrFFxLO4ThnzcoP8xntzLFBazT-P+uWFw@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.1208072004050.32459@s15462909.onlinehome-server.info>

Hi Curtis,

On Tue, 7 Aug 2012, Curtis Rueden wrote:

> > I wonder whether it'd make sense to merge the tutorials into a
> > subdirectory of our main repository? That way, we could share code
> > between tutorials and regression tests more easily...
> 
> 
> There are pros and cons. The reason I made a separate repository is to
> prove that you do not need to check out the ImageJ2 source code in order
> to easily work with ImageJ2. This more closely models what external
> developers will do: create a new project with dependencies on ImageJ2
> artifacts and go from there.
> 
> That said, I am not necessarily against merging the tutorials back in,
> if it would make our lives a lot easier. Could you give an example of
> such code sharing in action?

I do not have a real-life example of code sharing except the one I gave,
which is not really code-sharing but code-compiling (to make sure things
work, still).

So it's probably better to keep the separate repository, and add a Jenkins
job to compile it after compiling ImageJ, right? If you like that idea, I
will make that job.

Ciao,
Dscho


From ctrueden at wisc.edu  Tue Aug  7 13:10:16 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Tue, 7 Aug 2012 13:10:16 -0500
Subject: [ImageJ-devel] merge imagej-tutorials into imagej.git?
In-Reply-To: <alpine.DEB.1.00.1208072004050.32459@s15462909.onlinehome-server.info>
References: <alpine.DEB.1.00.1208071859010.32459@s15462909.onlinehome-server.info>
	<CADN69ykr-ipFdV0pmvrFFxLO4ThnzcoP8xntzLFBazT-P+uWFw@mail.gmail.com>
	<alpine.DEB.1.00.1208072004050.32459@s15462909.onlinehome-server.info>
Message-ID: <CADN69ym0MDDVZGQkabDKY6fAX2ESHtCB=v8_JM33VQtG7etWoA@mail.gmail.com>

Hi Dscho,


> So it's probably better to keep the separate repository, and add a Jenkins
> job to compile it after compiling ImageJ, right? If you like that idea, I
> will make that job.


Sure, for CI I think having a downstream Jenkins job for the tutorials
would be great.

It does not address your issue of code sharing, but let's reevaluate after
doing a bit more work on the tutorials over the next couple of months. I
think it will become more clear over time whether merging the repos is a
good idea.

Regards,
Curtis


On Tue, Aug 7, 2012 at 1:05 PM, Johannes Schindelin <
Johannes.Schindelin at gmx.de> wrote:

> Hi Curtis,
>
> On Tue, 7 Aug 2012, Curtis Rueden wrote:
>
> > > I wonder whether it'd make sense to merge the tutorials into a
> > > subdirectory of our main repository? That way, we could share code
> > > between tutorials and regression tests more easily...
> >
> >
> > There are pros and cons. The reason I made a separate repository is to
> > prove that you do not need to check out the ImageJ2 source code in order
> > to easily work with ImageJ2. This more closely models what external
> > developers will do: create a new project with dependencies on ImageJ2
> > artifacts and go from there.
> >
> > That said, I am not necessarily against merging the tutorials back in,
> > if it would make our lives a lot easier. Could you give an example of
> > such code sharing in action?
>
> I do not have a real-life example of code sharing except the one I gave,
> which is not really code-sharing but code-compiling (to make sure things
> work, still).
>
> So it's probably better to keep the separate repository, and add a Jenkins
> job to compile it after compiling ImageJ, right? If you like that idea, I
> will make that job.
>
> Ciao,
> Dscho
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120807/f7a12f61/attachment.html>

From grislis at wisc.edu  Tue Aug  7 13:58:07 2012
From: grislis at wisc.edu (Aivar Grislis)
Date: Tue, 07 Aug 2012 13:58:07 -0500
Subject: [ImageJ-devel] Fwd: IJ2 work/LUTs
In-Reply-To: <50216230.3000105@wisc.edu>
References: <50216230.3000105@wisc.edu>
Message-ID: <5021653F.40504@wisc.edu>

I meant to send this to the imagej-devel list...

-------- Original Message --------
Subject: 	IJ2 work/LUTs
Date: 	Tue, 07 Aug 2012 13:45:04 -0500
From: 	Aivar Grislis <grislis at wisc.edu>
To: 	imagej-devel at imagejdev.org, Curtis Rueden <ctrueden at wisc.edu>



I've been looking at IJ2 trying to figure out how SLIM Plugin fits in.
I was looking at the LUT code & am interested in refactoring it.

I found some non-linearity bugs in the way LUTs are applied in the
AutoContrast and DefaultImageDisplay plugins that I could fix.

The LUT API could be improved.  There are two kinds of LUTs, ColorTable8
and ColorTable16, the former is what's being used as a LUT, the latter
is in the codebase but not really used or displayed AFAIK.

This could be a Service or other Plugin.  I would consolidate the
RealLUTConverter class into LUTs, LUTs would contain a ColorTable, the
API might be something like this:

// constructor
LUT(ColorTable colorTable);

// given a min/max range for the LUT, what is the color for current value?
ARGBType lookup(double min, double max, double value);

// get a swath of colors to use to display the LUT
ARGBType[] getColors(int bins);

Refactoring this isn't essential to SLIM Plugin, but it might be a good
way to get up to speed with IJ2 work.

Aivar




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120807/d0f3fab0/attachment.html>

From grislis at wisc.edu  Tue Aug  7 16:45:00 2012
From: grislis at wisc.edu (Aivar Grislis)
Date: Tue, 07 Aug 2012 16:45:00 -0500
Subject: [ImageJ-devel] IJ2 work/Histogram
Message-ID: <50218C5C.9090005@wisc.edu>

I'd also be interested in working on the histogram code.  Mostly the 
code that generates histogram data, also their display, perhaps the 
histogram tool itself.

SLIM Plugin uses histograms in a very dynamic way, as they are updated 
periodically during the fit process.  You can change the minimum and 
maximum values interactively.  So I might be an interested consumer of 
any common histogram code.

(I looked at the histogram code in the AutoContrast plugin, 
net.imglib2.algorithm.stats.Histogram, and 
net.imglib2.script.analysis.Histogram and found bugs in all of them when 
binning up the histogram values.)

Aivar



From Johannes.Schindelin at gmx.de  Wed Aug  8 11:23:21 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Wed, 8 Aug 2012 18:23:21 +0200 (CEST)
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <2053516.oIYPUPlNAC@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
Message-ID: <alpine.DEB.1.00.1208081822160.32459@s15462909.onlinehome-server.info>

Hi Gabriel,

On Thu, 2 Aug 2012, Gabriel Landini wrote:

> The updater found a new updater version. Now, each time a start ij2 I
> get a message if I want to start the updater. If I say yes, it asks to
> restart IJ to finalize previous update.
> 
> I restart it and get the same message again. So basically the updater is
> never started.

Does this problem persist? I tried very hard to work out the kinks of the
updater after I moved it to ImageJ (and made Fiji's updater a pretty dumb
plugin that just hands off to the ImageJ updater).

Ciao,
Dscho


From Johannes.Schindelin at gmx.de  Wed Aug  8 11:30:07 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Wed, 8 Aug 2012 18:30:07 +0200 (CEST)
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <201208070016.15282.G.Landini@bham.ac.uk>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
	<201208070016.15282.G.Landini@bham.ac.uk>
Message-ID: <alpine.DEB.1.00.1208081824510.32459@s15462909.onlinehome-server.info>

Hi Gabriel,

On Tue, 7 Aug 2012, Gabriel Landini wrote:

> > Until we get the multiple channel updates working though, we are
> > erring on the side of caution with the update site, meaning you must
> > explicitly download the latest snapshot build ZIP file if you want to
> > try it before each beta release.
> 
> Right but my point was that the "latest" was not so latest as the files
> were older than the beta avaiable... and so it becomes a confusing
> issue.

The past weeks I worked hard on the updater, so we will probably have
those "nightlies" as an update site. They might not even be "nightlies"
but uploaded whenever there is a change in the source code repository that
has been verified by Jenkins as compiling and passing the regression
tests.

Having said that, please don't hold your breath for it... there are other
projects I need to take care of, projects which had to wait for me to
finalize the current state of the updater.

Ciao,
Dscho


From ctrueden at wisc.edu  Wed Aug  8 15:22:44 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Wed, 8 Aug 2012 15:22:44 -0500
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
Message-ID: <CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>

Hi Steffi,

> The same happens when I make a new clone of Fiji ...

I am doing a full build of Fiji to help diagnose.

The problem is certainly that there is a mismatch between JAR versions.

Is there a loci_tools.jar anywhere? If so, delete it. If not, the problem
must be that an old bio-formats.jar is lying around somewhere?that stack
trace indicates an old ZeissLSMReader.

I'll write back with any additional insight after some more testing.

-Curtis


On Wed, Aug 8, 2012 at 3:20 PM, Stephan Preibisch <preibisch at mpi-cbg.de>wrote:

> The same happens when I make a new clone of Fiji ...
>
> git clone ...
> git submoule init modules/imglib (without that Colocalization_Analysis and
> Fiji does not compile btw)
> git submodule update
> Build
> ImageJ
> Plugins > LOCI > Import ... choose LSM
>
> > crash
>
> Steffi
>
> On Aug 8, 2012, at 15:59 , Stephan Preibisch wrote:
>
> > Hi guys,
> >
> > during the last hour LOCI stopped working on all my machines when I try
> to open LSM files (Fiji checkout master, Build clean, Build):
> >
> > an example is here: http://fly.mpi-cbg.de/preibisch/nm/HisYFP-SPIM.zip
> >
> > preibischs-lm1:fiji preibischs$ ./ImageJ
> > SLF4J: Class path contains multiple SLF4J bindings.
> > SLF4J: Found binding in
> [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12-1.5.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
> > SLF4J: Found binding in
> [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12.jar!/org/slf4j/impl/StaticLoggerBinder.class]
> > SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an
> explanation.
> > [ERROR] "loci.formats.in.PovrayReader" is not valid.
> > [ERROR] "loci.formats.in.IMODReader" is not valid.
> > [ERROR] "loci.formats.in.OperettaReader" is not valid.
> > [ERROR] "loci.formats.in.ZeissTIFFReader" is not valid.
> > [ERROR] "loci.formats.in.HRDGDFReader" is not valid.
> > [ERROR] "loci.formats.in.CanonRawReader" is not valid.
> > [INFO ] Reading LSM metadata for series #0
> > java.lang.reflect.InvocationTargetException
> >       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
> >       at
> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
> >       at
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
> >       at java.lang.reflect.Method.invoke(Method.java:597)
> >       at ij.Command.runPlugIn(Command.java:146)
> >       at ij.Command.runCommand(Command.java:95)
> >       at ij.Executer.run(Executer.java:64)
> >       at java.lang.Thread.run(Thread.java:680)
> > Caused by: java.lang.NoSuchMethodError:
> loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
> >       at
> loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
> >       at
> loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
> >       at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
> >       at loci.formats.FormatReader.setId(FormatReader.java:1105)
> >       at
> loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
> >       at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
> >       at loci.plugins.in.Importer.showDialogs(Importer.java:141)
> >       at loci.plugins.in.Importer.run(Importer.java:79)
> >       at loci.plugins.LociImporter.run(LociImporter.java:81)
> >       at ij.IJ.runUserPlugIn(IJ.java:185)
> >       at ij.IJ.runPlugIn(IJ.java:152)
> >       ... 8 more
> > [INFO ] Reading IFDs
> > [INFO ] Populating metadata
> > [INFO ] Checking comment style
> > [INFO ] Populating OME metadata
> >
> >
> > I tried replacing scifio, loci_plugins, anything that starts or includes
> loci with different versions (from the download version of Fiji and an
> older checkout where it still works) - but it will continue failing.
> >
> > I was just working on my SPIM code and suddenly it broke upon a ./Build
> where I changed nothing but my files ...
> >
> > Does anybody have a suggestion?
> >
> > Thanks a lot,
> > Steffi
> >
> > --
> > Please avoid top-posting, and please make sure to reply-to-all!
> >
> > Mailing list web interface: http://groups.google.com/group/fiji-devel
>
> --
> Please avoid top-posting, and please make sure to reply-to-all!
>
> Mailing list web interface: http://groups.google.com/group/fiji-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120808/354a03e1/attachment.html>

From preibisch at mpi-cbg.de  Wed Aug  8 15:33:16 2012
From: preibisch at mpi-cbg.de (Stephan Preibisch)
Date: Wed, 8 Aug 2012 16:33:16 -0400
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
Message-ID: <465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>

No, I can only see

jars/
MD5 (scifio.jar) = 9e101ed5cd590534f74d0001b98c1918
MD5 (loci-common.jar) = 10d372b14b99965ec8c8f809d5973853

plugins/
MD5 (loci_plugins.jar) = 9b4a563016f5c2e9e1347a2c969bba05

For some files I get a different error:
Caused by: java.lang.NoSuchMethodError: loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
	at loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
	at loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
	at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
	at loci.formats.FormatReader.setId(FormatReader.java:1105)
	at loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
	at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
	at loci.plugins.in.Importer.showDialogs(Importer.java:141)
	at loci.plugins.in.Importer.run(Importer.java:79)
	at loci.plugins.LociImporter.run(LociImporter.java:81)
	at ij.IJ.runUserPlugIn(IJ.java:185)
	at ij.IJ.runPlugIn(IJ.java:152)
	... 8 more

Beanshell reports for: 
print( loci.formats.meta.MetadataStore.class.getResource( "/loci/formats/meta/MetadataStore.class" ));
jar:file:/Users/preibischs/workspace/fiji/jars/scifio.jar!/loci/formats/meta/MetadataStore.class

Thanks for looking into it, 
Steffi

On Aug 8, 2012, at 16:22 , Curtis Rueden wrote:

> Hi Steffi,
> 
> > The same happens when I make a new clone of Fiji ...
> 
> I am doing a full build of Fiji to help diagnose.
> 
> The problem is certainly that there is a mismatch between JAR versions.
> 
> Is there a loci_tools.jar anywhere? If so, delete it. If not, the problem must be that an old bio-formats.jar is lying around somewhere?that stack trace indicates an old ZeissLSMReader.
> 
> I'll write back with any additional insight after some more testing.
> 
> -Curtis
> 
> 
> On Wed, Aug 8, 2012 at 3:20 PM, Stephan Preibisch <preibisch at mpi-cbg.de> wrote:
> The same happens when I make a new clone of Fiji ...
> 
> git clone ...
> git submoule init modules/imglib (without that Colocalization_Analysis and Fiji does not compile btw)
> git submodule update
> Build
> ImageJ
> Plugins > LOCI > Import ... choose LSM
> 
> > crash
> 
> Steffi
> 
> On Aug 8, 2012, at 15:59 , Stephan Preibisch wrote:
> 
> > Hi guys,
> >
> > during the last hour LOCI stopped working on all my machines when I try to open LSM files (Fiji checkout master, Build clean, Build):
> >
> > an example is here: http://fly.mpi-cbg.de/preibisch/nm/HisYFP-SPIM.zip
> >
> > preibischs-lm1:fiji preibischs$ ./ImageJ
> > SLF4J: Class path contains multiple SLF4J bindings.
> > SLF4J: Found binding in [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12-1.5.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
> > SLF4J: Found binding in [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12.jar!/org/slf4j/impl/StaticLoggerBinder.class]
> > SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
> > [ERROR] "loci.formats.in.PovrayReader" is not valid.
> > [ERROR] "loci.formats.in.IMODReader" is not valid.
> > [ERROR] "loci.formats.in.OperettaReader" is not valid.
> > [ERROR] "loci.formats.in.ZeissTIFFReader" is not valid.
> > [ERROR] "loci.formats.in.HRDGDFReader" is not valid.
> > [ERROR] "loci.formats.in.CanonRawReader" is not valid.
> > [INFO ] Reading LSM metadata for series #0
> > java.lang.reflect.InvocationTargetException
> >       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
> >       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
> >       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
> >       at java.lang.reflect.Method.invoke(Method.java:597)
> >       at ij.Command.runPlugIn(Command.java:146)
> >       at ij.Command.runCommand(Command.java:95)
> >       at ij.Executer.run(Executer.java:64)
> >       at java.lang.Thread.run(Thread.java:680)
> > Caused by: java.lang.NoSuchMethodError: loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
> >       at loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
> >       at loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
> >       at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
> >       at loci.formats.FormatReader.setId(FormatReader.java:1105)
> >       at loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
> >       at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
> >       at loci.plugins.in.Importer.showDialogs(Importer.java:141)
> >       at loci.plugins.in.Importer.run(Importer.java:79)
> >       at loci.plugins.LociImporter.run(LociImporter.java:81)
> >       at ij.IJ.runUserPlugIn(IJ.java:185)
> >       at ij.IJ.runPlugIn(IJ.java:152)
> >       ... 8 more
> > [INFO ] Reading IFDs
> > [INFO ] Populating metadata
> > [INFO ] Checking comment style
> > [INFO ] Populating OME metadata
> >
> >
> > I tried replacing scifio, loci_plugins, anything that starts or includes loci with different versions (from the download version of Fiji and an older checkout where it still works) - but it will continue failing.
> >
> > I was just working on my SPIM code and suddenly it broke upon a ./Build where I changed nothing but my files ...
> >
> > Does anybody have a suggestion?
> >
> > Thanks a lot,
> > Steffi
> >
> > --
> > Please avoid top-posting, and please make sure to reply-to-all!
> >
> > Mailing list web interface: http://groups.google.com/group/fiji-devel
> 
> --
> Please avoid top-posting, and please make sure to reply-to-all!
> 
> Mailing list web interface: http://groups.google.com/group/fiji-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120808/6a8db7c4/attachment.html>

From ctrueden at wisc.edu  Wed Aug  8 17:13:21 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Wed, 8 Aug 2012 17:13:21 -0500
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
	<465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
Message-ID: <CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>

Hi Steffi,

I had problems building Fiji from source from a fresh clone. Johannes & I
debugged it, and found a problem with how Fiji's build system was resolving
versions. That is now fixed and pushed to master. Afterwards, I tried
opening one of your sample LSMs, and was able to do so successfully. So my
hope is that this versioning issue is the same problem afflicting your
setup as well.

Can you please give it a try with the latest Fiji master and let us know
how it goes?

Regards,
Curtis


On Wed, Aug 8, 2012 at 3:33 PM, Stephan Preibisch <preibisch at mpi-cbg.de>wrote:

> No, I can only see
>
> jars/
> MD5 (scifio.jar) = 9e101ed5cd590534f74d0001b98c1918
> MD5 (loci-common.jar) = 10d372b14b99965ec8c8f809d5973853
>
> plugins/
> MD5 (loci_plugins.jar) = 9b4a563016f5c2e9e1347a2c969bba05
>
> For some files I get a different error:
> Caused by: java.lang.NoSuchMethodError:
> loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
> at
> loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
>  at loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
> at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
>  at loci.formats.FormatReader.setId(FormatReader.java:1105)
> at loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
>  at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
> at loci.plugins.in.Importer.showDialogs(Importer.java:141)
>  at loci.plugins.in.Importer.run(Importer.java:79)
> at loci.plugins.LociImporter.run(LociImporter.java:81)
> at ij.IJ.runUserPlugIn(IJ.java:185)
>  at ij.IJ.runPlugIn(IJ.java:152)
> ... 8 more
>
> Beanshell reports for:
> print( loci.formats.meta.MetadataStore.class.getResource(
> "/loci/formats/meta/MetadataStore.class" ));
>
> jar:file:/Users/preibischs/workspace/fiji/jars/scifio.jar!/loci/formats/meta/MetadataStore.class
>
> Thanks for looking into it,
> Steffi
>
> On Aug 8, 2012, at 16:22 , Curtis Rueden wrote:
>
> Hi Steffi,
>
> > The same happens when I make a new clone of Fiji ...
>
> I am doing a full build of Fiji to help diagnose.
>
> The problem is certainly that there is a mismatch between JAR versions.
>
> Is there a loci_tools.jar anywhere? If so, delete it. If not, the problem
> must be that an old bio-formats.jar is lying around somewhere?that stack
> trace indicates an old ZeissLSMReader.
>
> I'll write back with any additional insight after some more testing.
>
> -Curtis
>
>
> On Wed, Aug 8, 2012 at 3:20 PM, Stephan Preibisch <preibisch at mpi-cbg.de>wrote:
>
>> The same happens when I make a new clone of Fiji ...
>>
>> git clone ...
>> git submoule init modules/imglib (without that Colocalization_Analysis
>> and Fiji does not compile btw)
>> git submodule update
>> Build
>> ImageJ
>> Plugins > LOCI > Import ... choose LSM
>>
>> > crash
>>
>> Steffi
>>
>> On Aug 8, 2012, at 15:59 , Stephan Preibisch wrote:
>>
>> > Hi guys,
>> >
>> > during the last hour LOCI stopped working on all my machines when I try
>> to open LSM files (Fiji checkout master, Build clean, Build):
>> >
>> > an example is here: http://fly.mpi-cbg.de/preibisch/nm/HisYFP-SPIM.zip
>> >
>> > preibischs-lm1:fiji preibischs$ ./ImageJ
>> > SLF4J: Class path contains multiple SLF4J bindings.
>> > SLF4J: Found binding in
>> [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12-1.5.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
>> > SLF4J: Found binding in
>> [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12.jar!/org/slf4j/impl/StaticLoggerBinder.class]
>> > SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an
>> explanation.
>> > [ERROR] "loci.formats.in.PovrayReader" is not valid.
>> > [ERROR] "loci.formats.in.IMODReader" is not valid.
>> > [ERROR] "loci.formats.in.OperettaReader" is not valid.
>> > [ERROR] "loci.formats.in.ZeissTIFFReader" is not valid.
>> > [ERROR] "loci.formats.in.HRDGDFReader" is not valid.
>> > [ERROR] "loci.formats.in.CanonRawReader" is not valid.
>> > [INFO ] Reading LSM metadata for series #0
>> > java.lang.reflect.InvocationTargetException
>> >       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>> >       at
>> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
>> >       at
>> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
>> >       at java.lang.reflect.Method.invoke(Method.java:597)
>> >       at ij.Command.runPlugIn(Command.java:146)
>> >       at ij.Command.runCommand(Command.java:95)
>> >       at ij.Executer.run(Executer.java:64)
>> >       at java.lang.Thread.run(Thread.java:680)
>> > Caused by: java.lang.NoSuchMethodError:
>> loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
>> >       at
>> loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
>> >       at
>> loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
>> >       at
>> loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
>> >       at loci.formats.FormatReader.setId(FormatReader.java:1105)
>> >       at
>> loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
>> >       at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
>> >       at loci.plugins.in.Importer.showDialogs(Importer.java:141)
>> >       at loci.plugins.in.Importer.run(Importer.java:79)
>> >       at loci.plugins.LociImporter.run(LociImporter.java:81)
>> >       at ij.IJ.runUserPlugIn(IJ.java:185)
>> >       at ij.IJ.runPlugIn(IJ.java:152)
>> >       ... 8 more
>> > [INFO ] Reading IFDs
>> > [INFO ] Populating metadata
>> > [INFO ] Checking comment style
>> > [INFO ] Populating OME metadata
>> >
>> >
>> > I tried replacing scifio, loci_plugins, anything that starts or
>> includes loci with different versions (from the download version of Fiji
>> and an older checkout where it still works) - but it will continue failing.
>> >
>> > I was just working on my SPIM code and suddenly it broke upon a ./Build
>> where I changed nothing but my files ...
>> >
>> > Does anybody have a suggestion?
>> >
>> > Thanks a lot,
>> > Steffi
>> >
>> > --
>> > Please avoid top-posting, and please make sure to reply-to-all!
>> >
>> > Mailing list web interface: http://groups.google.com/group/fiji-devel
>>
>> --
>> Please avoid top-posting, and please make sure to reply-to-all!
>>
>> Mailing list web interface: http://groups.google.com/group/fiji-devel
>>
>
>
>  --
> Please avoid top-posting, and please make sure to reply-to-all!
>
> Mailing list web interface: http://groups.google.com/group/fiji-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120808/0eaf64dc/attachment-0001.html>

From preibisch at mpi-cbg.de  Wed Aug  8 17:40:44 2012
From: preibisch at mpi-cbg.de (Stephan Preibisch)
Date: Wed, 8 Aug 2012 18:40:44 -0400
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
	<465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
	<CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
Message-ID: <8F90A5AD-5524-47D6-9D99-8959BE542CF6@mpi-cbg.de>

Unfortunately the problem persists ... I will try it on Linux and Windows to confirm it is not a Mac specific thing once more ...

On Aug 8, 2012, at 18:13 , Curtis Rueden wrote:

> Hi Steffi,
> 
> I had problems building Fiji from source from a fresh clone. Johannes & I debugged it, and found a problem with how Fiji's build system was resolving versions. That is now fixed and pushed to master. Afterwards, I tried opening one of your sample LSMs, and was able to do so successfully. So my hope is that this versioning issue is the same problem afflicting your setup as well.
> 
> Can you please give it a try with the latest Fiji master and let us know how it goes?
> 
> Regards,
> Curtis
> 
> 
> On Wed, Aug 8, 2012 at 3:33 PM, Stephan Preibisch <preibisch at mpi-cbg.de> wrote:
> No, I can only see
> 
> jars/
> MD5 (scifio.jar) = 9e101ed5cd590534f74d0001b98c1918
> MD5 (loci-common.jar) = 10d372b14b99965ec8c8f809d5973853
> 
> plugins/
> MD5 (loci_plugins.jar) = 9b4a563016f5c2e9e1347a2c969bba05
> 
> For some files I get a different error:
> Caused by: java.lang.NoSuchMethodError: loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
> 	at loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
> 	at loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
> 	at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
> 	at loci.formats.FormatReader.setId(FormatReader.java:1105)
> 	at loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
> 	at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
> 	at loci.plugins.in.Importer.showDialogs(Importer.java:141)
> 	at loci.plugins.in.Importer.run(Importer.java:79)
> 	at loci.plugins.LociImporter.run(LociImporter.java:81)
> 	at ij.IJ.runUserPlugIn(IJ.java:185)
> 	at ij.IJ.runPlugIn(IJ.java:152)
> 	... 8 more
> 
> Beanshell reports for: 
> print( loci.formats.meta.MetadataStore.class.getResource( "/loci/formats/meta/MetadataStore.class" ));
> jar:file:/Users/preibischs/workspace/fiji/jars/scifio.jar!/loci/formats/meta/MetadataStore.class
> 
> Thanks for looking into it, 
> Steffi
> 
> On Aug 8, 2012, at 16:22 , Curtis Rueden wrote:
> 
>> Hi Steffi,
>> 
>> > The same happens when I make a new clone of Fiji ...
>> 
>> I am doing a full build of Fiji to help diagnose.
>> 
>> The problem is certainly that there is a mismatch between JAR versions.
>> 
>> Is there a loci_tools.jar anywhere? If so, delete it. If not, the problem must be that an old bio-formats.jar is lying around somewhere?that stack trace indicates an old ZeissLSMReader.
>> 
>> I'll write back with any additional insight after some more testing.
>> 
>> -Curtis
>> 
>> 
>> On Wed, Aug 8, 2012 at 3:20 PM, Stephan Preibisch <preibisch at mpi-cbg.de> wrote:
>> The same happens when I make a new clone of Fiji ...
>> 
>> git clone ...
>> git submoule init modules/imglib (without that Colocalization_Analysis and Fiji does not compile btw)
>> git submodule update
>> Build
>> ImageJ
>> Plugins > LOCI > Import ... choose LSM
>> 
>> > crash
>> 
>> Steffi
>> 
>> On Aug 8, 2012, at 15:59 , Stephan Preibisch wrote:
>> 
>> > Hi guys,
>> >
>> > during the last hour LOCI stopped working on all my machines when I try to open LSM files (Fiji checkout master, Build clean, Build):
>> >
>> > an example is here: http://fly.mpi-cbg.de/preibisch/nm/HisYFP-SPIM.zip
>> >
>> > preibischs-lm1:fiji preibischs$ ./ImageJ
>> > SLF4J: Class path contains multiple SLF4J bindings.
>> > SLF4J: Found binding in [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12-1.5.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
>> > SLF4J: Found binding in [jar:file:/Users/preibischs/workspace/fiji/jars/slf4j-log4j12.jar!/org/slf4j/impl/StaticLoggerBinder.class]
>> > SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
>> > [ERROR] "loci.formats.in.PovrayReader" is not valid.
>> > [ERROR] "loci.formats.in.IMODReader" is not valid.
>> > [ERROR] "loci.formats.in.OperettaReader" is not valid.
>> > [ERROR] "loci.formats.in.ZeissTIFFReader" is not valid.
>> > [ERROR] "loci.formats.in.HRDGDFReader" is not valid.
>> > [ERROR] "loci.formats.in.CanonRawReader" is not valid.
>> > [INFO ] Reading LSM metadata for series #0
>> > java.lang.reflect.InvocationTargetException
>> >       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>> >       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
>> >       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
>> >       at java.lang.reflect.Method.invoke(Method.java:597)
>> >       at ij.Command.runPlugIn(Command.java:146)
>> >       at ij.Command.runCommand(Command.java:95)
>> >       at ij.Executer.run(Executer.java:64)
>> >       at java.lang.Thread.run(Thread.java:680)
>> > Caused by: java.lang.NoSuchMethodError: loci.formats.meta.MetadataStore.setImageObjectiveSettingsID(Ljava/lang/String;I)V
>> >       at loci.formats.in.ZeissLSMReader.populateMetadataStore(ZeissLSMReader.java:1249)
>> >       at loci.formats.in.ZeissLSMReader.initMetadata(ZeissLSMReader.java:1168)
>> >       at loci.formats.in.ZeissLSMReader.initFile(ZeissLSMReader.java:520)
>> >       at loci.formats.FormatReader.setId(FormatReader.java:1105)
>> >       at loci.plugins.in.ImportProcess.initializeFile(ImportProcess.java:482)
>> >       at loci.plugins.in.ImportProcess.execute(ImportProcess.java:146)
>> >       at loci.plugins.in.Importer.showDialogs(Importer.java:141)
>> >       at loci.plugins.in.Importer.run(Importer.java:79)
>> >       at loci.plugins.LociImporter.run(LociImporter.java:81)
>> >       at ij.IJ.runUserPlugIn(IJ.java:185)
>> >       at ij.IJ.runPlugIn(IJ.java:152)
>> >       ... 8 more
>> > [INFO ] Reading IFDs
>> > [INFO ] Populating metadata
>> > [INFO ] Checking comment style
>> > [INFO ] Populating OME metadata
>> >
>> >
>> > I tried replacing scifio, loci_plugins, anything that starts or includes loci with different versions (from the download version of Fiji and an older checkout where it still works) - but it will continue failing.
>> >
>> > I was just working on my SPIM code and suddenly it broke upon a ./Build where I changed nothing but my files ...
>> >
>> > Does anybody have a suggestion?
>> >
>> > Thanks a lot,
>> > Steffi
>> >
>> > --
>> > Please avoid top-posting, and please make sure to reply-to-all!
>> >
>> > Mailing list web interface: http://groups.google.com/group/fiji-devel
>> 
>> --
>> Please avoid top-posting, and please make sure to reply-to-all!
>> 
>> Mailing list web interface: http://groups.google.com/group/fiji-devel
>> 
> 
> 
> -- 
> Please avoid top-posting, and please make sure to reply-to-all!
>  
> Mailing list web interface: http://groups.google.com/group/fiji-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120808/209f59c0/attachment.html>

From Johannes.Schindelin at gmx.de  Wed Aug  8 19:04:54 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Thu, 9 Aug 2012 02:04:54 +0200 (CEST)
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
	<465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
	<CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.1208090203270.32459@s15462909.onlinehome-server.info>

Hi,

On Wed, 8 Aug 2012, Curtis Rueden wrote:

> I had problems building Fiji from source from a fresh clone. Johannes &
> I debugged it, and found a problem with how Fiji's build system was
> resolving versions. That is now fixed and pushed to master. Afterwards,
> I tried opening one of your sample LSMs, and was able to do so
> successfully. So my hope is that this versioning issue is the same
> problem afflicting your setup as well.
> 
> Can you please give it a try with the latest Fiji master and let us know
> how it goes?

FWIW I just committed, pushed and uploaded a new tool:
Plugins>Utilities>Find Jar For Class. You just paste or type the name of a
class and it will output into the Log window where the class was found,
and it will warn you when that class can be found in multiple .jar files
in the class path.

Ciao,
Dscho


From Johannes.Schindelin at gmx.de  Wed Aug  8 19:32:09 2012
From: Johannes.Schindelin at gmx.de (Johannes Schindelin)
Date: Thu, 9 Aug 2012 02:32:09 +0200 (CEST)
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <8F90A5AD-5524-47D6-9D99-8959BE542CF6@mpi-cbg.de>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
	<465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
	<CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
	<8F90A5AD-5524-47D6-9D99-8959BE542CF6@mpi-cbg.de>
Message-ID: <alpine.DEB.1.00.1208090214070.32459@s15462909.onlinehome-server.info>

Hi Steffi,

On Wed, 8 Aug 2012, Stephan Preibisch wrote:

> Unfortunately the problem persists ... I will try it on Linux and
> Windows to confirm it is not a Mac specific thing once more ...

I'd like to analyze the problem myself. Could you make a package using
Plugins>Utilities>Make Fiji Package (unfortunately, there are two
Utilities menus, the package maker is in the bottom one) and upload it
using Help>Upload Sample Image?

Thanks,
Dscho


From preibisch at mpi-cbg.de  Thu Aug  9 09:25:35 2012
From: preibisch at mpi-cbg.de (Stephan Preibisch)
Date: Thu, 9 Aug 2012 10:25:35 -0400
Subject: [ImageJ-devel] [fiji-devel] LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <alpine.DEB.1.00.1208090214070.32459@s15462909.onlinehome-server.info>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
	<465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
	<CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
	<8F90A5AD-5524-47D6-9D99-8959BE542CF6@mpi-cbg.de>
	<alpine.DEB.1.00.1208090214070.32459@s15462909.onlinehome-server.info>
Message-ID: <D967F4D6-E6AC-4A6E-9AD5-B922D41490AE@mpi-cbg.de>

Hi,

done and done. But I cannot find the command "Find Jar For Class" to test that ...

And the same error does not happen under Linux, so I guess it is somehow MAC specific.

Bye bye,
Steffi

On Aug 8, 2012, at 20:32 , Johannes Schindelin wrote:

> Hi Steffi,
> 
> On Wed, 8 Aug 2012, Stephan Preibisch wrote:
> 
>> Unfortunately the problem persists ... I will try it on Linux and
>> Windows to confirm it is not a Mac specific thing once more ...
> 
> I'd like to analyze the problem myself. Could you make a package using
> Plugins>Utilities>Make Fiji Package (unfortunately, there are two
> Utilities menus, the package maker is in the bottom one) and upload it
> using Help>Upload Sample Image?
> 
> Thanks,
> Dscho



From ctrueden at wisc.edu  Thu Aug  9 11:51:02 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Thu, 9 Aug 2012 11:51:02 -0500
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <201208070016.15282.G.Landini@bham.ac.uk>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
	<201208070016.15282.G.Landini@bham.ac.uk>
Message-ID: <CADN69ykCEYird0EnwR3=GVHCP9-Pv1fNWhfx3Tq-puyoA=TmOg@mail.gmail.com>

Hi Gabriel,

> > This combined "uber-JAR" is for developers only, as an option
>
> I see, I also think that this needs explanation in that page.

I started fleshing out the "Combined build" section of the Downloads page,
but then decided to simply remove it. Honestly, it is better for developers
*not* to use that JAR. It was only provided as a convenience for those who
strongly prefer it. Using a single combined JAR has many disadvantages
though, so I'd rather not advertise its existence on the Downloads page. We
will continue to have Jenkins build it though.

If we get to the point where there is enough demand for it that it should
really be explained on the web site, I will create a separate page for it
explaining the pros & cons of using it, along with alternatives. But we'll
cross that bridge later.

> The downloads page should perhaps be more explicit about the possibility
of
> openjdk not working with the IJ2 beta (and Oracle's Java 1.7 has some
problems
> too...).

I added the following text to the Downloads page's "System requirements"
section:

"Please note that we currently test ImageJ2 mostly with Oracle Java 6.
There may be additional bugs when using it with OpenJDK, as well as Oracle
Java 7. Feel free to report any such issues to the mailing list."

Regards,
Curtis


On Mon, Aug 6, 2012 at 6:16 PM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:

> > > I restart it and get the same message again. So basically the updater
> is
> > > never started.
> >
> > This was a bug in the Updater (affecting both Fiji and ImageJ2) that has
> > hopefully been sorted now, thanks to Johannes's efforts. Please let us
> > know if not.
>
> Hi,
> OK, I will test this next week.
>
> > Until we get the multiple channel updates working though, we are erring
> on
> > the side of caution with the update site, meaning you must explicitly
> > download the latest snapshot build ZIP file if you want to try it before
> > each beta release.
>
> Right but my point was that the "latest" was not so latest as the files
> were
> older than the beta avaiable... and so it becomes a confusing issue.
>
> > > What is one supposed to do with the Combined build file (*-all.jar)?
> >
> > This combined "uber-JAR" is for developers only, as an option, to use
> with
> > external integration. For example, CellProfiler uses it, rather than
> > bundling each of the individual ImageJ2 JAR files. It is not intended for
> > use with the ImageJ application bundle.
>
> I see, I also think that this needs explanation in that page.
>
> > You said you got this sorted, so hopefully it was something easy. If you
> > had to do anything unintuitive, please let us know; it is supposed to
> > "just work" like ImageJ1 does.
>
> I emailed Barry an example plugin where things do not work as expected (not
> sure if he received that).
> The downloads page should perhaps be more explicit about the possibility of
> openjdk not working with the IJ2 beta (and Oracle's Java 1.7 has some
> problems
> too...).
> For example opensuse ships with openjdk by default (and at least some old
> versions of Kubuntu did as well).
>
> Cheeers
>
> Gabriel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120809/f98ea9d7/attachment-0001.html>

From stephan.preibisch at gmx.de  Thu Aug  9 13:02:17 2012
From: stephan.preibisch at gmx.de (Stephan Preibisch)
Date: Thu, 9 Aug 2012 14:02:17 -0400
Subject: [ImageJ-devel] FIXED - LOCI fails on current Fiji checkout
	(help!!)
In-Reply-To: <alpine.DEB.1.00.1208091903100.32459@s15462909.onlinehome-server.info>
References: <A2524FE1-D757-4D96-A88F-E2F32FD13703@mpi-cbg.de>
	<DE2CD8CF-D4D1-40C2-ABA1-78C493E491BE@mpi-cbg.de>
	<CADN69ynfiPSyd80HgAEVuhRd=y=Co2fypajnBLzw+-OMuCo2vg@mail.gmail.com>
	<465CEEAC-E03D-437C-A7B6-C074DE528B35@mpi-cbg.de>
	<CADN69ynRHZ3xLM3eyo0739zcD0nv-ZbD4PDkU-B5_EQe5nLXfg@mail.gmail.com>
	<8F90A5AD-5524-47D6-9D99-8959BE542CF6@mpi-cbg.de>
	<alpine.DEB.1.00.1208090214070.32459@s15462909.onlinehome-server.info>
	<D967F4D6-E6AC-4A6E-9AD5-B922D41490AE@mpi-cbg.de>
	<0F638AE6-F779-41FF-BC64-6E99DD6D685B@nih.gov>
	<alpine.DEB.1.00.1208091903100.32459@s15462909.onlinehome-server.info>
Message-ID: <BE4E61B2-6B5E-4D68-8579-B5E8E2EBDEA7@gmx.de>

Hi,

with Johannes help we just figured out that manually updating 

jars/bio-formats-4.4-SNAPSHOT.jar

through the updater fixed the problem on both my MACs.

Thanks a lot Johannes, Curtis and Wayne for the help,
Steffi

On Aug 9, 2012, at 13:04 , Johannes Schindelin wrote:

> Hi,
> 
> On Thu, 9 Aug 2012, Rasband, Wayne (NIH/NIMH) [E] wrote:
> 
>> On Aug 9, 2012, at 10:25 AM, Stephan Preibisch wrote:
>> 
>>> done and done. But I cannot find the command "Find Jar For Class" to
>>> test that ...
>>> 
>>> And the same error does not happen under Linux, so I guess it is
>>> somehow MAC specific.
>> 
>> On my Mac, I get 
>> 
>>  The class loci.plugins.About is contained in /Applications/Fiji.app/plugins/loci_tools.jar
>>  WARNING! loci.plugins.About is also contained in /Applications/Fiji.app/plugins/loci_plugins-4.4-SNAPSHOT.jar!
>> 
>> when I run Plugins>Utilities>Find Jar For Class.
> 
> As confirmed by Wayne in a private mail, this issue went away after
> running Help>Update Fiji (which marks loci_tools.jar for uninstall, as it
> has been overridden by loci_plugins.jar).
> 
> Ciao,
> Johannes
> 
> -- 
> Please avoid top-posting, and please make sure to reply-to-all!
> 
> Mailing list web interface: http://groups.google.com/group/fiji-devel



From ctrueden at wisc.edu  Fri Aug 10 10:19:20 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Fri, 10 Aug 2012 10:19:20 -0500
Subject: [ImageJ-devel] Simple usage of ImageJ2 and ImgLib2
In-Reply-To: <CAEvY7i9EiwFYmMTUBSWFnbvcyDiP9mYAwkRrxjw0Fa2j1t4Rgw@mail.gmail.com>
References: <CAEvY7i9EiwFYmMTUBSWFnbvcyDiP9mYAwkRrxjw0Fa2j1t4Rgw@mail.gmail.com>
Message-ID: <CADN69y=mS9c4QMMDgMohXdWVrRCN_5-nmMk=NSq0fm7N-OT=xw@mail.gmail.com>

Hi Padraig,


> With a view to moving to imgLib2 and ImageJ2 I have been going through the
> Javadoc to try to display an image perform more complicated tasks.


We have added a simple tutorial on how to load and display a dataset in
ImageJ2:


https://github.com/imagej/imagej-tutorials/tree/master/load-and-display-dataset

You use the IOService to read in a Dataset, which is the data portion of an
ImagePlus (no display or UI attached). You can then choose to display that
dataset if you want using the DisplayService.


> Ideally I would like to use Swing and get a Canvas containing the image
> and to be able to put this on a JFrame.


We have focused a lot on headless operation so far, so you can create a
headless ImageJ context, load a dataset, and create a display for that
dataset, all headless. And if you plug in the Swing (or other) UI, the
display will be automatically visualized using that interface.

However, thus far, we have not focused on an API for manually working with
UI-specific objects such as JPanels. We really need another layer of
services for that?in this case, probably a SwingService that can deliver
things like SwingDisplayPanels and SwingDisplayWindows on demand.

At the moment you could do something like the following, but there are
still bugs:

final IOService ioService = context.getService(IOService.class);
 final Dataset data = ioService.loadDataset("data.tif");

final ImageDisplay display = new DefaultImageDisplay();
 display.setContext(context);
display.display(data);

final ThreadService threadService = context.getService(ThreadService.class);
 threadService.queue(new Runnable() {

@Override
public void run() {
 final SwingImageDisplayViewer displayViewer =
new SwingSdiImageDisplayViewer();
 final SwingDisplayWindow displayWindow = new SwingDisplayWindow();
displayViewer.view(displayWindow, display);
 final SwingDisplayPanel displayPanel = displayViewer.getPanel();

final JFrame myFrame = new JFrame("My Frame");
 myFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
myFrame.getContentPane().setLayout(new BorderLayout());
 myFrame.getContentPane().add(displayPanel);
myFrame.pack();
myFrame.setVisible(true);
 }
});

And it is certainly not the final API for this layer of functionality.



I have gone through the ImageJ2 javadoc and I have found a range of classes
> that seem relevant such as Defaultdataset, SwingSdiImageDisplayViewer,
> SwingDisplayPanel but


We are working on fleshing out the javadoc more, but ultimately tutorials
are going to be a better route to learning the system if you don't already
have some grounding in the basic ImageJ2 design. There will be some new
tutorials in the next few weeks, with many more by the beta5 release in
October.



I keep running into errors with Services that don't exist because I am
> probably not using ImageJ2 as intended.


Those errors are likely due to your classpath configuration. Are you using
Maven for managing your project dependencies? If not, for simplicity, you
could try using the imagej-2.0.0-SNAPSHOT-all.jar bundle of everything in
one JAR; see this FAQ entry for pros and cons:

    http://developer.imagej.net/faq#n213

Regards,
Curtis


On Mon, Jul 16, 2012 at 3:13 AM, Padraig Looney <padraig.looney at gmail.com>wrote:

> Dear list,
>
> Apologies if this posting is not in the correct place but I seem to have
> hit a brick wall in moving to ImgLib2 and ImageJ2.
>
> I have used ImageJ 1 without the the user interface for a variety of
> software projects. In Image J to open an Image I would use
>
> Opener opener = new opener();
> Imageplus imp = opener.openImage("someFile");
> imp.show();
>
> and from there I could perform the processing and change the display etc.
>
> With a view to moving to imgLib2 and ImageJ2 I have been going through the
> Javadoc to try to display an image perform more complicated tasks. So I
> have found this example among others on the Imglib2 site but in the imgLibs
> package there is no ImageJFunctions anymore.
>
> public < T extends RealType< T > & NativeType< T > > Example1b()
>         throws ImgIOException, IncompatibleTypeException
>     {
>         // define the file to open
>         File file = new File( "DrosophilaWing.tif" );
>
>         // open with ImgOpener using an ArrayImgFactory, here the return
> type will be
>         // defined by the opener
>         // the opener will ignore the Type of the ArrayImgFactory
>         ImgFactory< ? > imgFactory = new ArrayImgFactory< T >();
>         Img< T > image = new ImgOpener().openImg( file.getAbsolutePath(),
> imgFactory );
>
>         // display it via ImgLib using ImageJ
>         ImageJFunctions.show( image );
>
>         // open with ImgOpener as Float using a CellImgFactory, it will
> be opened as float
>         // independent of the type of the image
>         // to enforce to open it as FloatType, an instance of FloatType
> has to be passed along
>         Img< FloatType > imageFloat = new ImgOpener().openImg(
> file.getAbsolutePath(),
>             new CellImgFactory< FloatType >( 10 ), new FloatType() );
>
>         // display it via ImgLib using ImageJ
>         ImageJFunctions.show( imageFloat );
>     }
>
> Ideally I would like to use Swing and get a Canvas containing the image
> and to be able to put this on a JFrame. I have gone through the ImageJ2
> javadoc and I have found a range of classes that seem relevant such as
> Defaultdataset, SwingSdiImageDisplayViewer, SwingDisplayPanel but I keep
> running into errors with Services that don't exist because I am probably
> not using ImageJ2 as intended.
>
> Many thanks
>
> Padraig Looney
> Medical Physicist
> Royal Surrey County Hospital
>
>
>
>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/fdda7bb2/attachment.html>

From ctrueden at wisc.edu  Fri Aug 10 10:32:44 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Fri, 10 Aug 2012 10:32:44 -0500
Subject: [ImageJ-devel] running macros on ImageJ2
In-Reply-To: <1343677499.73956.YahooMailNeo@web160803.mail.bf1.yahoo.com>
References: <1343677499.73956.YahooMailNeo@web160803.mail.bf1.yahoo.com>
Message-ID: <CADN69ymW-s3Q9j225G310BYjQSJnoob5kSzUe_Joyk+p6=14mg@mail.gmail.com>

Hi Raghuram,


> I am stuck trying to replicate this behavior on IJ2.


Full support for macros and scripting with ImageJ2 is scheduled for the
next beta (or beta5 if we run out of time). See this ticket for details:
    http://trac.imagej.net/ticket/12


> I looked at the code for the ScriptPlugin.java and various other files in
> the plugins.script package but have no clue on how to get similar
> functionality as IJ.runMacroFile(..).


In the future, there will be a ScriptService providing such functionality.

In the meantime, you should be able to execute your macro as-is in ImageJ2
via the legacy layer.

Regards,
Curtis


On Mon, Jul 30, 2012 at 2:44 PM, raghuram sathyam <raghuramsathyam at yahoo.com
> wrote:

> Hello IJ developers,
> I have been using a macro for processing multiple choice surveys for a
> while. I wrote this macro from scratch (it was not recorded on the UI) for
> IJ1 and it works very well on IJ1. I have been trying to migrate to IJ2 so
> that i can move my processing to the cloud.
>
> I have also written some java code to preprocess the images i receive and
> use IJ as a library within my code. I use IJ.runMacroFile(...) to run the
> macro that i wrote for further image processing using IJ. I use the results
> returned by the IJ.runMacroFile(...) for my output.
>
> I am stuck trying to replicate this behavior on IJ2.  I looked at the code
> for the ScriptPlugin.java and various other files in the plugins.script
> package but have no clue on how to get similar functionality as
> IJ.runMacroFile(..).
>
> Any pointers on how i can get this done will be very helpful.
>
> -raghuram
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/eed1f76f/attachment-0001.html>

From ctrueden at wisc.edu  Fri Aug 10 14:39:39 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Fri, 10 Aug 2012 14:39:39 -0500
Subject: [ImageJ-devel] Fwd: IJ2 work/LUTs
In-Reply-To: <5021653F.40504@wisc.edu>
References: <50216230.3000105@wisc.edu> <5021653F.40504@wisc.edu>
Message-ID: <CADN69ymZ8uLQ1WBCGpwzqsogve0btCtspEvZmOQWxKrN_hMhsA@mail.gmail.com>

Hi all,

Aivar and I chatted, and we have a plan for improving the LUT API.

We are going to migrate ImageJ2's color classes into ImgLib2, into
net.imglib2.display along side ColorTable / ColorTable8 / ColorTable16, so
that those color tables classes can make use of them. Specifically, the
following classes from ImageJ2 will migrate:
  * imagej.util.ColorRGB
  * imagej.util.ColorRGBA
  * imagej.util.Colors
  * imagej.data.display.ColorTables

These four classes are useful general-purpose color classes that fit in
well with ImgLib2's ColorTable API, and will allow us to provide better LUT
functionality in general. Aivar can elaborate further on technical details
if anyone else is interested.

Regards,
Curtis


On Tue, Aug 7, 2012 at 1:58 PM, Aivar Grislis <grislis at wisc.edu> wrote:

>  I meant to send this to the imagej-devel list...
>
>
> -------- Original Message --------  Subject: IJ2 work/LUTs  Date: Tue, 07
> Aug 2012 13:45:04 -0500  From: Aivar Grislis <grislis at wisc.edu><grislis at wisc.edu>  To:
> imagej-devel at imagejdev.org, Curtis Rueden <ctrueden at wisc.edu><ctrueden at wisc.edu>
>
> I've been looking at IJ2 trying to figure out how SLIM Plugin fits in.
> I was looking at the LUT code & am interested in refactoring it.
>
> I found some non-linearity bugs in the way LUTs are applied in the
> AutoContrast and DefaultImageDisplay plugins that I could fix.
>
> The LUT API could be improved.  There are two kinds of LUTs, ColorTable8
> and ColorTable16, the former is what's being used as a LUT, the latter
> is in the codebase but not really used or displayed AFAIK.
>
> This could be a Service or other Plugin.  I would consolidate the
> RealLUTConverter class into LUTs, LUTs would contain a ColorTable, the
> API might be something like this:
>
> // constructor
> LUT(ColorTable colorTable);
>
> // given a min/max range for the LUT, what is the color for current value?
> ARGBType lookup(double min, double max, double value);
>
> // get a swath of colors to use to display the LUT
> ARGBType[] getColors(int bins);
>
> Refactoring this isn't essential to SLIM Plugin, but it might be a good
> way to get up to speed with IJ2 work.
>
> Aivar
>
>
>
>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/3f0f28e4/attachment.html>

From ctrueden at wisc.edu  Fri Aug 10 14:44:39 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Fri, 10 Aug 2012 14:44:39 -0500
Subject: [ImageJ-devel] IJ2 work/Histogram
In-Reply-To: <50218C5C.9090005@wisc.edu>
References: <50218C5C.9090005@wisc.edu>
Message-ID: <CADN69ymmcB1DOPRrxywm9UknHbfx9JNe63Xv3bh8xV9jtTbKyQ@mail.gmail.com>

Hi all,

Aivar & I also discussed histograms, and our plan for those is a bit more
nebulous. Aivar is going to investigate improving Larry's histogram API in
net.imglib2.algorithms.stats.

The general idea is that computing min/max, computing histograms, and
computing other statistics are intrinsically related, and for performance
reasons it is nice to minimize the number of passes through the image when
computing these. So we would like to create a unified ImageStatistics class
(sound familiar? ;-) that can compute one or more of these in an
intelligent way, then return the results on demand.

None of this is reconciled with the net.imglib2.script.analysis package
(Histogram, ImgMax, ImgMean, etc.), but perhaps in the future the
net.imglib2.script stuff can take more direct advantage of it.

Regards,
Curtis


On Tue, Aug 7, 2012 at 4:45 PM, Aivar Grislis <grislis at wisc.edu> wrote:

> I'd also be interested in working on the histogram code.  Mostly the code
> that generates histogram data, also their display, perhaps the histogram
> tool itself.
>
> SLIM Plugin uses histograms in a very dynamic way, as they are updated
> periodically during the fit process.  You can change the minimum and
> maximum values interactively.  So I might be an interested consumer of any
> common histogram code.
>
> (I looked at the histogram code in the AutoContrast plugin,
> net.imglib2.algorithm.stats.**Histogram, and net.imglib2.script.analysis.*
> *Histogram and found bugs in all of them when binning up the histogram
> values.)
>
> Aivar
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/384723c0/attachment.html>

From grislis at wisc.edu  Fri Aug 10 17:11:23 2012
From: grislis at wisc.edu (Aivar Grislis)
Date: Fri, 10 Aug 2012 17:11:23 -0500
Subject: [ImageJ-devel] IJ2 work/Histogram
In-Reply-To: <CADN69ymmcB1DOPRrxywm9UknHbfx9JNe63Xv3bh8xV9jtTbKyQ@mail.gmail.com>
References: <50218C5C.9090005@wisc.edu>
	<CADN69ymmcB1DOPRrxywm9UknHbfx9JNe63Xv3bh8xV9jtTbKyQ@mail.gmail.com>
Message-ID: <5025870B.7070900@wisc.edu>

Here is a discussion of changes I propose for dealing with histograms in 
IJ2.  Sorry it's so length, let me know if something is unclear and 
please comment if you have an interest in histograms; I do have some 
specific questions for the group (*/in bold italics/*):


1)  First of all I would create some helper methods like the following 
(could just be static methods somewhere)...

// maps a value to a bin index, given the range min...max and the number 
of bins
int valueToBin(int bins, double min, double max, double value);

// returns array of edge values
double[] getEdgeValues(int bins, double min, double max);

// returns array of center values
double[] getCenterValues(int bins, double min, double max);

...and equivalent set for integer values.

Note that these methods would be used for both computing histograms and 
assigning colors from a LUT.  It's nice to use exactly the same code for 
both.  You can characterize a histogram bin or LUT color by the starting 
or edge value or by the center value, I've seen it both ways so I 
included both flavors.

Having these common methods would also avoid bugs:

i) One bug I saw in several places is to compute (value - min) / (max - 
min) and get a value from 0.0 to 1.0, but multiply that by 255.  The 
problem with that is the only way you get bin 255 is if value == min.  
Ideally each bin should represent a range of values; if the data set is 
uniformly distributed the size of the range of values per bin would be 
about the same.

ii) Another bug was to compute width = max - min + 1.  That's certainly 
the way you do it for integer arithmetic but it doesn't work in floating 
point!

I'd rather fix these bugs by refactoring to call the common helper methods.


2)  Regarding the "ImageStatistics" class idea that Curtis mentioned:

For example it might include methods:

// request certain things ahead of time
doMinMax();
doHistogram(int bins);
doHistogram(int bins, double min, double max);
doMean();

// do minimal number of passes through the image
process();

// get accumulated results
double[] getMinMax();
long[] getHistogram();
double getMean;

Here if you don't specify a min/max for doHistogram the code has to take 
an initial pass to get min/max then another to build the histogram using 
that min/max.


3) Discussion of  net.imglib2.script.analysis.Histogram:

Both of these ImgLib2 histogram methods combine a single pass through 
the image with generating histogram statistics.

This code exhibits bug (i).

I'm not sure that this handles integral values as well as floating point.

The mapping of values to histogram bins counts values that are less than 
the min in the first bin and values that are greater than the max in the 
last bin. */Is this really desirable behavior?/ * In my usage of 
histograms I specifically don't want to count under- and over-range 
values.  Similarly when using a LUT I like under- and over-range values 
to appear black. Of course if we need it work both ways we can provide a 
switch.

The output of this code is actually a JFreeChart image, there's no way 
to get the raw histogram count array.

FYI, uses TreeMap<Double, Long> as an internal representation of the 
histogram count array.  Note that this combines what I am calling the 
edge values with the histogram counts.


4) Discussion of net.imglib2.algorithm.stats.Histogram:

This has a HistogramBinMapper base class with RealBinMapper and 
IntBinMapper so it's meant to handle real and integral values. The 
mapper is passed in as a parameter; I think it could be inferred from 
the cursor type T.

Here the RealBinMapper class exhibits bug (ii) when calculating binWidth 
in the constructor.

IntBinMapper doesn't let you specify a bin count, but assumes numBins = 
max - min + 1.  In other words, each bin will track a given integer 
value.  I haven't actually worked with any histograms of integral valued 
images but I thought they should work the same way as floating point, 
that is you could count a range of values in a single histogram bin. 
/*Is there any reason bins and values should always be 1:1 for integral 
valued images?*/  This is so in IJ1 for 8-bit and RGB images.

You pass in the minimum and maximum values when you create a 
HistogramBinMapper, but these are described as bin center values. My 
concept of the minimum and maximum values has been the minimum is the 
lowest value that maps to the first histogram bin and the maximum is the 
highest value that maps to the last histogram bin. If we specify min/max 
as centers some values slightly below minimum and slightly above maximum 
will map to the first and last histogram bins respectively. /*Do we need 
to specify min/max as bin center values?*/


Thanks!
Aivar


On 8/10/12 2:44 PM, Curtis Rueden wrote:
> Hi all,
>
> Aivar & I also discussed histograms, and our plan for those is a bit 
> more nebulous. Aivar is going to investigate improving Larry's 
> histogram API in net.imglib2.algorithms.stats.
>
> The general idea is that computing min/max, computing histograms, and 
> computing other statistics are intrinsically related, and for 
> performance reasons it is nice to minimize the number of passes 
> through the image when computing these. So we would like to create a 
> unified ImageStatistics class (sound familiar? ;-) that can compute 
> one or more of these in an intelligent way, then return the results on 
> demand.
>
> None of this is reconciled with the net.imglib2.script.analysis 
> package (Histogram, ImgMax, ImgMean, etc.), but perhaps in the future 
> the net.imglib2.script stuff can take more direct advantage of it.
>
> Regards,
> Curtis
>
>
> On Tue, Aug 7, 2012 at 4:45 PM, Aivar Grislis <grislis at wisc.edu 
> <mailto:grislis at wisc.edu>> wrote:
>
>     I'd also be interested in working on the histogram code.  Mostly
>     the code that generates histogram data, also their display,
>     perhaps the histogram tool itself.
>
>     SLIM Plugin uses histograms in a very dynamic way, as they are
>     updated periodically during the fit process.  You can change the
>     minimum and maximum values interactively.  So I might be an
>     interested consumer of any common histogram code.
>
>     (I looked at the histogram code in the AutoContrast plugin,
>     net.imglib2.algorithm.stats.Histogram, and
>     net.imglib2.script.analysis.Histogram and found bugs in all of
>     them when binning up the histogram values.)
>
>     Aivar
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/4405a0a5/attachment-0001.html>

From grislis at wisc.edu  Fri Aug 10 17:40:37 2012
From: grislis at wisc.edu (Aivar Grislis)
Date: Fri, 10 Aug 2012 17:40:37 -0500
Subject: [ImageJ-devel] Fwd: IJ2 work/LUTs
In-Reply-To: <CADN69ymZ8uLQ1WBCGpwzqsogve0btCtspEvZmOQWxKrN_hMhsA@mail.gmail.com>
References: <50216230.3000105@wisc.edu> <5021653F.40504@wisc.edu>
	<CADN69ymZ8uLQ1WBCGpwzqsogve0btCtspEvZmOQWxKrN_hMhsA@mail.gmail.com>
Message-ID: <50258DE5.7030706@wisc.edu>

The basic ideas for LUTs:

1)  Use common formulas to look up color bin in LUTs and to look up 
histogram bin.  (See my Histogram e-mail).

2)  Migrate IJ2 color classes into ImgLib2 as Curtis mentioned. /*Or 
should we just use net.imglib2.type.numeric.ARGBType?*/

3)  Support ColorTable16 and hide details of ColorTable8 & 16 by having 
ColorTable be a base class or interface that has the following methods:

// get number of colors (typically 256; 64K for ColorTable16)
int getSize();

// gets colors for displaying the LUT (typically bins is 256)
ColorRGBA[] getColors(int bins);

// given the mininum value that maps to the first color and maximum that 
maps to the last color, what does current value map to?
ColorRGBA lookUpColor(double value, double minimum, double maximum);

Thanks!
Aivar

On 8/10/12 2:39 PM, Curtis Rueden wrote:
> Hi all,
>
> Aivar and I chatted, and we have a plan for improving the LUT API.
>
> We are going to migrate ImageJ2's color classes into ImgLib2, into 
> net.imglib2.display along side ColorTable / ColorTable8 / 
> ColorTable16, so that those color tables classes can make use of them. 
> Specifically, the following classes from ImageJ2 will migrate:
>   * imagej.util.ColorRGB
>   * imagej.util.ColorRGBA
>   * imagej.util.Colors
>   * imagej.data.display.ColorTables
>
> These four classes are useful general-purpose color classes that fit 
> in well with ImgLib2's ColorTable API, and will allow us to provide 
> better LUT functionality in general. Aivar can elaborate further on 
> technical details if anyone else is interested.
>
> Regards,
> Curtis
>
>
> On Tue, Aug 7, 2012 at 1:58 PM, Aivar Grislis <grislis at wisc.edu 
> <mailto:grislis at wisc.edu>> wrote:
>
>     I meant to send this to the imagej-devel list...
>
>
>     -------- Original Message --------
>     Subject: 	IJ2 work/LUTs
>     Date: 	Tue, 07 Aug 2012 13:45:04 -0500
>     From: 	Aivar Grislis <grislis at wisc.edu> <mailto:grislis at wisc.edu>
>     To: 	imagej-devel at imagejdev.org
>     <mailto:imagej-devel at imagejdev.org>, Curtis Rueden
>     <ctrueden at wisc.edu> <mailto:ctrueden at wisc.edu>
>
>
>
>     I've been looking at IJ2 trying to figure out how SLIM Plugin fits in.
>     I was looking at the LUT code & am interested in refactoring it.
>
>     I found some non-linearity bugs in the way LUTs are applied in the
>     AutoContrast and DefaultImageDisplay plugins that I could fix.
>
>     The LUT API could be improved.  There are two kinds of LUTs, ColorTable8
>     and ColorTable16, the former is what's being used as a LUT, the latter
>     is in the codebase but not really used or displayed AFAIK.
>
>     This could be a Service or other Plugin.  I would consolidate the
>     RealLUTConverter class into LUTs, LUTs would contain a ColorTable, the
>     API might be something like this:
>
>     // constructor
>     LUT(ColorTable colorTable);
>
>     // given a min/max range for the LUT, what is the color for current value?
>     ARGBType lookup(double min, double max, double value);
>
>     // get a swath of colors to use to display the LUT
>     ARGBType[] getColors(int bins);
>
>     Refactoring this isn't essential to SLIM Plugin, but it might be a good
>     way to get up to speed with IJ2 work.
>
>     Aivar
>
>
>
>
>
>     _______________________________________________
>     ImageJ-devel mailing list
>     ImageJ-devel at imagej.net <mailto:ImageJ-devel at imagej.net>
>     http://imagej.net/mailman/listinfo/imagej-devel
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/3cf2b3c4/attachment.html>

From grislis at wisc.edu  Fri Aug 10 18:13:21 2012
From: grislis at wisc.edu (Aivar Grislis)
Date: Fri, 10 Aug 2012 18:13:21 -0500
Subject: [ImageJ-devel] IJ2 work/Histogram
In-Reply-To: <5025870B.7070900@wisc.edu>
References: <50218C5C.9090005@wisc.edu>
	<CADN69ymmcB1DOPRrxywm9UknHbfx9JNe63Xv3bh8xV9jtTbKyQ@mail.gmail.com>
	<5025870B.7070900@wisc.edu>
Message-ID: <50259591.50209@wisc.edu>

 >The mapping of values to histogram bins counts values that are less 
than the min in the first bin and values that are greater than the max 
in the last bin. */Is this really desirable behavior?/ * In my usage of 
histograms I specifically don't want to count under- and over-range 
values.  Similarly when using a LUT I like under- and over-range values 
to appear black.  Of course if we need it work both ways we can provide 
a switch.

I totally forgot, actually thats how IJ1 works: it does assign 
under-range values to the first color and over-range values to the last 
color.

For my purposes, I had to kludge up the first and last colors of the LUT 
to be black and fiddle with the min/max values to make it all work.

On 8/10/12 5:11 PM, Aivar Grislis wrote:
> Here is a discussion of changes I propose for dealing with histograms 
> in IJ2.  Sorry it's so length, let me know if something is unclear and 
> please comment if you have an interest in histograms; I do have some 
> specific questions for the group (*/in bold italics/*):
>
>
> 1)  First of all I would create some helper methods like the following 
> (could just be static methods somewhere)...
>
> // maps a value to a bin index, given the range min...max and the 
> number of bins
> int valueToBin(int bins, double min, double max, double value);
>
> // returns array of edge values
> double[] getEdgeValues(int bins, double min, double max);
>
> // returns array of center values
> double[] getCenterValues(int bins, double min, double max);
>
> ...and equivalent set for integer values.
>
> Note that these methods would be used for both computing histograms 
> and assigning colors from a LUT.  It's nice to use exactly the same 
> code for both.  You can characterize a histogram bin or LUT color by 
> the starting or edge value or by the center value, I've seen it both 
> ways so I included both flavors.
>
> Having these common methods would also avoid bugs:
>
> i) One bug I saw in several places is to compute (value - min) / (max 
> - min) and get a value from 0.0 to 1.0, but multiply that by 255.  The 
> problem with that is the only way you get bin 255 is if value == min.  
> Ideally each bin should represent a range of values; if the data set 
> is uniformly distributed the size of the range of values per bin would 
> be about the same.
>
> ii) Another bug was to compute width = max - min + 1.  That's 
> certainly the way you do it for integer arithmetic but it doesn't work 
> in floating point!
>
> I'd rather fix these bugs by refactoring to call the common helper 
> methods.
>
>
> 2)  Regarding the "ImageStatistics" class idea that Curtis mentioned:
>
> For example it might include methods:
>
> // request certain things ahead of time
> doMinMax();
> doHistogram(int bins);
> doHistogram(int bins, double min, double max);
> doMean();
>
> // do minimal number of passes through the image
> process();
>
> // get accumulated results
> double[] getMinMax();
> long[] getHistogram();
> double getMean;
>
> Here if you don't specify a min/max for doHistogram the code has to 
> take an initial pass to get min/max then another to build the 
> histogram using that min/max.
>
>
> 3) Discussion of  net.imglib2.script.analysis.Histogram:
>
> Both of these ImgLib2 histogram methods combine a single pass through 
> the image with generating histogram statistics.
>
> This code exhibits bug (i).
>
> I'm not sure that this handles integral values as well as floating point.
>
> The mapping of values to histogram bins counts values that are less 
> than the min in the first bin and values that are greater than the max 
> in the last bin. */Is this really desirable behavior?/ * In my usage 
> of histograms I specifically don't want to count under- and over-range 
> values.  Similarly when using a LUT I like under- and over-range 
> values to appear black.  Of course if we need it work both ways we can 
> provide a switch.
>
> The output of this code is actually a JFreeChart image, there's no way 
> to get the raw histogram count array.
>
> FYI, uses TreeMap<Double, Long> as an internal representation of the 
> histogram count array.  Note that this combines what I am calling the 
> edge values with the histogram counts.
>
>
> 4) Discussion of net.imglib2.algorithm.stats.Histogram:
>
> This has a HistogramBinMapper base class with RealBinMapper and 
> IntBinMapper so it's meant to handle real and integral values. The 
> mapper is passed in as a parameter; I think it could be inferred from 
> the cursor type T.
>
> Here the RealBinMapper class exhibits bug (ii) when calculating 
> binWidth in the constructor.
>
> IntBinMapper doesn't let you specify a bin count, but assumes numBins 
> = max - min + 1.  In other words, each bin will track a given integer 
> value.  I haven't actually worked with any histograms of integral 
> valued images but I thought they should work the same way as floating 
> point, that is you could count a range of values in a single histogram 
> bin. /*Is there any reason bins and values should always be 1:1 for 
> integral valued images?*/  This is so in IJ1 for 8-bit and RGB images.
>
> You pass in the minimum and maximum values when you create a 
> HistogramBinMapper, but these are described as bin center values.  My 
> concept of the minimum and maximum values has been the minimum is the 
> lowest value that maps to the first histogram bin and the maximum is 
> the highest value that maps to the last histogram bin.  If we specify 
> min/max as centers some values slightly below minimum and slightly 
> above maximum will map to the first and last histogram bins 
> respectively. /*Do we need to specify min/max as bin center values?*/
>
>
> Thanks!
> Aivar
>
>
> On 8/10/12 2:44 PM, Curtis Rueden wrote:
>> Hi all,
>>
>> Aivar & I also discussed histograms, and our plan for those is a bit 
>> more nebulous. Aivar is going to investigate improving Larry's 
>> histogram API in net.imglib2.algorithms.stats.
>>
>> The general idea is that computing min/max, computing histograms, and 
>> computing other statistics are intrinsically related, and for 
>> performance reasons it is nice to minimize the number of passes 
>> through the image when computing these. So we would like to create a 
>> unified ImageStatistics class (sound familiar? ;-) that can compute 
>> one or more of these in an intelligent way, then return the results 
>> on demand.
>>
>> None of this is reconciled with the net.imglib2.script.analysis 
>> package (Histogram, ImgMax, ImgMean, etc.), but perhaps in the future 
>> the net.imglib2.script stuff can take more direct advantage of it.
>>
>> Regards,
>> Curtis
>>
>>
>> On Tue, Aug 7, 2012 at 4:45 PM, Aivar Grislis <grislis at wisc.edu 
>> <mailto:grislis at wisc.edu>> wrote:
>>
>>     I'd also be interested in working on the histogram code.  Mostly
>>     the code that generates histogram data, also their display,
>>     perhaps the histogram tool itself.
>>
>>     SLIM Plugin uses histograms in a very dynamic way, as they are
>>     updated periodically during the fit process.  You can change the
>>     minimum and maximum values interactively.  So I might be an
>>     interested consumer of any common histogram code.
>>
>>     (I looked at the histogram code in the AutoContrast plugin,
>>     net.imglib2.algorithm.stats.Histogram, and
>>     net.imglib2.script.analysis.Histogram and found bugs in all of
>>     them when binning up the histogram values.)
>>
>>     Aivar
>>
>>
>
>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120810/d7e28aad/attachment-0001.html>

From G.Landini at bham.ac.uk  Sun Aug 12 09:26:22 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Sun, 12 Aug 2012 15:26:22 +0100
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <alpine.DEB.1.00.1208081822160.32459@s15462909.onlinehome-server.info>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<alpine.DEB.1.00.1208081822160.32459@s15462909.onlinehome-server.info>
Message-ID: <3972538.U51GWMsHrq@linux-913j>

On Wednesday 08 Aug 2012 17:23:21 Johannes Schindelin wrote:
> On Thu, 2 Aug 2012, Gabriel Landini wrote:
> > The updater found a new updater version. Now, each time a start ij2 I
> > get a message if I want to start the updater. If I say yes, it asks to
> > restart IJ to finalize previous update.
> > 
> > I restart it and get the same message again. So basically the updater is
> > never started.

> > Does this problem persist?

I am afraid so. I do not think it can update anything.
I deleted the /update folder and it seems that the error stopped. But after 
updating once more, the problem is back. 

I do not seem to be able to tell what version of the jar file this is running 
(It says 2.0.0-beta3 in the status line, but if it did update it, shouldn't a 
a different beta number or sub-number come up?

I eventually replaced the ij-updater-core jar version by the snapshot version 
found in the /update folder.
This eventually found a number of jars for updating. It downloaded them and 
again and after restarting, each time you click on Help>Update, I am asked to 
restart to finalise the previous update. So it is the same error originally 
reported.

Cheers

Gabriel


From G.Landini at bham.ac.uk  Sun Aug 12 09:44:53 2012
From: G.Landini at bham.ac.uk (Gabriel Landini)
Date: Sun, 12 Aug 2012 15:44:53 +0100
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
Message-ID: <2071349.cxbkKQBDM6@linux-913j>

On Monday 06 Aug 2012 20:16:04 Curtis Rueden wrote:

> Personally I think people should need to explicitly subscribe to receive
> unstable/SNAPSHOT updates.

I agree. But at the moment is it unclear what the "update" achieves.
There is little chance of being able to test any fixes if we cannot download 
these. I suppose that I could go the maven way and build some version, but 
still not sure what 

In this page:
http://developer.imagej.net/development

is this the latest/unstable?: 
git clone git://github.com/imagej/imagej.git

> Until we get the multiple channel updates working though, we are erring on
> the side of caution with the update site, meaning you must explicitly
> download the latest snapshot build ZIP file if you want to try it before
> each beta release.

Sure, but look at the dates of the files...

2.0.0-beta3 has a release date of July 13,
The zip with the "latest" snapshot has a date (the newest in the /jars folder) 
of 12 of *June*, older than the beta3...

Cheers

Gabriel



From bdezonia at gmail.com  Mon Aug 13 11:13:11 2012
From: bdezonia at gmail.com (Barry DeZonia)
Date: Mon, 13 Aug 2012 11:13:11 -0500
Subject: [ImageJ-devel] running macros on ImageJ2
In-Reply-To: <CADN69ymW-s3Q9j225G310BYjQSJnoob5kSzUe_Joyk+p6=14mg@mail.gmail.com>
References: <1343677499.73956.YahooMailNeo@web160803.mail.bf1.yahoo.com>
	<CADN69ymW-s3Q9j225G310BYjQSJnoob5kSzUe_Joyk+p6=14mg@mail.gmail.com>
Message-ID: <CAKcvfuRS3o72nCQYmybHQq6-Rii+Cipx6ZABiDWFy5BeHkUggQ@mail.gmail.com>

Hi Raghuram,

To run the macro from the UI you can run the regular menu command Plugins
>> Macro >> Run ... (which is handled by the legacy layer).

To run the macro programmatically you should be able to run the macro via
the LegacyService's runLegacyPlugin() command. You would pass the plugin
name as "ij.plugin.Macro_Runner" and the argument as "thePathToMyMacro.ijm".

On Fri, Aug 10, 2012 at 10:32 AM, Curtis Rueden <ctrueden at wisc.edu> wrote:

> Hi Raghuram,
>
>
>> I am stuck trying to replicate this behavior on IJ2.
>
>
> Full support for macros and scripting with ImageJ2 is scheduled for the
> next beta (or beta5 if we run out of time). See this ticket for details:
>     http://trac.imagej.net/ticket/12
>
>
>> I looked at the code for the ScriptPlugin.java and various other files in
>> the plugins.script package but have no clue on how to get similar
>> functionality as IJ.runMacroFile(..).
>
>
> In the future, there will be a ScriptService providing such functionality.
>
> In the meantime, you should be able to execute your macro as-is in ImageJ2
> via the legacy layer.
>
> Regards,
> Curtis
>
>
> On Mon, Jul 30, 2012 at 2:44 PM, raghuram sathyam <
> raghuramsathyam at yahoo.com> wrote:
>
>> Hello IJ developers,
>> I have been using a macro for processing multiple choice surveys for a
>> while. I wrote this macro from scratch (it was not recorded on the UI) for
>> IJ1 and it works very well on IJ1. I have been trying to migrate to IJ2 so
>> that i can move my processing to the cloud.
>>
>> I have also written some java code to preprocess the images i receive and
>> use IJ as a library within my code. I use IJ.runMacroFile(...) to run the
>> macro that i wrote for further image processing using IJ. I use the results
>> returned by the IJ.runMacroFile(...) for my output.
>>
>> I am stuck trying to replicate this behavior on IJ2.  I looked at the
>> code for the ScriptPlugin.java and various other files in the
>> plugins.script package but have no clue on how to get similar functionality
>> as IJ.runMacroFile(..).
>>
>> Any pointers on how i can get this done will be very helpful.
>>
>> -raghuram
>>
>> _______________________________________________
>> ImageJ-devel mailing list
>> ImageJ-devel at imagej.net
>> http://imagej.net/mailman/listinfo/imagej-devel
>>
>>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120813/aa1f74a2/attachment.html>

From bdezonia at gmail.com  Mon Aug 13 11:27:10 2012
From: bdezonia at gmail.com (Barry DeZonia)
Date: Mon, 13 Aug 2012 11:27:10 -0500
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <2071349.cxbkKQBDM6@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
	<2071349.cxbkKQBDM6@linux-913j>
Message-ID: <CAKcvfuSfHjpmxSX9rsa0_X1q-y0eyVEMQUYaTOFaE9A8q2tx8Q@mail.gmail.com>

Hi Gabriel,

I have been out on vacation recently but have now seen you mention that you
mailed me a plugin that shows an error. I did get that email but have not
gotten around to it yet. I'll try to dig into this soon. Sorry for the wait.

On Sun, Aug 12, 2012 at 9:44 AM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:

> On Monday 06 Aug 2012 20:16:04 Curtis Rueden wrote:
>
> > Personally I think people should need to explicitly subscribe to receive
> > unstable/SNAPSHOT updates.
>
> I agree. But at the moment is it unclear what the "update" achieves.
> There is little chance of being able to test any fixes if we cannot
> download
> these. I suppose that I could go the maven way and build some version, but
> still not sure what
>
> In this page:
> http://developer.imagej.net/development
>
> is this the latest/unstable?:
> git clone git://github.com/imagej/imagej.git
>
> > Until we get the multiple channel updates working though, we are erring
> on
> > the side of caution with the update site, meaning you must explicitly
> > download the latest snapshot build ZIP file if you want to try it before
> > each beta release.
>
> Sure, but look at the dates of the files...
>
> 2.0.0-beta3 has a release date of July 13,
> The zip with the "latest" snapshot has a date (the newest in the /jars
> folder)
> of 12 of *June*, older than the beta3...
>
> Cheers
>
> Gabriel
>
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120813/2d7ffc03/attachment.html>

From ctrueden at wisc.edu  Mon Aug 13 13:15:44 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Mon, 13 Aug 2012 13:15:44 -0500
Subject: [ImageJ-devel] Where are all the plugins?
In-Reply-To: <2071349.cxbkKQBDM6@linux-913j>
References: <2259753.fOaSJOOFp1@linux-913j> <2053516.oIYPUPlNAC@linux-913j>
	<CADN69ymEs1UFNMQFCYJfmPP7PEErXhxDEnUiV7vvWsV9JEkc_w@mail.gmail.com>
	<2071349.cxbkKQBDM6@linux-913j>
Message-ID: <CADN69y=LHokjOt82c_qQdif8qYt=_TTpY=6Wn9oWzTEAzEwH_w@mail.gmail.com>

Hi Gabriel,

> > Personally I think people should need to explicitly subscribe to receive
> > unstable/SNAPSHOT updates.
>
> I agree. But at the moment is it unclear what the "update" achieves.

The update mechanism allows you to upgrade to the latest release. Right
now, that means upgrading from one beta to the another. There were issues
upgrading from beta1, but e.g. a beta3 to beta4 upgrade will be possible
using the updater.

Later, once we have the unstable channel, we will have Jenkins publish the
latest builds there.

> In this page:
> http://developer.imagej.net/development
>
> is this the latest/unstable?:
> git clone git://github.com/imagej/imagej.git

Yes, this gives you the entire Git repository. The master branch is the
very latest code.

Development is very active. You can browse the activity in a couple of
places:
  http://trac.imagej.net/timeline  (combined view of all branches)
  https://github.com/imagej/imagej/commits/master  (activity on master
branch)

> 2.0.0-beta3 has a release date of July 13,
> The zip with the "latest" snapshot has a date (the newest in the /jars
folder)
> of 12 of *June*, older than the beta3...

Thank you for noticing this. The "Application build" link changed, but we
forgot to update the web site to match. So it was a stale link from June
12. I have now fixed it to match the latest builds.

Regards,
Curtis


On Sun, Aug 12, 2012 at 9:44 AM, Gabriel Landini <G.Landini at bham.ac.uk>wrote:

> On Monday 06 Aug 2012 20:16:04 Curtis Rueden wrote:
>
> > Personally I think people should need to explicitly subscribe to receive
> > unstable/SNAPSHOT updates.
>
> I agree. But at the moment is it unclear what the "update" achieves.
> There is little chance of being able to test any fixes if we cannot
> download
> these. I suppose that I could go the maven way and build some version, but
> still not sure what
>
> In this page:
> http://developer.imagej.net/development
>
> is this the latest/unstable?:
> git clone git://github.com/imagej/imagej.git
>
> > Until we get the multiple channel updates working though, we are erring
> on
> > the side of caution with the update site, meaning you must explicitly
> > download the latest snapshot build ZIP file if you want to try it before
> > each beta release.
>
> Sure, but look at the dates of the files...
>
> 2.0.0-beta3 has a release date of July 13,
> The zip with the "latest" snapshot has a date (the newest in the /jars
> folder)
> of 12 of *June*, older than the beta3...
>
> Cheers
>
> Gabriel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120813/0100b7bb/attachment.html>

From volker.baecker at mri.cnrs.fr  Tue Aug 14 02:22:42 2012
From: volker.baecker at mri.cnrs.fr (Volker Baecker)
Date: Tue, 14 Aug 2012 09:22:42 +0200
Subject: [ImageJ-devel] halide: Decoupling Algorithms from Schedules for
 Easy Optimization of Image Processing Pipelines
Message-ID: <5029FCC2.4010907@mri.cnrs.fr>

Hello,
I came across this work which I think could be interesting for some of you.

http://people.csail.mit.edu/jrk/halide12/

A citation from the side:
> We propose a representation for feed-forward imaging pipelines that
> separates the algorithm from its schedule, enabling high-performance
> without sacrificing code clarity. This decoupling simplifies the
> algorithm specification: images and intermediate buffers become
> functions over an infinite integer domain, with no explicit storage or
> boundary conditions. Imaging pipelines are compositions of functions.
> Programmers separately specify scheduling strategies for the various
> functions composing the algorithm, which allows them to efficiently
> explore different optimizations without changing the algorithmic code

Volker


From ctrueden at wisc.edu  Tue Aug 14 13:45:35 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Tue, 14 Aug 2012 13:45:35 -0500
Subject: [ImageJ-devel] ImageJ roadmap update
Message-ID: <CADN69ynO7BPYLK=xCY9cGKr_v1AJbwNqJRakfMpJZVR1+knNxA@mail.gmail.com>

Hi everyone,

Each week, the ImageJ developer team has a meeting to discuss our ticket
status and organization for remaining tasks. At today's meeting, for
reasons of focus as well as timing, we decided to add a sixth beta release
in mid-November.

The theme/focus of each remaining beta is:
  beta4: plugins
  beta5: image data
  beta6: ROIs

We have reprioritized our tickets according to these themes, with
"critical" priority tickets reflecting what is necessary for the theme,
"major" reflecting work that would benefit the theme substantially, and
"minor" reserved for work that is tangential or would be nice but is not
necessary for the theme.

Beta4 will solidify the plugin framework as much as possible. Progress on
that on my front has been good last week, and I hope will continue into
this week. Beta4 will also improve the support for legacy plugins?Barry
fixed some bugs there in the past few days, with more to come. Johannes is
working on two things: 1) subtractive ROIs, which we need for full legacy
support of ROI-centric plugins such as Make Inverse; and 2) the scripting
engine & editor, which is currently the biggest missing piece of ImageJ2's
extensibility framework.

Beta5 will focus on better support for multidimensional image data. It will
include more transparent support for extremely large images, so that File >
Open "just works" rather than needing to worry about "virtual stacks" etc.
It may not include a tiling engine but that can wait till post 2.0.0 final.
Beta5 will also include support for multiple data objects in the same
display, and/or visualizing the same data object using multiple display
mechanisms. We theoretically already support this under the hood, but need
to expose some UI to let users take advantage of it.

Beta6 will include many improvements and bugfixes to ROIs. For details
there, see http://trac.imagej.net/ticket/285.

The current active ticket breakdown by milestone and owner is:

beta4: 204 (aivar 6, bdezonia 100, curtis 77, dscho 21)
beta5: 84 (aivar 4, bdezonia 31, curtis 45, dscho 4)
beta6: 41 (aivar 0, bdezonia 31, curtis 4, dscho 5, leek 1)
final: 71 (aivar 3, bdezonia 25, curtis 39, dscho 4)

For further details, see:
   http://trac.imagej.net/roadmap

Regards,
Curtis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120814/47685d62/attachment.html>

From ctrueden at wisc.edu  Thu Aug 16 10:13:42 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Thu, 16 Aug 2012 10:13:42 -0500
Subject: [ImageJ-devel] halide: Decoupling Algorithms from Schedules for
 Easy Optimization of Image Processing Pipelines
In-Reply-To: <5029FCC2.4010907@mri.cnrs.fr>
References: <5029FCC2.4010907@mri.cnrs.fr>
Message-ID: <CADN69yn2hTVy4y-5txP2B88VfajRwH_nNhTVxh6HqroFi+0NYw@mail.gmail.com>

Hi Volker,

Halide looks quite cool, and is a very similar idea to other recent
libraries, including the OPS package of ImgLib, and ImgLib in general. In
the future, perhaps we could create a Halide bridge, making it easier to
invoke such algorithms on data within ImageJ. But of course it must wait
until someone is using it and/or needs it.

Regards,
Curtis


On Tue, Aug 14, 2012 at 2:22 AM, Volker Baecker
<volker.baecker at mri.cnrs.fr>wrote:

> Hello,
> I came across this work which I think could be interesting for some of you.
>
> http://people.csail.mit.edu/jrk/halide12/
>
> A citation from the side:
> > We propose a representation for feed-forward imaging pipelines that
> > separates the algorithm from its schedule, enabling high-performance
> > without sacrificing code clarity. This decoupling simplifies the
> > algorithm specification: images and intermediate buffers become
> > functions over an infinite integer domain, with no explicit storage or
> > boundary conditions. Imaging pipelines are compositions of functions.
> > Programmers separately specify scheduling strategies for the various
> > functions composing the algorithm, which allows them to efficiently
> > explore different optimizations without changing the algorithmic code
>
> Volker
>
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120816/91015e4a/attachment.html>

From pietzsch at mpi-cbg.de  Fri Aug 17 09:24:39 2012
From: pietzsch at mpi-cbg.de (Tobias Pietzsch)
Date: Fri, 17 Aug 2012 16:24:39 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
Message-ID: <502E5427.2050808@mpi-cbg.de>

Hi,

the last two days, I finally took some time to take a deeper look at
the Local Neighborhoods. About a year ago, I discussed with Stephan
Saalfeld the idea that Neighborhood systems could just be nested
Accessibles. I did a lot of exploratory implementation and it all lead
naturally back to this idea. It just feels very "Imglib-like". I think
it's the way to go.

I made a proof-of-concept implementation which I just pushed to branch
"tobias-neighborhood-experiments".  After playing around a lot, I have
basically come up with the following design:


Neighborhood<T>
===============
The interface Neighborhood<T> extends Localizable, IterableInterval<T>.
It is _not_ Positionable. It is simply at a fixed location.


Cursor/RandomAccess< Neighborhood<T> >
========================================
To move a neighborhood around, we use standard accessor interfaces.
Assume you have a RandomAccess<Neighborhood<T>> a.
Using a.setPosition() you can position the center of the neighborhood.
Using a.get() you obtain a Neighborhood<T> (which you can then iterate).

In many ways, the Neighborhood is like a NativeType. It is just a
reference into an underlying structure. If you have a Cursor<T> of
a NativeType, then the result T t = cursor.get() will be invalidated
when you advance the cursor. The same holds for Cursor<Neighborhood<T>>.
When you move the cursor, the neighborhood Neighborhood<T> n =
cursor.get() will be invalidated when you advance the cursor.


IterableInterval/RandomAccessible< Neighborhood<T> >
====================================================
Of course, once you have the Accessors, it's easy to put the into
Accessibles and benefit from all the goodies that are in ImgLib already.
For example, if you have implemented a RandomAccess<Neighborhood<T>>
it is straightforward to wrap it into a RandomAccessible and use
Views.iterable() to get a Cursor over Neighborhood<T>.

This results is pure syntactic sugar and lets you write sexy code like
this:
   for ( Neighborhood<T> n : neighborhoods )
       for ( T t : n )
           ...

Shape
=====
At the top level is the interface "Shape". This is basically a factory
for Accessibles on Neighborhoods. Every type of neighborhood should 
provide such a factory. There are four methods. The first is

   public <T> IterableInterval<Neighborhood<T>>
       neighborhoods( final RandomAccessibleInterval<T> source );

This will give you an IteratableInterval over all neighborhoods in the 
source image. Augmenting the above example, in actual code it is used
like this:
   Img<FloatType> img;
   long radius;
   HyperSphereShape shape = new HyperSphereShape( radius );
   for ( Neighborhood<FloatType> n : shape.neighborhoods( img ) )
       for ( FloatType t : n )
           ...

The second method is

   public <T> RandomAccessibleInterval<Neighborhood<T>>
       neighborhoodsRandomAccessible(
           final RandomAccessibleInterval<T> source );

which gives you a RandomAccessibleInterval over all neighborhoods.
Then there are "safe" variants of these two methods, which I will 
discuss later because it goes a bit deeper into the details...

Examples
========
I have fully implemented RectangleShape which supports
(hyper-)rectangular neighborhoods. This is rather involved, because
it supports both neighborhoods that skip the center pixel and such
that don't; it has both an implementation of Cursor<Neighborhood<T>>
and RandomAccess<Neighborhood<T>> for optimal speed; and so on...

There is an incomplete implementation of HyperSphereShape, which
despite being incomplete should be a better example to look at first.
Basically I just copied and pasted from HyperSphereCursor.
In this case, there is only a RandomAccess<Neighborhood<T>>. The
Cursor is simply build using Views.iterable().

Unfortunately, the code is still largely undocumented. I put effort
into documenting the Shape interface, but that's it basically :(

As an example for how to use Neighborhoods, please see
net.imglib2.algorithm.region.localneighborhood.MinFilterExample
in the imglib2-tests sub-project.
Actually, just let me paste a fragement here. This implements a
minimum filter using arbitrary neighborhood Shape:

public static <T extends Type<T> & Comparable<T> > void
     minFilter( final RandomAccessibleInterval<T> input,
                final RandomAccessibleInterval<T> output,
                final Shape shape )
{
   final RandomAccess< T > out = output.randomAccess();
   for (final Neighborhood<T> neighborhood : shape.neighborhoods(input))
   {
     out.setPosition( neighborhood );
     final T o = out.get();
     o.set( neighborhood.firstElement() );
     for ( final T i : neighborhood )
       if ( i.compareTo( o ) < 0 )
         o.set( i );
   }
}

Beautiful, isn't it?

Safe vs Unsafe Neighborhoods
============================
About the "safe" variants of the methods in Shape. The above "unsafe"
variants behave as follows: A Neighborhood<T> that you obtained from the
returned accessible will re-use a single Cursor instance. That is:
   Neighborhood<T> n = shape.neighborhoods( img ).firstElement();
   Cursor<T> c1 = n.cursor();
   Cursor<T> c2 = n.cursor();
Here, c1 and c2 will be the same object! This is necessary to make
the nested loops shown above really fast. Otherwise here,
   for ( Neighborhood<T> n : neighborhoods )
       for ( T t : n )
in every iteration of the outer loop, a new Cursor would be created for
the inner loop.
I decided to make the "unsafe" option the default, i.e., the methods are
called Shape.neighborhoods() and Shape.neighborhoodsSafe() instead of
Shape.neighborhoodsUnsafe() and Shape.neighborhoods(). I'm open to 
change that, though.

If you require a different behaviour, you can use the
Shape.neighborhoodsSafe and neighborhoodsRandomAccessibleSafe methods.
There are also other options which are described in the javadoc of the 
Shape interface. Please have a look!

Performance
===========
It can be made quite fast, actually. I have implemented a find-local-
maxima benchmark (see LocalMaximaBenchmark) that compares several
implementations of (3x3x...x3) Neighborhood.

To count local maxima in a 200x200x200 float image, I get
683 ms using RectangleShape vs
877 ms using the old LocalNeighborhoodCursor



As you might have noticed, I have completely neclected the copyOn() and
updateSource() methods we discussed before.  I don't really see the need
for them in the above design.

Ok, I hope you will have a look at the code
(branch "tobias-neighborhood-experiments") and tell me what you think.

best regards,
Tobias


On 07/27/2012 05:35 PM, Jean-Yves Tinevez wrote:
>
> Hi all
>
> I pushed some changes to the test branch: I removed the realpositionable
> stuff, and tried to draft the mother interface from our discussions.
>
> But I got stuck at the copyOn method. If I try to make it as generic as
> I can (copy on a different RandomAccessible type and on a different
> type), concrete implementations that are more specific (like the
> buffered rectangle) fail on bad type bounds. I could use some help there.
>
> Best
> jy
>
>



From jeanyves.tinevez at gmail.com  Sat Aug 18 14:37:21 2012
From: jeanyves.tinevez at gmail.com (Jean-Yves Tinevez)
Date: Sat, 18 Aug 2012 21:37:21 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <502E5427.2050808@mpi-cbg.de>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
Message-ID: <CAAgB9O648Z5wWE1s7m9pAumSmR2DoNPAwskLK4mvqKqTdxyWOg@mail.gmail.com>

Hi Tobias,

Congratulations on this very clever design!

I totally buy it, and just have basic questions.

>
> Cursor/RandomAccess< Neighborhood<T> >
> ==============================**==========
> To move a neighborhood around, we use standard accessor interfaces.
> Assume you have a RandomAccess<Neighborhood<T>> a.
> Using a.setPosition() you can position the center of the neighborhood.
> Using a.get() you obtain a Neighborhood<T> (which you can then iterate).
>
> In many ways, the Neighborhood is like a NativeType. It is just a
> reference into an underlying structure. If you have a Cursor<T> of
> a NativeType, then the result T t = cursor.get() will be invalidated
> when you advance the cursor. The same holds for Cursor<Neighborhood<T>>.
> When you move the cursor, the neighborhood Neighborhood<T> n =
> cursor.get() will be invalidated when you advance the cursor.
>
>
This is really clever, clearly in the lines of master Stephan. Every time I
ask a question, he tells me to focus on a new type.



>
> IterableInterval/**RandomAccessible< Neighborhood<T> >
> ==============================**======================
> Of course, once you have the Accessors, it's easy to put the into
> Accessibles and benefit from all the goodies that are in ImgLib already.
> For example, if you have implemented a RandomAccess<Neighborhood<T>>
> it is straightforward to wrap it into a RandomAccessible and use
> Views.iterable() to get a Cursor over Neighborhood<T>.
>
> This results is pure syntactic sugar and lets you write sexy code like
> this:
>   for ( Neighborhood<T> n : neighborhoods )
>       for ( T t : n )
>           ...
>

A basic question: how do we deal with out-of-bounds? Some strategies might
require to know whether you are outside bounds, or even specify the OOBS.
Example: an average filter wants to skip the pixels that are not inside the
image.

How do we get that with the neighborhood iterator?


> As you might have noticed, I have completely neclected the copyOn() and
> updateSource() methods we discussed before.  I don't really see the need
> for them in the above design.
>
> Ok, I hope you will have a look at the code
> (branch "tobias-neighborhood-**experiments") and tell me what you think.
>
> Will do!
Thanks!
jy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120818/e50f2fe4/attachment.html>

From saalfeld at mpi-cbg.de  Mon Aug 20 05:56:11 2012
From: saalfeld at mpi-cbg.de (Stephan Saalfeld)
Date: Mon, 20 Aug 2012 12:56:11 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <502E5427.2050808@mpi-cbg.de>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
Message-ID: <1345460171.2241.70.camel@saalfeld-thinkpad>

Hi Tobias and all,

great---thanks for spending time on that.

The most important design question in my opinion is what Tobias has now
called the `Safe' vs. `UnSafe' concept.  As far as I remember from
previous discussions we do not have a final answer yet to that problem
and I sucked in posting the discussion to the Wiki.  So I suggest to
discuss it here now it becomes relevant.

The problem:

Both, accessors (e.g. Cursor) and proxy types (e.g. NativeType) are
stateful.  How should they be used in concurrent (e.g. multi-threaded)
code?  So far, the contract in ImgLib2 is: one accessor should not be
used concurrently, concurrent threads should each acquire a unique
accessor which, if required, provides a unique proxy type.  The inverse
contract is that if you have an accessible (e.g. IterableInterval), then
you can write concurrent code by requesting a unique accessor for each
thread.  This becomes problematic when accessibles are `nested', i.e.
the proxy type is an accessible.  The contract holds at all nested
levels when using what Tobias has implemented as the `Safe' solution.
It holds only at the top nesting level when using the `UnSafe' solution
where the `inner' accessible uses one single accessor instance.  Why
then doing it?  Because it is faster.  Iterating a 4-neighborhood for
each pixel in a 2d image would be slower when creating a new accessor at
each pixel-location.  Why is it problematic?  Because methods working
with an accessible as input can be applied to the inner accessibles,
may be implemented concurrently (e.g. apply convolution to a
neighborhood), and do not know at which `nesting' level they are called
(it also sucks to require thinking about that).

Nesting accessibles is clearly a good thing and basically the reason why
ImgLib2 is designed as it is.  For `small' accessibles, it is necessary
to break the current contract that an accessible generates independent
accessors, because they would be slow otherwise.  So that contract is
broken.

My current idea to solve this issue at compile time is by introducing
the empty interface ConcurrencySafe and require each accessible that
generates independent accessors to implement this interface.  Methods
that depend on that must then require their input to implement this
interface, e.g.

<A extends RandomAccessible<T> & ConcurrencySafe>
void convolve(A a, A b){ ... }

Since it doesn't interfere with existing code, it would enable to slowly
add this `security' constraint slowly over time while keeping things
running.

It also means that the safe and unsafe factories would return a generic
interface combination and it can become a bit convoluted to keep that
information for passing such an object into another method using the
buggy Oracle compiler...

An Oracle-friendly option would be to embed that interface into the
interface hierarchy and create the full bunch of concurrency safe
extensions of existing interfaces:
ConcurrencySafeRandomAccessible extends RandomAccessible
ConcurrencySafeIterableInterval extends IterableInterval ...

Obviously, the JDK is not doing this and instead throws Exceptions for
an enormous synchronization and testing overhead at runtime (compare
Vector and ArrayList).

What do you think?

Best,
Stephan



On Fri, 2012-08-17 at 16:24 +0200, Tobias Pietzsch wrote: 
> Hi,
> 
> the last two days, I finally took some time to take a deeper look at
> the Local Neighborhoods. About a year ago, I discussed with Stephan
> Saalfeld the idea that Neighborhood systems could just be nested
> Accessibles. I did a lot of exploratory implementation and it all lead
> naturally back to this idea. It just feels very "Imglib-like". I think
> it's the way to go.
> 
> I made a proof-of-concept implementation which I just pushed to branch
> "tobias-neighborhood-experiments".  After playing around a lot, I have
> basically come up with the following design:
> 
> 
> Neighborhood<T>
> ===============
> The interface Neighborhood<T> extends Localizable, IterableInterval<T>.
> It is _not_ Positionable. It is simply at a fixed location.
> 
> 
> Cursor/RandomAccess< Neighborhood<T> >
> ========================================
> To move a neighborhood around, we use standard accessor interfaces.
> Assume you have a RandomAccess<Neighborhood<T>> a.
> Using a.setPosition() you can position the center of the neighborhood.
> Using a.get() you obtain a Neighborhood<T> (which you can then iterate).
> 
> In many ways, the Neighborhood is like a NativeType. It is just a
> reference into an underlying structure. If you have a Cursor<T> of
> a NativeType, then the result T t = cursor.get() will be invalidated
> when you advance the cursor. The same holds for Cursor<Neighborhood<T>>.
> When you move the cursor, the neighborhood Neighborhood<T> n =
> cursor.get() will be invalidated when you advance the cursor.
> 
> 
> IterableInterval/RandomAccessible< Neighborhood<T> >
> ====================================================
> Of course, once you have the Accessors, it's easy to put the into
> Accessibles and benefit from all the goodies that are in ImgLib already.
> For example, if you have implemented a RandomAccess<Neighborhood<T>>
> it is straightforward to wrap it into a RandomAccessible and use
> Views.iterable() to get a Cursor over Neighborhood<T>.
> 
> This results is pure syntactic sugar and lets you write sexy code like
> this:
>    for ( Neighborhood<T> n : neighborhoods )
>        for ( T t : n )
>            ...
> 
> Shape
> =====
> At the top level is the interface "Shape". This is basically a factory
> for Accessibles on Neighborhoods. Every type of neighborhood should 
> provide such a factory. There are four methods. The first is
> 
>    public <T> IterableInterval<Neighborhood<T>>
>        neighborhoods( final RandomAccessibleInterval<T> source );
> 
> This will give you an IteratableInterval over all neighborhoods in the 
> source image. Augmenting the above example, in actual code it is used
> like this:
>    Img<FloatType> img;
>    long radius;
>    HyperSphereShape shape = new HyperSphereShape( radius );
>    for ( Neighborhood<FloatType> n : shape.neighborhoods( img ) )
>        for ( FloatType t : n )
>            ...
> 
> The second method is
> 
>    public <T> RandomAccessibleInterval<Neighborhood<T>>
>        neighborhoodsRandomAccessible(
>            final RandomAccessibleInterval<T> source );
> 
> which gives you a RandomAccessibleInterval over all neighborhoods.
> Then there are "safe" variants of these two methods, which I will 
> discuss later because it goes a bit deeper into the details...
> 
> Examples
> ========
> I have fully implemented RectangleShape which supports
> (hyper-)rectangular neighborhoods. This is rather involved, because
> it supports both neighborhoods that skip the center pixel and such
> that don't; it has both an implementation of Cursor<Neighborhood<T>>
> and RandomAccess<Neighborhood<T>> for optimal speed; and so on...
> 
> There is an incomplete implementation of HyperSphereShape, which
> despite being incomplete should be a better example to look at first.
> Basically I just copied and pasted from HyperSphereCursor.
> In this case, there is only a RandomAccess<Neighborhood<T>>. The
> Cursor is simply build using Views.iterable().
> 
> Unfortunately, the code is still largely undocumented. I put effort
> into documenting the Shape interface, but that's it basically :(
> 
> As an example for how to use Neighborhoods, please see
> net.imglib2.algorithm.region.localneighborhood.MinFilterExample
> in the imglib2-tests sub-project.
> Actually, just let me paste a fragement here. This implements a
> minimum filter using arbitrary neighborhood Shape:
> 
> public static <T extends Type<T> & Comparable<T> > void
>      minFilter( final RandomAccessibleInterval<T> input,
>                 final RandomAccessibleInterval<T> output,
>                 final Shape shape )
> {
>    final RandomAccess< T > out = output.randomAccess();
>    for (final Neighborhood<T> neighborhood : shape.neighborhoods(input))
>    {
>      out.setPosition( neighborhood );
>      final T o = out.get();
>      o.set( neighborhood.firstElement() );
>      for ( final T i : neighborhood )
>        if ( i.compareTo( o ) < 0 )
>          o.set( i );
>    }
> }
> 
> Beautiful, isn't it?
> 
> Safe vs Unsafe Neighborhoods
> ============================
> About the "safe" variants of the methods in Shape. The above "unsafe"
> variants behave as follows: A Neighborhood<T> that you obtained from the
> returned accessible will re-use a single Cursor instance. That is:
>    Neighborhood<T> n = shape.neighborhoods( img ).firstElement();
>    Cursor<T> c1 = n.cursor();
>    Cursor<T> c2 = n.cursor();
> Here, c1 and c2 will be the same object! This is necessary to make
> the nested loops shown above really fast. Otherwise here,
>    for ( Neighborhood<T> n : neighborhoods )
>        for ( T t : n )
> in every iteration of the outer loop, a new Cursor would be created for
> the inner loop.
> I decided to make the "unsafe" option the default, i.e., the methods are
> called Shape.neighborhoods() and Shape.neighborhoodsSafe() instead of
> Shape.neighborhoodsUnsafe() and Shape.neighborhoods(). I'm open to 
> change that, though.
> 
> If you require a different behaviour, you can use the
> Shape.neighborhoodsSafe and neighborhoodsRandomAccessibleSafe methods.
> There are also other options which are described in the javadoc of the 
> Shape interface. Please have a look!
> 
> Performance
> ===========
> It can be made quite fast, actually. I have implemented a find-local-
> maxima benchmark (see LocalMaximaBenchmark) that compares several
> implementations of (3x3x...x3) Neighborhood.
> 
> To count local maxima in a 200x200x200 float image, I get
> 683 ms using RectangleShape vs
> 877 ms using the old LocalNeighborhoodCursor
> 
> 
> 
> As you might have noticed, I have completely neclected the copyOn() and
> updateSource() methods we discussed before.  I don't really see the need
> for them in the above design.
> 
> Ok, I hope you will have a look at the code
> (branch "tobias-neighborhood-experiments") and tell me what you think.
> 
> best regards,
> Tobias
> 
> 
> On 07/27/2012 05:35 PM, Jean-Yves Tinevez wrote:
> >
> > Hi all
> >
> > I pushed some changes to the test branch: I removed the realpositionable
> > stuff, and tried to draft the mother interface from our discussions.
> >
> > But I got stuck at the copyOn method. If I try to make it as generic as
> > I can (copy on a different RandomAccessible type and on a different
> > type), concrete implementations that are more specific (like the
> > buffered rectangle) fail on bad type bounds. I could use some help there.
> >
> > Best
> > jy
> >
> >
> 
> 
> _______________________________________________
> ImageJ-devel mailing list
> ImageJ-devel at imagej.net
> http://imagej.net/mailman/listinfo/imagej-devel



From pietzsch at mpi-cbg.de  Mon Aug 20 07:42:32 2012
From: pietzsch at mpi-cbg.de (Tobias Pietzsch)
Date: Mon, 20 Aug 2012 14:42:32 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <1345460171.2241.70.camel@saalfeld-thinkpad>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<1345460171.2241.70.camel@saalfeld-thinkpad>
Message-ID: <503230B8.2060800@mpi-cbg.de>

Hi Stephan,

I think, having the ConcurrencySafe interface is a reasonable 
suggestion.  I vote for adding the combined interfaces instead of
returning generic interface combinations because that would involve
changing code in lots of places and probably get us into trouble with
the non-Eclipse world...

For simplicity, maybe we should do it the other way around, that is, 
have "ConcurrencyUnsafeRandomAccessible" and then have RandomAccessible 
extend that (and ConcurrencySafe, but maybe that interface is not even 
required).

This way we would have to change relatively little code.

If we want the fullest support for the concurrency-unsafe Accessibles, 
there would still be a lot of code duplication, i.e., OutOfBounds and 
Views duplicated for safe and unsafe variants (view on a safe Accessible
is itself safe).  Therefore I would rather suggest that we make the
unsafe Accessibles second-class citizens for now. Only intented for
inner loops and such. The main point is to prevent people from 
accidentally using non-safe methods on these inner Accessibles and that 
would be achieved.

best regards,
Tobias



On 08/20/2012 12:56 PM, Stephan Saalfeld wrote:
> Hi Tobias and all,
>
> great---thanks for spending time on that.
>
> The most important design question in my opinion is what Tobias has now
> called the `Safe' vs. `UnSafe' concept.  As far as I remember from
> previous discussions we do not have a final answer yet to that problem
> and I sucked in posting the discussion to the Wiki.  So I suggest to
> discuss it here now it becomes relevant.
>
> The problem:
>
> Both, accessors (e.g. Cursor) and proxy types (e.g. NativeType) are
> stateful.  How should they be used in concurrent (e.g. multi-threaded)
> code?  So far, the contract in ImgLib2 is: one accessor should not be
> used concurrently, concurrent threads should each acquire a unique
> accessor which, if required, provides a unique proxy type.  The inverse
> contract is that if you have an accessible (e.g. IterableInterval), then
> you can write concurrent code by requesting a unique accessor for each
> thread.  This becomes problematic when accessibles are `nested', i.e.
> the proxy type is an accessible.  The contract holds at all nested
> levels when using what Tobias has implemented as the `Safe' solution.
> It holds only at the top nesting level when using the `UnSafe' solution
> where the `inner' accessible uses one single accessor instance.  Why
> then doing it?  Because it is faster.  Iterating a 4-neighborhood for
> each pixel in a 2d image would be slower when creating a new accessor at
> each pixel-location.  Why is it problematic?  Because methods working
> with an accessible as input can be applied to the inner accessibles,
> may be implemented concurrently (e.g. apply convolution to a
> neighborhood), and do not know at which `nesting' level they are called
> (it also sucks to require thinking about that).
>
> Nesting accessibles is clearly a good thing and basically the reason why
> ImgLib2 is designed as it is.  For `small' accessibles, it is necessary
> to break the current contract that an accessible generates independent
> accessors, because they would be slow otherwise.  So that contract is
> broken.
>
> My current idea to solve this issue at compile time is by introducing
> the empty interface ConcurrencySafe and require each accessible that
> generates independent accessors to implement this interface.  Methods
> that depend on that must then require their input to implement this
> interface, e.g.
>
> <A extends RandomAccessible<T> & ConcurrencySafe>
> void convolve(A a, A b){ ... }
>
> Since it doesn't interfere with existing code, it would enable to slowly
> add this `security' constraint slowly over time while keeping things
> running.
>
> It also means that the safe and unsafe factories would return a generic
> interface combination and it can become a bit convoluted to keep that
> information for passing such an object into another method using the
> buggy Oracle compiler...
>
> An Oracle-friendly option would be to embed that interface into the
> interface hierarchy and create the full bunch of concurrency safe
> extensions of existing interfaces:
> ConcurrencySafeRandomAccessible extends RandomAccessible
> ConcurrencySafeIterableInterval extends IterableInterval ...
>
> Obviously, the JDK is not doing this and instead throws Exceptions for
> an enormous synchronization and testing overhead at runtime (compare
> Vector and ArrayList).
>
> What do you think?
>
> Best,
> Stephan
>
>
>
> On Fri, 2012-08-17 at 16:24 +0200, Tobias Pietzsch wrote:
>> Hi,
>>
>> the last two days, I finally took some time to take a deeper look at
>> the Local Neighborhoods. About a year ago, I discussed with Stephan
>> Saalfeld the idea that Neighborhood systems could just be nested
>> Accessibles. I did a lot of exploratory implementation and it all lead
>> naturally back to this idea. It just feels very "Imglib-like". I think
>> it's the way to go.
>>
>> I made a proof-of-concept implementation which I just pushed to branch
>> "tobias-neighborhood-experiments".  After playing around a lot, I have
>> basically come up with the following design:
>>
>>
>> Neighborhood<T>
>> ===============
>> The interface Neighborhood<T> extends Localizable, IterableInterval<T>.
>> It is _not_ Positionable. It is simply at a fixed location.
>>
>>
>> Cursor/RandomAccess< Neighborhood<T> >
>> ========================================
>> To move a neighborhood around, we use standard accessor interfaces.
>> Assume you have a RandomAccess<Neighborhood<T>> a.
>> Using a.setPosition() you can position the center of the neighborhood.
>> Using a.get() you obtain a Neighborhood<T> (which you can then iterate).
>>
>> In many ways, the Neighborhood is like a NativeType. It is just a
>> reference into an underlying structure. If you have a Cursor<T> of
>> a NativeType, then the result T t = cursor.get() will be invalidated
>> when you advance the cursor. The same holds for Cursor<Neighborhood<T>>.
>> When you move the cursor, the neighborhood Neighborhood<T> n =
>> cursor.get() will be invalidated when you advance the cursor.
>>
>>
>> IterableInterval/RandomAccessible< Neighborhood<T> >
>> ====================================================
>> Of course, once you have the Accessors, it's easy to put the into
>> Accessibles and benefit from all the goodies that are in ImgLib already.
>> For example, if you have implemented a RandomAccess<Neighborhood<T>>
>> it is straightforward to wrap it into a RandomAccessible and use
>> Views.iterable() to get a Cursor over Neighborhood<T>.
>>
>> This results is pure syntactic sugar and lets you write sexy code like
>> this:
>>     for ( Neighborhood<T> n : neighborhoods )
>>         for ( T t : n )
>>             ...
>>
>> Shape
>> =====
>> At the top level is the interface "Shape". This is basically a factory
>> for Accessibles on Neighborhoods. Every type of neighborhood should
>> provide such a factory. There are four methods. The first is
>>
>>     public <T> IterableInterval<Neighborhood<T>>
>>         neighborhoods( final RandomAccessibleInterval<T> source );
>>
>> This will give you an IteratableInterval over all neighborhoods in the
>> source image. Augmenting the above example, in actual code it is used
>> like this:
>>     Img<FloatType> img;
>>     long radius;
>>     HyperSphereShape shape = new HyperSphereShape( radius );
>>     for ( Neighborhood<FloatType> n : shape.neighborhoods( img ) )
>>         for ( FloatType t : n )
>>             ...
>>
>> The second method is
>>
>>     public <T> RandomAccessibleInterval<Neighborhood<T>>
>>         neighborhoodsRandomAccessible(
>>             final RandomAccessibleInterval<T> source );
>>
>> which gives you a RandomAccessibleInterval over all neighborhoods.
>> Then there are "safe" variants of these two methods, which I will
>> discuss later because it goes a bit deeper into the details...
>>
>> Examples
>> ========
>> I have fully implemented RectangleShape which supports
>> (hyper-)rectangular neighborhoods. This is rather involved, because
>> it supports both neighborhoods that skip the center pixel and such
>> that don't; it has both an implementation of Cursor<Neighborhood<T>>
>> and RandomAccess<Neighborhood<T>> for optimal speed; and so on...
>>
>> There is an incomplete implementation of HyperSphereShape, which
>> despite being incomplete should be a better example to look at first.
>> Basically I just copied and pasted from HyperSphereCursor.
>> In this case, there is only a RandomAccess<Neighborhood<T>>. The
>> Cursor is simply build using Views.iterable().
>>
>> Unfortunately, the code is still largely undocumented. I put effort
>> into documenting the Shape interface, but that's it basically :(
>>
>> As an example for how to use Neighborhoods, please see
>> net.imglib2.algorithm.region.localneighborhood.MinFilterExample
>> in the imglib2-tests sub-project.
>> Actually, just let me paste a fragement here. This implements a
>> minimum filter using arbitrary neighborhood Shape:
>>
>> public static <T extends Type<T> & Comparable<T> > void
>>       minFilter( final RandomAccessibleInterval<T> input,
>>                  final RandomAccessibleInterval<T> output,
>>                  final Shape shape )
>> {
>>     final RandomAccess< T > out = output.randomAccess();
>>     for (final Neighborhood<T> neighborhood : shape.neighborhoods(input))
>>     {
>>       out.setPosition( neighborhood );
>>       final T o = out.get();
>>       o.set( neighborhood.firstElement() );
>>       for ( final T i : neighborhood )
>>         if ( i.compareTo( o ) < 0 )
>>           o.set( i );
>>     }
>> }
>>
>> Beautiful, isn't it?
>>
>> Safe vs Unsafe Neighborhoods
>> ============================
>> About the "safe" variants of the methods in Shape. The above "unsafe"
>> variants behave as follows: A Neighborhood<T> that you obtained from the
>> returned accessible will re-use a single Cursor instance. That is:
>>     Neighborhood<T> n = shape.neighborhoods( img ).firstElement();
>>     Cursor<T> c1 = n.cursor();
>>     Cursor<T> c2 = n.cursor();
>> Here, c1 and c2 will be the same object! This is necessary to make
>> the nested loops shown above really fast. Otherwise here,
>>     for ( Neighborhood<T> n : neighborhoods )
>>         for ( T t : n )
>> in every iteration of the outer loop, a new Cursor would be created for
>> the inner loop.
>> I decided to make the "unsafe" option the default, i.e., the methods are
>> called Shape.neighborhoods() and Shape.neighborhoodsSafe() instead of
>> Shape.neighborhoodsUnsafe() and Shape.neighborhoods(). I'm open to
>> change that, though.
>>
>> If you require a different behaviour, you can use the
>> Shape.neighborhoodsSafe and neighborhoodsRandomAccessibleSafe methods.
>> There are also other options which are described in the javadoc of the
>> Shape interface. Please have a look!
>>
>> Performance
>> ===========
>> It can be made quite fast, actually. I have implemented a find-local-
>> maxima benchmark (see LocalMaximaBenchmark) that compares several
>> implementations of (3x3x...x3) Neighborhood.
>>
>> To count local maxima in a 200x200x200 float image, I get
>> 683 ms using RectangleShape vs
>> 877 ms using the old LocalNeighborhoodCursor
>>
>>
>>
>> As you might have noticed, I have completely neclected the copyOn() and
>> updateSource() methods we discussed before.  I don't really see the need
>> for them in the above design.
>>
>> Ok, I hope you will have a look at the code
>> (branch "tobias-neighborhood-experiments") and tell me what you think.
>>
>> best regards,
>> Tobias
>>
>>
>> On 07/27/2012 05:35 PM, Jean-Yves Tinevez wrote:
>>>
>>> Hi all
>>>
>>> I pushed some changes to the test branch: I removed the realpositionable
>>> stuff, and tried to draft the mother interface from our discussions.
>>>
>>> But I got stuck at the copyOn method. If I try to make it as generic as
>>> I can (copy on a different RandomAccessible type and on a different
>>> type), concrete implementations that are more specific (like the
>>> buffered rectangle) fail on bad type bounds. I could use some help there.
>>>
>>> Best
>>> jy
>>>
>>>
>>
>>
>> _______________________________________________
>> ImageJ-devel mailing list
>> ImageJ-devel at imagej.net
>> http://imagej.net/mailman/listinfo/imagej-devel
>



From jeanyves.tinevez at gmail.com  Mon Aug 20 07:50:04 2012
From: jeanyves.tinevez at gmail.com (Jean-Yves Tinevez)
Date: Mon, 20 Aug 2012 14:50:04 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <503230B8.2060800@mpi-cbg.de>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<1345460171.2241.70.camel@saalfeld-thinkpad>
	<503230B8.2060800@mpi-cbg.de>
Message-ID: <CAAgB9O7oDCMYhKEaJtHU1LAnCCTaxQO=i0NwUg3Qjop7AGTPvA@mail.gmail.com>

Hi Stephan

Just to be sure I got your point:

You mean that if we iterate over all the neighbohoods of a single final
image in a multithreaded way, we might screw up with the unsafe
implementations right? In a pseudo code, this:

for (int i =0; i < nThreads, i++) {
  threads[i] = new Thread() {

    public void run() {

             for ( Neighborhood<T> n : chunks)
                    for ( T t : n )
          ...
...
...

would always fail with the unsafe implementation and always work with safe
implementations? Right??
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120820/2ced4f60/attachment-0001.html>

From saalfeld at mpi-cbg.de  Mon Aug 20 07:54:16 2012
From: saalfeld at mpi-cbg.de (Stephan Saalfeld)
Date: Mon, 20 Aug 2012 14:54:16 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <CAAgB9O7oDCMYhKEaJtHU1LAnCCTaxQO=i0NwUg3Qjop7AGTPvA@mail.gmail.com>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<1345460171.2241.70.camel@saalfeld-thinkpad>
	<503230B8.2060800@mpi-cbg.de>
	<CAAgB9O7oDCMYhKEaJtHU1LAnCCTaxQO=i0NwUg3Qjop7AGTPvA@mail.gmail.com>
Message-ID: <1345467256.2241.84.camel@saalfeld-thinkpad>

No---that would work in all cases.  It would fail if you put the inner
loop into threads.

for ( Neighborhood<T> n : chunks) {
  for (int i =0; i < nThreads, i++) {
    threads[i] = new Thread() {  
       public void run() {              
         for ( T t : n )
           ... 
...
...

When would you do that?  E.g. when applying a multi-threaded
implementation to a neighborhood.




On Mon, 2012-08-20 at 14:50 +0200, Jean-Yves Tinevez wrote:
> Hi Stephan
> 
> Just to be sure I got your point:
> 
> You mean that if we iterate over all the neighbohoods of a single
> final image in a multithreaded way, we might screw up with the unsafe
> implementations right? In a pseudo code, this:
> 
> for (int i =0; i < nThreads, i++) {
>   threads[i] = new Thread() {
>   
>     public void run() {
> 
>              for ( Neighborhood<T> n : chunks)
>                     for ( T t : n )
>           ... 
> ...
> ...
> 
> would always fail with the unsafe implementation and always work with
> safe implementations? Right??



From tinevez at pasteur.fr  Mon Aug 20 07:56:34 2012
From: tinevez at pasteur.fr (Jean-Yves Tinevez)
Date: Mon, 20 Aug 2012 14:56:34 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <1345467256.2241.84.camel@saalfeld-thinkpad>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<1345460171.2241.70.camel@saalfeld-thinkpad>
	<503230B8.2060800@mpi-cbg.de>
	<CAAgB9O7oDCMYhKEaJtHU1LAnCCTaxQO=i0NwUg3Qjop7AGTPvA@mail.gmail.com>
	<1345467256.2241.84.camel@saalfeld-thinkpad>
Message-ID: <50323402.4030303@pasteur.fr>

On 20-Aug-12 14:54, Stephan Saalfeld wrote:
> No---that would work in all cases.  It would fail if you put the inner
> loop into threads.
>
> for ( Neighborhood<T> n : chunks) {
>    for (int i =0; i < nThreads, i++) {
>      threads[i] = new Thread() {
>         public void run() {
>           for ( T t : n )
>             ...
> ...
> ...
>
> When would you do that?  E.g. when applying a multi-threaded
> implementation to a neighborhood.
Roger 5/5.



From saalfeld at mpi-cbg.de  Mon Aug 20 08:00:34 2012
From: saalfeld at mpi-cbg.de (Stephan Saalfeld)
Date: Mon, 20 Aug 2012 15:00:34 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <503230B8.2060800@mpi-cbg.de>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<1345460171.2241.70.camel@saalfeld-thinkpad>
	<503230B8.2060800@mpi-cbg.de>
Message-ID: <1345467634.2241.90.camel@saalfeld-thinkpad>

Good point.  May be we can come up with a shorter phrase than
ConcurrencyUnsafe :) (Unsafe alone doesn't fit really).  While I agree
that making the combo-interfaces is probably a good idea to prevent
Johannes from killing us, I would still like to have the Unsafe
interface something standalone such that it remains possible to
implement methods for the combination <A & Unsafe> instead of the
combined interface.

Cheers,
Stephan




On Mon, 2012-08-20 at 14:42 +0200, Tobias Pietzsch wrote: 
> Hi Stephan,
> 
> I think, having the ConcurrencySafe interface is a reasonable 
> suggestion.  I vote for adding the combined interfaces instead of
> returning generic interface combinations because that would involve
> changing code in lots of places and probably get us into trouble with
> the non-Eclipse world...
> 
> For simplicity, maybe we should do it the other way around, that is, 
> have "ConcurrencyUnsafeRandomAccessible" and then have RandomAccessible 
> extend that (and ConcurrencySafe, but maybe that interface is not even 
> required).
> 
> This way we would have to change relatively little code.
> 
> If we want the fullest support for the concurrency-unsafe Accessibles, 
> there would still be a lot of code duplication, i.e., OutOfBounds and 
> Views duplicated for safe and unsafe variants (view on a safe Accessible
> is itself safe).  Therefore I would rather suggest that we make the
> unsafe Accessibles second-class citizens for now. Only intented for
> inner loops and such. The main point is to prevent people from 
> accidentally using non-safe methods on these inner Accessibles and that 
> would be achieved.
> 
> best regards,
> Tobias
> 
> 
> 
> On 08/20/2012 12:56 PM, Stephan Saalfeld wrote:
> > Hi Tobias and all,
> >
> > great---thanks for spending time on that.
> >
> > The most important design question in my opinion is what Tobias has now
> > called the `Safe' vs. `UnSafe' concept.  As far as I remember from
> > previous discussions we do not have a final answer yet to that problem
> > and I sucked in posting the discussion to the Wiki.  So I suggest to
> > discuss it here now it becomes relevant.
> >
> > The problem:
> >
> > Both, accessors (e.g. Cursor) and proxy types (e.g. NativeType) are
> > stateful.  How should they be used in concurrent (e.g. multi-threaded)
> > code?  So far, the contract in ImgLib2 is: one accessor should not be
> > used concurrently, concurrent threads should each acquire a unique
> > accessor which, if required, provides a unique proxy type.  The inverse
> > contract is that if you have an accessible (e.g. IterableInterval), then
> > you can write concurrent code by requesting a unique accessor for each
> > thread.  This becomes problematic when accessibles are `nested', i.e.
> > the proxy type is an accessible.  The contract holds at all nested
> > levels when using what Tobias has implemented as the `Safe' solution.
> > It holds only at the top nesting level when using the `UnSafe' solution
> > where the `inner' accessible uses one single accessor instance.  Why
> > then doing it?  Because it is faster.  Iterating a 4-neighborhood for
> > each pixel in a 2d image would be slower when creating a new accessor at
> > each pixel-location.  Why is it problematic?  Because methods working
> > with an accessible as input can be applied to the inner accessibles,
> > may be implemented concurrently (e.g. apply convolution to a
> > neighborhood), and do not know at which `nesting' level they are called
> > (it also sucks to require thinking about that).
> >
> > Nesting accessibles is clearly a good thing and basically the reason why
> > ImgLib2 is designed as it is.  For `small' accessibles, it is necessary
> > to break the current contract that an accessible generates independent
> > accessors, because they would be slow otherwise.  So that contract is
> > broken.
> >
> > My current idea to solve this issue at compile time is by introducing
> > the empty interface ConcurrencySafe and require each accessible that
> > generates independent accessors to implement this interface.  Methods
> > that depend on that must then require their input to implement this
> > interface, e.g.
> >
> > <A extends RandomAccessible<T> & ConcurrencySafe>
> > void convolve(A a, A b){ ... }
> >
> > Since it doesn't interfere with existing code, it would enable to slowly
> > add this `security' constraint slowly over time while keeping things
> > running.
> >
> > It also means that the safe and unsafe factories would return a generic
> > interface combination and it can become a bit convoluted to keep that
> > information for passing such an object into another method using the
> > buggy Oracle compiler...
> >
> > An Oracle-friendly option would be to embed that interface into the
> > interface hierarchy and create the full bunch of concurrency safe
> > extensions of existing interfaces:
> > ConcurrencySafeRandomAccessible extends RandomAccessible
> > ConcurrencySafeIterableInterval extends IterableInterval ...
> >
> > Obviously, the JDK is not doing this and instead throws Exceptions for
> > an enormous synchronization and testing overhead at runtime (compare
> > Vector and ArrayList).
> >
> > What do you think?
> >
> > Best,
> > Stephan
> >
> >
> >
> > On Fri, 2012-08-17 at 16:24 +0200, Tobias Pietzsch wrote:
> >> Hi,
> >>
> >> the last two days, I finally took some time to take a deeper look at
> >> the Local Neighborhoods. About a year ago, I discussed with Stephan
> >> Saalfeld the idea that Neighborhood systems could just be nested
> >> Accessibles. I did a lot of exploratory implementation and it all lead
> >> naturally back to this idea. It just feels very "Imglib-like". I think
> >> it's the way to go.
> >>
> >> I made a proof-of-concept implementation which I just pushed to branch
> >> "tobias-neighborhood-experiments".  After playing around a lot, I have
> >> basically come up with the following design:
> >>
> >>
> >> Neighborhood<T>
> >> ===============
> >> The interface Neighborhood<T> extends Localizable, IterableInterval<T>.
> >> It is _not_ Positionable. It is simply at a fixed location.
> >>
> >>
> >> Cursor/RandomAccess< Neighborhood<T> >
> >> ========================================
> >> To move a neighborhood around, we use standard accessor interfaces.
> >> Assume you have a RandomAccess<Neighborhood<T>> a.
> >> Using a.setPosition() you can position the center of the neighborhood.
> >> Using a.get() you obtain a Neighborhood<T> (which you can then iterate).
> >>
> >> In many ways, the Neighborhood is like a NativeType. It is just a
> >> reference into an underlying structure. If you have a Cursor<T> of
> >> a NativeType, then the result T t = cursor.get() will be invalidated
> >> when you advance the cursor. The same holds for Cursor<Neighborhood<T>>.
> >> When you move the cursor, the neighborhood Neighborhood<T> n =
> >> cursor.get() will be invalidated when you advance the cursor.
> >>
> >>
> >> IterableInterval/RandomAccessible< Neighborhood<T> >
> >> ====================================================
> >> Of course, once you have the Accessors, it's easy to put the into
> >> Accessibles and benefit from all the goodies that are in ImgLib already.
> >> For example, if you have implemented a RandomAccess<Neighborhood<T>>
> >> it is straightforward to wrap it into a RandomAccessible and use
> >> Views.iterable() to get a Cursor over Neighborhood<T>.
> >>
> >> This results is pure syntactic sugar and lets you write sexy code like
> >> this:
> >>     for ( Neighborhood<T> n : neighborhoods )
> >>         for ( T t : n )
> >>             ...
> >>
> >> Shape
> >> =====
> >> At the top level is the interface "Shape". This is basically a factory
> >> for Accessibles on Neighborhoods. Every type of neighborhood should
> >> provide such a factory. There are four methods. The first is
> >>
> >>     public <T> IterableInterval<Neighborhood<T>>
> >>         neighborhoods( final RandomAccessibleInterval<T> source );
> >>
> >> This will give you an IteratableInterval over all neighborhoods in the
> >> source image. Augmenting the above example, in actual code it is used
> >> like this:
> >>     Img<FloatType> img;
> >>     long radius;
> >>     HyperSphereShape shape = new HyperSphereShape( radius );
> >>     for ( Neighborhood<FloatType> n : shape.neighborhoods( img ) )
> >>         for ( FloatType t : n )
> >>             ...
> >>
> >> The second method is
> >>
> >>     public <T> RandomAccessibleInterval<Neighborhood<T>>
> >>         neighborhoodsRandomAccessible(
> >>             final RandomAccessibleInterval<T> source );
> >>
> >> which gives you a RandomAccessibleInterval over all neighborhoods.
> >> Then there are "safe" variants of these two methods, which I will
> >> discuss later because it goes a bit deeper into the details...
> >>
> >> Examples
> >> ========
> >> I have fully implemented RectangleShape which supports
> >> (hyper-)rectangular neighborhoods. This is rather involved, because
> >> it supports both neighborhoods that skip the center pixel and such
> >> that don't; it has both an implementation of Cursor<Neighborhood<T>>
> >> and RandomAccess<Neighborhood<T>> for optimal speed; and so on...
> >>
> >> There is an incomplete implementation of HyperSphereShape, which
> >> despite being incomplete should be a better example to look at first.
> >> Basically I just copied and pasted from HyperSphereCursor.
> >> In this case, there is only a RandomAccess<Neighborhood<T>>. The
> >> Cursor is simply build using Views.iterable().
> >>
> >> Unfortunately, the code is still largely undocumented. I put effort
> >> into documenting the Shape interface, but that's it basically :(
> >>
> >> As an example for how to use Neighborhoods, please see
> >> net.imglib2.algorithm.region.localneighborhood.MinFilterExample
> >> in the imglib2-tests sub-project.
> >> Actually, just let me paste a fragement here. This implements a
> >> minimum filter using arbitrary neighborhood Shape:
> >>
> >> public static <T extends Type<T> & Comparable<T> > void
> >>       minFilter( final RandomAccessibleInterval<T> input,
> >>                  final RandomAccessibleInterval<T> output,
> >>                  final Shape shape )
> >> {
> >>     final RandomAccess< T > out = output.randomAccess();
> >>     for (final Neighborhood<T> neighborhood : shape.neighborhoods(input))
> >>     {
> >>       out.setPosition( neighborhood );
> >>       final T o = out.get();
> >>       o.set( neighborhood.firstElement() );
> >>       for ( final T i : neighborhood )
> >>         if ( i.compareTo( o ) < 0 )
> >>           o.set( i );
> >>     }
> >> }
> >>
> >> Beautiful, isn't it?
> >>
> >> Safe vs Unsafe Neighborhoods
> >> ============================
> >> About the "safe" variants of the methods in Shape. The above "unsafe"
> >> variants behave as follows: A Neighborhood<T> that you obtained from the
> >> returned accessible will re-use a single Cursor instance. That is:
> >>     Neighborhood<T> n = shape.neighborhoods( img ).firstElement();
> >>     Cursor<T> c1 = n.cursor();
> >>     Cursor<T> c2 = n.cursor();
> >> Here, c1 and c2 will be the same object! This is necessary to make
> >> the nested loops shown above really fast. Otherwise here,
> >>     for ( Neighborhood<T> n : neighborhoods )
> >>         for ( T t : n )
> >> in every iteration of the outer loop, a new Cursor would be created for
> >> the inner loop.
> >> I decided to make the "unsafe" option the default, i.e., the methods are
> >> called Shape.neighborhoods() and Shape.neighborhoodsSafe() instead of
> >> Shape.neighborhoodsUnsafe() and Shape.neighborhoods(). I'm open to
> >> change that, though.
> >>
> >> If you require a different behaviour, you can use the
> >> Shape.neighborhoodsSafe and neighborhoodsRandomAccessibleSafe methods.
> >> There are also other options which are described in the javadoc of the
> >> Shape interface. Please have a look!
> >>
> >> Performance
> >> ===========
> >> It can be made quite fast, actually. I have implemented a find-local-
> >> maxima benchmark (see LocalMaximaBenchmark) that compares several
> >> implementations of (3x3x...x3) Neighborhood.
> >>
> >> To count local maxima in a 200x200x200 float image, I get
> >> 683 ms using RectangleShape vs
> >> 877 ms using the old LocalNeighborhoodCursor
> >>
> >>
> >>
> >> As you might have noticed, I have completely neclected the copyOn() and
> >> updateSource() methods we discussed before.  I don't really see the need
> >> for them in the above design.
> >>
> >> Ok, I hope you will have a look at the code
> >> (branch "tobias-neighborhood-experiments") and tell me what you think.
> >>
> >> best regards,
> >> Tobias
> >>
> >>
> >> On 07/27/2012 05:35 PM, Jean-Yves Tinevez wrote:
> >>>
> >>> Hi all
> >>>
> >>> I pushed some changes to the test branch: I removed the realpositionable
> >>> stuff, and tried to draft the mother interface from our discussions.
> >>>
> >>> But I got stuck at the copyOn method. If I try to make it as generic as
> >>> I can (copy on a different RandomAccessible type and on a different
> >>> type), concrete implementations that are more specific (like the
> >>> buffered rectangle) fail on bad type bounds. I could use some help there.
> >>>
> >>> Best
> >>> jy
> >>>
> >>>
> >>
> >>
> >> _______________________________________________
> >> ImageJ-devel mailing list
> >> ImageJ-devel at imagej.net
> >> http://imagej.net/mailman/listinfo/imagej-devel
> >
> 



From pietzsch at mpi-cbg.de  Mon Aug 20 08:08:51 2012
From: pietzsch at mpi-cbg.de (Tobias Pietzsch)
Date: Mon, 20 Aug 2012 15:08:51 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <CAAgB9O648Z5wWE1s7m9pAumSmR2DoNPAwskLK4mvqKqTdxyWOg@mail.gmail.com>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<CAAgB9O648Z5wWE1s7m9pAumSmR2DoNPAwskLK4mvqKqTdxyWOg@mail.gmail.com>
Message-ID: <503236E3.9040701@mpi-cbg.de>

Hi,

> A basic question: how do we deal with out-of-bounds? Some strategies
> might require to know whether you are outside bounds, or even
> specify the OOBS. Example: an average filter wants to skip the pixels
> that are not inside the image.
>
> How do we get that with the neighborhood iterator?

I think there is no simple answer to that. It depends on what you want.
In my opinion, there are two things an algorithm requires out-of-bounds
type behaviour.

1.) get out-of-bounds values. Here the algorithm (e.g. a min filter)
needs values of out-of-bounds pixels, but actually it doesn't care where
they come from. Maybe the image is bigger than the interval the 
algorithm was called on, then these are real image values. Maybe these
values are generated by an OutOfBounds strategy. In this case, the
algorithm doesn't need to know where the values come from and you can 
just use the current design, e.g.
   Shape.neighborhoods( Views.extendMirrorSingle( img ) );

2.) an algorithm needs to know whether a given pixel is out-of-bounds
to take some action like skip that pixel (e.g. in that average filter).

In the second case the algorithm does usually not require a value for 
the out-of-bounds pixel. I would not realize this using the existing
OutOfBounds mechanisms (I also have to admit, that I do not see an easy 
way to do it).

I would propose the following:
Make a "BoundedShape" wrapper, that takes a Shape and a clipping 
interval. BoundedShape produces Accessibles on Neighborhoods that have 
cursors that implement Bounded. This could be a general wrapper that 
works on every neighborhood shape.

Then on top of that, one could implement another wrapper that just skips
out-of-bounds pixels altogether. So in your average filter, a 3x3 
neighborhood on the clipping border would just become a 2x3 
neighborhood, eliminating the out-of-bounds check in the algorithm.


Another thing -- There should be a change to the Shape interface:
Shape.neighborhoodsRandomAccessible() should take a RandomAccessible, 
not necessarily an RandomAccessibleInterval. There is no reason not to
have a RandomAccess<Neighborhood<T>> on an infinite image.

I will implement this as soon as possible.


best regards,
Tobias

On 08/18/2012 09:37 PM, Jean-Yves Tinevez wrote:
> Hi Tobias,
>
> Congratulations on this very clever design!
>
> I totally buy it, and just have basic questions.
>
>
>     Cursor/RandomAccess< Neighborhood<T> >
>     ==============================__==========
>     To move a neighborhood around, we use standard accessor interfaces.
>     Assume you have a RandomAccess<Neighborhood<T>> a.
>     Using a.setPosition() you can position the center of the neighborhood.
>     Using a.get() you obtain a Neighborhood<T> (which you can then iterate).
>
>     In many ways, the Neighborhood is like a NativeType. It is just a
>     reference into an underlying structure. If you have a Cursor<T> of
>     a NativeType, then the result T t = cursor.get() will be invalidated
>     when you advance the cursor. The same holds for Cursor<Neighborhood<T>>.
>     When you move the cursor, the neighborhood Neighborhood<T> n =
>     cursor.get() will be invalidated when you advance the cursor.
>
>
> This is really clever, clearly in the lines of master Stephan. Every
> time I ask a question, he tells me to focus on a new type.
>
>
>     IterableInterval/__RandomAccessible< Neighborhood<T> >
>     ==============================__======================
>     Of course, once you have the Accessors, it's easy to put the into
>     Accessibles and benefit from all the goodies that are in ImgLib already.
>     For example, if you have implemented a RandomAccess<Neighborhood<T>>
>     it is straightforward to wrap it into a RandomAccessible and use
>     Views.iterable() to get a Cursor over Neighborhood<T>.
>
>     This results is pure syntactic sugar and lets you write sexy code like
>     this:
>        for ( Neighborhood<T> n : neighborhoods )
>            for ( T t : n )
>                ...
>
>
> A basic question: how do we deal with out-of-bounds? Some strategies
> might require to know whether you are outside bounds, or even specify
> the OOBS. Example: an average filter wants to skip the pixels that are
> not inside the image.
>
> How do we get that with the neighborhood iterator?
>
>     As you might have noticed, I have completely neclected the copyOn() and
>     updateSource() methods we discussed before.  I don't really see the need
>     for them in the above design.
>
>     Ok, I hope you will have a look at the code
>     (branch "tobias-neighborhood-__experiments") and tell me what you think.
>
> Will do!
> Thanks!
> jy
>



From pietzsch at mpi-cbg.de  Mon Aug 20 08:19:50 2012
From: pietzsch at mpi-cbg.de (Tobias Pietzsch)
Date: Mon, 20 Aug 2012 15:19:50 +0200
Subject: [ImageJ-devel] Local Neighborhood stuff
In-Reply-To: <CAAgB9O7oDCMYhKEaJtHU1LAnCCTaxQO=i0NwUg3Qjop7AGTPvA@mail.gmail.com>
References: <500E760B.7060802@mpi-cbg.de> <5010F06F.6040607@uni-konstanz.de>
	<88A20083-627D-4DBB-88BB-6EE16F0E9886@pasteur.fr>
	<501120FA.9070901@mpi-cbg.de>
	<CAAgB9O75gbgSXVBMvXvk_iBcmHeLB4--6pjGidQ4Bc2M3iavcw@mail.gmail.com>
	<CAAgB9O43pCOQssm4bhNkFP6NrtFAet8KK183CaPpaJ9brPKMvQ@mail.gmail.com>
	<502E5427.2050808@mpi-cbg.de>
	<1345460171.2241.70.camel@saalfeld-thinkpad>
	<503230B8.2060800@mpi-cbg.de>
	<CAAgB9O7oDCMYhKEaJtHU1LAnCCTaxQO=i0NwUg3Qjop7AGTPvA@mail.gmail.com>
Message-ID: <50323976.4060009@mpi-cbg.de>

On 08/20/2012 02:50 PM, Jean-Yves Tinevez wrote:
> Hi Stephan
>
> Just to be sure I got your point:
>
> You mean that if we iterate over all the neighbohoods of a single final
> image in a multithreaded way, we might screw up with the unsafe
> implementations right? In a pseudo code, this:
>
> for (int i =0; i < nThreads, i++) {
>    threads[i] = new Thread() {
>
>      public void run() {
>
>               for ( Neighborhood<T> n : chunks)
>                      for ( T t : n )
>            ...
> ...
> ...
>
> would always fail with the unsafe implementation and always work with
> safe implementations? Right??

Hi Jean-Yves,

No. That would work in all cases, because the outer loop
for ( Neighborhood<T> n : chunks) uses one Cursor<Neighborhood<T>> and 
those are just completely normal cursors.


What would be problematic would be something like:

for ( Neighborhood<T> n : chunks)
    parallel( n );

void paralled( IterableInterval<T> iterable )
{
    for (int i =0; i < nThreads, i++) {
       threads[i] = new Thread() {
       public void run() {
          for ( T t : iterable )
              ...
}

because every thread would get the same Cursor<T> for the unsafe
variant.

best regards,
Tobias


From michael.zinsmaier at gmx.de  Wed Aug 22 02:56:54 2012
From: michael.zinsmaier at gmx.de (Michael Zinsmaier)
Date: Wed, 22 Aug 2012 09:56:54 +0200
Subject: [ImageJ-devel] Projector branch - ImgLib2
Message-ID: <503490C6.3020804@gmx.de>

Hi Curtis, ImageJ developers,

I work together with Christian and Martin on the KNIME Image Processing 
Plugin and the ImageJ2 integration for KNIME. We wanted to use something 
similar to the net.imglib2.display.XYProjector to render images for our 
views, however the current implementation was a bit too restricted (e.g. 
fixed to dimension 0,1) for our use cases.

I implemented a few new classes that might be interesting for you as 
well. The implementations can be found at net.imglib2.display.projectors
in the projectors branch.

The code is organized as follows:
- Projector2D: is similar to the XYProjector but it supports also the 
selection of other dimensions
   (the code is not active because it requires the class Subsetviews 
from ops, that is not part of the projectors branch)

- DimProjector2D: is similar to the CompositeProjector however instead 
of providing multiple Converters the idea is to provide a single  
converter with access to multiple values from the "projected" third 
dimension. This gives the converter more flexibility with respect to
  the composition of single conversion results.

- specializedProjectors: contains some 2DProjectors that allow fast 
(normalized) extraction of 2D greyscale datasets from certain storage 
strategies (Planar/Array)

- screenimages: contains classes that convert Byte/Short ArrayImages 
into Java Images similar to the implementation of 
net.imglib2.display.ARGBScreenImage

I'm looking forward for your comments
(hopefully the documentation of the classes is sufficient)
Regards Michael


From ctrueden at wisc.edu  Thu Aug 23 09:57:47 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Thu, 23 Aug 2012 09:57:47 -0500
Subject: [ImageJ-devel] Bug in ImageJ2 ?
In-Reply-To: <50362EF1.8020108@gmx.de>
References: <50362EF1.8020108@gmx.de>
Message-ID: <CADN69yna_9Xp56NRhshgELmCsq6denbvD1z5r_o=NVuG8iGfww@mail.gmail.com>

Hi Michael,


> There seems to be an issue with the InputHarvester and the SwingPanel if
> the object types of primitive java types are used as input parameters (e.g.
> Boolean instead of boolean).


Thanks for the report. It's definitely a bug due to our recent refactoring
of the widget system. Both Boolean and boolean are supposed to work. I'll
look into fixing it today.

-Curtis

P.S. Hopefully I will have time to respond to your ImgLib mail from
yesterday, too. I really appreciate you taking the time to look at and
improve the Projector logic. We did the minimum necessary at the time to
get something working, but currently everything is planar, and there is no
built-in (i.e., ImgLib2) zoom capability, which we will eventually need.


On Thu, Aug 23, 2012 at 8:24 AM, Michael Zinsmaier <michael.zinsmaier at gmx.de
> wrote:

>  Hi Curtis,
>
> I try currently to integrate the new imglib and ImageJ2 version (stuff
> from yesterday) into the KNIME ImageJ2 plugin.
> There seems to be an issue with the InputHarvester and the SwingPanel if
> the object types of primitive java types are
> used as input parameters (e.g. Boolean instead of boolean).
>
> The following plugin works fine:
>
> @Plugin(menu = {@Menu(label = "works")},
>          headless=true)
> public class Working<T extends RealType<T>> implements RunnablePlugin {
>
>     @Parameter(type = ItemIO.INPUT)
>     private boolean test;
>
>     @Parameter(type = ItemIO.OUTPUT)
>     private String output;
>
>     public void run() {
>             if (test) {
>                     output = "plugins can be defined as fragments of
> imagej.core";
>             }
>     }
>
> }
>
>
> while this plugin (Boolean instead of boolean) cannot be executed and
> results in a null pointer exception.
>
>
> @Plugin(menu = {@Menu(label = "works not")},
>          headless=true)
> public class NotWorking<T extends RealType<T>> implements RunnablePlugin {
>
>     @Parameter(type = ItemIO.INPUT)
>     private Boolean test;
>
>     @Parameter(type = ItemIO.OUTPUT)
>     private String output;
>
>     public void run() {
>             if (test) {
>                     output = "plugins can be defined as fragments of
> imagej.core";
>             }
>     }
>
> }
>
> Are only primitive types supported or is it a bug?
>
> Regards
> Michael
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120823/187c80a2/attachment.html>

From ctrueden at wisc.edu  Thu Aug 30 23:22:40 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Thu, 30 Aug 2012 23:22:40 -0500
Subject: [ImageJ-devel] service-parameters branch
Message-ID: <CADN69ymabTjeVCx03PkqFmLk7V4DeZ_xa9GOmJw12PYs-Y4gqw@mail.gmail.com>

Hi Dscho (& everyone),

The service-parameters branch contains some improvements to how services
declare their dependencies. It eliminates the need for those stupid no-arg
constructors just to make SezPoz happy (because it eliminates the need for
*any* explicit constructors). Rather, service dependencies are declared as
@Parameters now, similar to declaring inputs in a RunnablePlugin.

I tested and all seems to work well. However, as part of the refactoring I
touched some code in core/updater. Is it still the case that code changes
like this will break things for people with old versions of the updater,
due to the fact that that updater updates only itself and not its
dependencies? In this case, not updating imagej.service.ServiceHelper would
cause a problem when creating the UploaderService in
FilesUploader#createUploaderService().

How do you think we should proceed? Wait a bit before merging to master? Or
would these changes be OK?

Thanks,
Curtis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120830/67272605/attachment.html>

From schindelin at wisc.edu  Fri Aug 31 10:21:06 2012
From: schindelin at wisc.edu (Johannes Schindelin)
Date: Fri, 31 Aug 2012 17:21:06 +0200 (CEST)
Subject: [ImageJ-devel] service-parameters branch
In-Reply-To: <CADN69ymabTjeVCx03PkqFmLk7V4DeZ_xa9GOmJw12PYs-Y4gqw@mail.gmail.com>
References: <CADN69ymabTjeVCx03PkqFmLk7V4DeZ_xa9GOmJw12PYs-Y4gqw@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.1208311707200.11299@s15462909.onlinehome-server.info>

Hi Curtis,

On Thu, 30 Aug 2012, Curtis Rueden wrote:

> The service-parameters branch contains some improvements to how services
> declare their dependencies. It eliminates the need for those stupid
> no-arg constructors just to make SezPoz happy (because it eliminates the
> need for *any* explicit constructors). Rather, service dependencies are
> declared as @Parameters now, similar to declaring inputs in a
> RunnablePlugin.
> 
> I tested and all seems to work well. However, as part of the refactoring
> I touched some code in core/updater. Is it still the case that code
> changes like this will break things for people with old versions of the
> updater, due to the fact that that updater updates only itself and not
> its dependencies? In this case, not updating
> imagej.service.ServiceHelper would cause a problem when creating the
> UploaderService in FilesUploader#createUploaderService().
> 
> How do you think we should proceed? Wait a bit before merging to master?
> Or would these changes be OK?

I fear that the way I implemented the initialization of the UploadService
(it is done on *any* startup of the Updater, not just when an Uploader is
needed), we may run into trouble.

Having said that, the Fiji-Updater.jar I uploaded earlier this week should
remedy the problem by simply falling back to the Updater as uploaded this
past Monday, until a current and working Updater is available locally.

I will test with a setup as it would be when you updated two weeks ago but
not after that, but my guess is that we should maybe wait with *uploading*
a new Updater a couple of days.

Unfortunately, this would interfere with uploading beta4, right? Let's
discuss after my tests...

Ciao,
Dscho


From ctrueden at wisc.edu  Fri Aug 31 12:44:38 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Fri, 31 Aug 2012 12:44:38 -0500
Subject: [ImageJ-devel] Generalizing App. Framework
In-Reply-To: <5040C92C.30209@mbl.edu>
References: <CADN69ymabTjeVCx03PkqFmLk7V4DeZ_xa9GOmJw12PYs-Y4gqw@mail.gmail.com>
	<5040C92C.30209@mbl.edu>
Message-ID: <CADN69y=AhpsG8xURh3j+HjeZtWFPqsFFvzdZ4F9=tg6rjOzAhQ@mail.gmail.com>

Hi Grant,


> Your work on the application framework generalization looks great.
>

Thanks, I appreciate the code review.



I'll try to find some time to building an app. to try it out.


Sure, go for it. Just note that it is still not intended as a totally
general application framework. For example, the "ImageJ.createContext"
static methods always return an instance of the ImageJ class, not a
subclass. This is one of the (numerous) difficulties I alluded to when I
said I couldn't split out an "Application" interface in a more general way.

What is very convenient is to customize your ImageJ with many unique
services. So in that sense, you can create your own application. And now
those services can even change the application title by calling
ImageJ#setTitle(String).

So really, you can build anything you want with this framework (including
apps that have absolutely nothing to do with image processing), as long as
you are willing to accept that the application context is called "ImageJ"
no matter what. It just seemed too confusing to newbies to call it an
"AppContext" or something like that, even though that's really what it is.


> An additional ImageJ-specific reference that could be generalized:
> In imagej.util.AppUtils#**getBaseDirectory() there are references to
> imagej


Yep. It's a convenience method. The other getBaseDirectory signatures are
more general-purpose, allowing you to find the base directory relative to
any class. Still, there are a number of assumptions (i.e., heuristics) in
those methods. I just pushed a commit that describes it in excruciating
detail. See:

https://github.com/imagej/imagej/blob/6fe64ddf/core/core/src/main/java/imagej/util/AppUtils.java#L114

It's convenient to use your IDE's rendering of the Javadoc, since the
javadoc uses lots of HTML. Also, after tonight's nightly build, the new
javadoc will be online at:

http://jenkins.imagej.net/job/ImageJ-daily/javadoc/imagej/util/AppUtils.html#getBaseDirectory(java.lang.String,
java.lang.String)

In short, though we welcome any specific suggestions for improvement, we
believe the current code is sufficiently general for any application.

Let me know if you have any questions about it!


> (BTW, just wondering, why are MenuEntry & MenuPath in the imagej rather
> than imagej.menu package?)


That one is tricky. I'm torn on moving those to imagej.menu. They would be
more intuitive there. The rationale is that we have tried to avoid having
base packages with dependencies on their subpackages, because it creates
circular package dependencies (usually, subpackages depend on classes
higher up the tree). Of course, the compiler doesn't complain about it, but
these circular dependencies often indicate sloppy package design. In this
case, MenuEntry and MenuPath are used by UIDetails, which is a very
general-purpose interface. I don't necessarily like that it is in the
imagej base package, but after eliminating imagej.ext I was not sure where
else would make sense for it. Ideas, anyone?

Regards,
Curtis


On Fri, Aug 31, 2012 at 9:24 AM, Grant B. Harris <gharris at mbl.edu> wrote:

> Curtis --
>
> Your work on the application framework generalization looks great.
> I'll try to find some time to building an app. to try it out.
>
> An additional ImageJ-specific reference that could be generalized:
> In imagej.util.AppUtils#**getBaseDirectory() there are references to
> imagej
>
>     public static File getBaseDirectory() {
>         final String property = System.getProperty("ij.dir");
>         ...
>         final String appPath = getBaseDirectory("imagej.Main"**);
>         ...
>     }
>
> Wondering if there is a way to generalize those...
>
> (BTW, just wondering, why are MenuEntry & MenuPath in the imagej rather
> than imagej.menu package?)
>
> - Grant
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120831/2d7569d6/attachment.html>

From schindelin at wisc.edu  Fri Aug 31 13:06:47 2012
From: schindelin at wisc.edu (Johannes Schindelin)
Date: Fri, 31 Aug 2012 20:06:47 +0200 (CEST)
Subject: [ImageJ-devel] service-parameters branch
In-Reply-To: <alpine.DEB.1.00.1208311707200.11299@s15462909.onlinehome-server.info>
References: <CADN69ymabTjeVCx03PkqFmLk7V4DeZ_xa9GOmJw12PYs-Y4gqw@mail.gmail.com>
	<alpine.DEB.1.00.1208311707200.11299@s15462909.onlinehome-server.info>
Message-ID: <alpine.DEB.1.00.1208312003550.11299@s15462909.onlinehome-server.info>

Hi Curtis,

On Fri, 31 Aug 2012, Johannes Schindelin wrote:

> On Thu, 30 Aug 2012, Curtis Rueden wrote:
> 
> > The service-parameters branch contains some improvements to how services
> > declare their dependencies. It eliminates the need for those stupid
> > no-arg constructors just to make SezPoz happy (because it eliminates the
> > need for *any* explicit constructors). Rather, service dependencies are
> > declared as @Parameters now, similar to declaring inputs in a
> > RunnablePlugin.
> > 
> > I tested and all seems to work well. However, as part of the refactoring
> > I touched some code in core/updater. Is it still the case that code
> > changes like this will break things for people with old versions of the
> > updater, due to the fact that that updater updates only itself and not
> > its dependencies? In this case, not updating
> > imagej.service.ServiceHelper would cause a problem when creating the
> > UploaderService in FilesUploader#createUploaderService().
> > 
> > How do you think we should proceed? Wait a bit before merging to master?
> > Or would these changes be OK?
> 
> I fear that the way I implemented the initialization of the UploadService
> (it is done on *any* startup of the Updater, not just when an Uploader is
> needed), we may run into trouble.
> 
> Having said that, the Fiji-Updater.jar I uploaded earlier this week should
> remedy the problem by simply falling back to the Updater as uploaded this
> past Monday, until a current and working Updater is available locally.
> 
> I will test with a setup as it would be when you updated two weeks ago but
> not after that, but my guess is that we should maybe wait with *uploading*
> a new Updater a couple of days.
> 
> Unfortunately, this would interfere with uploading beta4, right? Let's
> discuss after my tests...

After testing a couple of times with different levels of "up-to-dateness",
it seems as if my recent work to make the Updater more robust really paid
off: there is no problem running the updater. I just need to make sure to
upload a complete IJ2 (and remove the files that were renamed/made
obsolete) so that the Fiji Updater does not *always* fall back to the
hard-coded remote updater (which would be the version from this past
Monday).

So: full steam ahead, I'll merge service-parameters after lunch and take
care of uploading stuff.

Ciao,
Dscho


From ctrueden at wisc.edu  Fri Aug 31 13:39:24 2012
From: ctrueden at wisc.edu (Curtis Rueden)
Date: Fri, 31 Aug 2012 13:39:24 -0500
Subject: [ImageJ-devel] service-parameters branch
In-Reply-To: <alpine.DEB.1.00.1208312003550.11299@s15462909.onlinehome-server.info>
References: <CADN69ymabTjeVCx03PkqFmLk7V4DeZ_xa9GOmJw12PYs-Y4gqw@mail.gmail.com>
	<alpine.DEB.1.00.1208311707200.11299@s15462909.onlinehome-server.info>
	<alpine.DEB.1.00.1208312003550.11299@s15462909.onlinehome-server.info>
Message-ID: <CADN69ymEfn9k3KLpjsf3vJP00AZkCmSOgpcSzY8=fUt7PrZeew@mail.gmail.com>

Hi Dscho,


> So: full steam ahead, I'll merge service-parameters after lunch and take
> care of uploading stuff.


Rock on, thanks a lot!

Cheers,
Curtis


On Fri, Aug 31, 2012 at 1:06 PM, Johannes Schindelin <schindelin at wisc.edu>wrote:

> Hi Curtis,
>
> On Fri, 31 Aug 2012, Johannes Schindelin wrote:
>
> > On Thu, 30 Aug 2012, Curtis Rueden wrote:
> >
> > > The service-parameters branch contains some improvements to how
> services
> > > declare their dependencies. It eliminates the need for those stupid
> > > no-arg constructors just to make SezPoz happy (because it eliminates
> the
> > > need for *any* explicit constructors). Rather, service dependencies are
> > > declared as @Parameters now, similar to declaring inputs in a
> > > RunnablePlugin.
> > >
> > > I tested and all seems to work well. However, as part of the
> refactoring
> > > I touched some code in core/updater. Is it still the case that code
> > > changes like this will break things for people with old versions of the
> > > updater, due to the fact that that updater updates only itself and not
> > > its dependencies? In this case, not updating
> > > imagej.service.ServiceHelper would cause a problem when creating the
> > > UploaderService in FilesUploader#createUploaderService().
> > >
> > > How do you think we should proceed? Wait a bit before merging to
> master?
> > > Or would these changes be OK?
> >
> > I fear that the way I implemented the initialization of the UploadService
> > (it is done on *any* startup of the Updater, not just when an Uploader is
> > needed), we may run into trouble.
> >
> > Having said that, the Fiji-Updater.jar I uploaded earlier this week
> should
> > remedy the problem by simply falling back to the Updater as uploaded this
> > past Monday, until a current and working Updater is available locally.
> >
> > I will test with a setup as it would be when you updated two weeks ago
> but
> > not after that, but my guess is that we should maybe wait with
> *uploading*
> > a new Updater a couple of days.
> >
> > Unfortunately, this would interfere with uploading beta4, right? Let's
> > discuss after my tests...
>
> After testing a couple of times with different levels of "up-to-dateness",
> it seems as if my recent work to make the Updater more robust really paid
> off: there is no problem running the updater. I just need to make sure to
> upload a complete IJ2 (and remove the files that were renamed/made
> obsolete) so that the Fiji Updater does not *always* fall back to the
> hard-coded remote updater (which would be the version from this past
> Monday).
>
> So: full steam ahead, I'll merge service-parameters after lunch and take
> care of uploading stuff.
>
> Ciao,
> Dscho
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://imagej.net/pipermail/imagej-devel/attachments/20120831/3f58dfa2/attachment.html>

