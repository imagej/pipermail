<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [ImageJ-devel] Local Neighborhood stuff
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:imagej-devel%40imagej.net?Subject=Re%3A%20%5BImageJ-devel%5D%20Local%20Neighborhood%20stuff&In-Reply-To=%3C503236E3.9040701%40mpi-cbg.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001197.html">
   <LINK REL="Next"  HREF="001198.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[ImageJ-devel] Local Neighborhood stuff</H1>
    <B>Tobias Pietzsch</B> 
    <A HREF="mailto:imagej-devel%40imagej.net?Subject=Re%3A%20%5BImageJ-devel%5D%20Local%20Neighborhood%20stuff&In-Reply-To=%3C503236E3.9040701%40mpi-cbg.de%3E"
       TITLE="[ImageJ-devel] Local Neighborhood stuff">pietzsch at mpi-cbg.de
       </A><BR>
    <I>Mon Aug 20 08:08:51 CDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001197.html">[ImageJ-devel] Local Neighborhood stuff
</A></li>
        <LI>Next message: <A HREF="001198.html">[ImageJ-devel] Local Neighborhood stuff
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1204">[ date ]</a>
              <a href="thread.html#1204">[ thread ]</a>
              <a href="subject.html#1204">[ subject ]</a>
              <a href="author.html#1204">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

&gt;<i> A basic question: how do we deal with out-of-bounds? Some strategies
</I>&gt;<i> might require to know whether you are outside bounds, or even
</I>&gt;<i> specify the OOBS. Example: an average filter wants to skip the pixels
</I>&gt;<i> that are not inside the image.
</I>&gt;<i>
</I>&gt;<i> How do we get that with the neighborhood iterator?
</I>
I think there is no simple answer to that. It depends on what you want.
In my opinion, there are two things an algorithm requires out-of-bounds
type behaviour.

1.) get out-of-bounds values. Here the algorithm (e.g. a min filter)
needs values of out-of-bounds pixels, but actually it doesn't care where
they come from. Maybe the image is bigger than the interval the 
algorithm was called on, then these are real image values. Maybe these
values are generated by an OutOfBounds strategy. In this case, the
algorithm doesn't need to know where the values come from and you can 
just use the current design, e.g.
   Shape.neighborhoods( Views.extendMirrorSingle( img ) );

2.) an algorithm needs to know whether a given pixel is out-of-bounds
to take some action like skip that pixel (e.g. in that average filter).

In the second case the algorithm does usually not require a value for 
the out-of-bounds pixel. I would not realize this using the existing
OutOfBounds mechanisms (I also have to admit, that I do not see an easy 
way to do it).

I would propose the following:
Make a &quot;BoundedShape&quot; wrapper, that takes a Shape and a clipping 
interval. BoundedShape produces Accessibles on Neighborhoods that have 
cursors that implement Bounded. This could be a general wrapper that 
works on every neighborhood shape.

Then on top of that, one could implement another wrapper that just skips
out-of-bounds pixels altogether. So in your average filter, a 3x3 
neighborhood on the clipping border would just become a 2x3 
neighborhood, eliminating the out-of-bounds check in the algorithm.


Another thing -- There should be a change to the Shape interface:
Shape.neighborhoodsRandomAccessible() should take a RandomAccessible, 
not necessarily an RandomAccessibleInterval. There is no reason not to
have a RandomAccess&lt;Neighborhood&lt;T&gt;&gt; on an infinite image.

I will implement this as soon as possible.


best regards,
Tobias

On 08/18/2012 09:37 PM, Jean-Yves Tinevez wrote:
&gt;<i> Hi Tobias,
</I>&gt;<i>
</I>&gt;<i> Congratulations on this very clever design!
</I>&gt;<i>
</I>&gt;<i> I totally buy it, and just have basic questions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Cursor/RandomAccess&lt; Neighborhood&lt;T&gt; &gt;
</I>&gt;<i>     ==============================__==========
</I>&gt;<i>     To move a neighborhood around, we use standard accessor interfaces.
</I>&gt;<i>     Assume you have a RandomAccess&lt;Neighborhood&lt;T&gt;&gt; a.
</I>&gt;<i>     Using a.setPosition() you can position the center of the neighborhood.
</I>&gt;<i>     Using a.get() you obtain a Neighborhood&lt;T&gt; (which you can then iterate).
</I>&gt;<i>
</I>&gt;<i>     In many ways, the Neighborhood is like a NativeType. It is just a
</I>&gt;<i>     reference into an underlying structure. If you have a Cursor&lt;T&gt; of
</I>&gt;<i>     a NativeType, then the result T t = cursor.get() will be invalidated
</I>&gt;<i>     when you advance the cursor. The same holds for Cursor&lt;Neighborhood&lt;T&gt;&gt;.
</I>&gt;<i>     When you move the cursor, the neighborhood Neighborhood&lt;T&gt; n =
</I>&gt;<i>     cursor.get() will be invalidated when you advance the cursor.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is really clever, clearly in the lines of master Stephan. Every
</I>&gt;<i> time I ask a question, he tells me to focus on a new type.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     IterableInterval/__RandomAccessible&lt; Neighborhood&lt;T&gt; &gt;
</I>&gt;<i>     ==============================__======================
</I>&gt;<i>     Of course, once you have the Accessors, it's easy to put the into
</I>&gt;<i>     Accessibles and benefit from all the goodies that are in ImgLib already.
</I>&gt;<i>     For example, if you have implemented a RandomAccess&lt;Neighborhood&lt;T&gt;&gt;
</I>&gt;<i>     it is straightforward to wrap it into a RandomAccessible and use
</I>&gt;<i>     Views.iterable() to get a Cursor over Neighborhood&lt;T&gt;.
</I>&gt;<i>
</I>&gt;<i>     This results is pure syntactic sugar and lets you write sexy code like
</I>&gt;<i>     this:
</I>&gt;<i>        for ( Neighborhood&lt;T&gt; n : neighborhoods )
</I>&gt;<i>            for ( T t : n )
</I>&gt;<i>                ...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A basic question: how do we deal with out-of-bounds? Some strategies
</I>&gt;<i> might require to know whether you are outside bounds, or even specify
</I>&gt;<i> the OOBS. Example: an average filter wants to skip the pixels that are
</I>&gt;<i> not inside the image.
</I>&gt;<i>
</I>&gt;<i> How do we get that with the neighborhood iterator?
</I>&gt;<i>
</I>&gt;<i>     As you might have noticed, I have completely neclected the copyOn() and
</I>&gt;<i>     updateSource() methods we discussed before.  I don't really see the need
</I>&gt;<i>     for them in the above design.
</I>&gt;<i>
</I>&gt;<i>     Ok, I hope you will have a look at the code
</I>&gt;<i>     (branch &quot;tobias-neighborhood-__experiments&quot;) and tell me what you think.
</I>&gt;<i>
</I>&gt;<i> Will do!
</I>&gt;<i> Thanks!
</I>&gt;<i> jy
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001197.html">[ImageJ-devel] Local Neighborhood stuff
</A></li>
	<LI>Next message: <A HREF="001198.html">[ImageJ-devel] Local Neighborhood stuff
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1204">[ date ]</a>
              <a href="thread.html#1204">[ thread ]</a>
              <a href="subject.html#1204">[ subject ]</a>
              <a href="author.html#1204">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://imagej.net/mailman/listinfo/imagej-devel">More information about the ImageJ-devel
mailing list</a><br>
</body></html>
